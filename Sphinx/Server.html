<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=UTF-8" />
<title>Class: Sphinx::Server</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (S)</a> &raquo; 
    <a title="Sphinx" href="../Sphinx.html">Sphinx</a>
     &raquo; 
    <span class="title">Server</span>
  
</div>

      <div id="search">
  <a id="class_list_link" href="#">Namespace List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Sphinx::Server 
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
      </dd>
    
  
  
    
  
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/sphinx/server.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Represents an instance of searchd server.
</p>


  </div>
</div>
<div class="tags">
  
</div>

  <h2>Attribute Summary</h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature"><a title="#host (instance method)" href="#host-instance_method">- (Object) <strong>host</strong> </a>
  
  </span>
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  

  
    <span class="summary_desc">
The host the Sphinx server is running on.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="#path (instance method)" href="#path-instance_method">- (Object) <strong>path</strong> </a>
  
  </span>
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  

  
    <span class="summary_desc">
The path to UNIX socket where Sphinx server is running on.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="#port (instance method)" href="#port-instance_method">- (Object) <strong>port</strong> </a>
  
  </span>
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  

  
    <span class="summary_desc">
The port the Sphinx server is listening on.

</span>
  
</li>

    
  </ul>


  <h2>Method Summary</h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature"><a title="#close_persistent! (instance method)" href="#close_persistent%21-instance_method">- (Object) <strong>close_persistent!</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Closes persistent socket.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="#free_socket (instance method)" href="#free_socket-instance_method">- (Object) <strong>free_socket</strong>(socket, force = false) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Closes previously opened socket.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="#get_socket (instance method)" href="#get_socket-instance_method">- (Object) <strong>get_socket</strong>(&amp;block) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Gets the opened socket to the server.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="#initialize (instance method)" href="#initialize-instance_method">- (Server) <strong>initialize</strong>(sphinx, host, port, path) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Creates a new instance of <tt>Server</tt>.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="#make_persistent! (instance method)" href="#make_persistent%21-instance_method">- (Object) <strong>make_persistent!</strong>(socket) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Makes specified socket persistent.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="#persistent? (instance method)" href="#persistent%3F-instance_method">- (Object) <strong>persistent?</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Gets a value indicating whether server has persistent socket associated.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a title="#to_s (instance method)" href="#to_s-instance_method">- (Object) <strong>to_s</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc"></span>
  
</li>

    
      <li class="private ">
  <span class="summary_signature"><a title="#establish_connection (instance method)" href="#establish_connection-instance_method">- (Object) <strong>establish_connection</strong> </a>
  
  </span>
  
  <span class="note title private">private</span>
  
  

  
    <span class="summary_desc">
This is internal method which establishes a connection to a configured
server.

</span>
  
</li>

    
  </ul>

<div id="constructor_details">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><a title="Server" href="">Server</a></tt>) <strong>initialize</strong>(sphinx, host, port, path) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Creates a new instance of <tt>Server</tt>.
</p>
<p>
Parameters:
</p>
<ul>
<li><tt>sphinx</tt> &#8212; an instance of <tt>Sphinx::Client</tt>.

</li>
<li><tt>host</tt> &#8212; name of host where search is running (if
<tt>path</tt> is not specified).

</li>
<li><tt>port</tt> &#8212; searchd port (if <tt>path</tt> is not specified).

</li>
<li><tt>path</tt> &#8212; an absolute path to the UNIX socket.

</li>
</ul>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt><a title="Server" href="">Server</a></tt>)</span>
      
      
      
      
        &mdash;
        
a new instance of <tt>Server</tt>


      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


22
23
24
25
26
27
28
29</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/server.rb', line 22</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='sphinx identifier id'>sphinx</span><span class='comma token'>,</span> <span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='comma token'>,</span> <span class='path identifier id'>path</span><span class='rparen token'>)</span>
  <span class='@sphinx ivar id'>@sphinx</span> <span class='assign token'>=</span> <span class='sphinx identifier id'>sphinx</span>
  <span class='@host ivar id'>@host</span> <span class='assign token'>=</span> <span class='host identifier id'>host</span>
  <span class='@port ivar id'>@port</span> <span class='assign token'>=</span> <span class='port identifier id'>port</span>
  <span class='@path ivar id'>@path</span> <span class='assign token'>=</span> <span class='path identifier id'>path</span>

  <span class='@socket ivar id'>@socket</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="attr_details">
    <h2>Attribute Details</h2>
    
      
      <span id=""></span>
      <span id="host-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="host-instance_method">
  
    - (<tt>Object</tt>) <strong>host</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The host the Sphinx server is running on
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


6
7
8</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/server.rb', line 6</span>

<span class='def def kw'>def</span> <span class='host identifier id'>host</span>
  <span class='@host ivar id'>@host</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="path-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="path-instance_method">
  
    - (<tt>Object</tt>) <strong>path</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The path to UNIX socket where Sphinx server is running on
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/server.rb', line 12</span>

<span class='def def kw'>def</span> <span class='path identifier id'>path</span>
  <span class='@path ivar id'>@path</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <span id="port-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="port-instance_method">
  
    - (<tt>Object</tt>) <strong>port</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The port the Sphinx server is listening on
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/server.rb', line 9</span>

<span class='def def kw'>def</span> <span class='port identifier id'>port</span>
  <span class='@port ivar id'>@port</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="method_details">
    <h2>Method Details</h2>
    
      <div class="method_details first">
  <p class="signature first" id="close_persistent!-instance_method">
  
    - (<tt>Object</tt>) <strong>close_persistent!</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Closes persistent socket.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


107
108
109</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/server.rb', line 107</span>

<span class='def def kw'>def</span> <span class='close_persistent! fid id'>close_persistent!</span>
  <span class='free_socket identifier id'>free_socket</span><span class='lparen token'>(</span><span class='@socket ivar id'>@socket</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="free_socket-instance_method">
  
    - (<tt>Object</tt>) <strong>free_socket</strong>(socket, force = false) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Closes previously opened socket.
</p>
<p>
Pass socket retrieved with <tt>get_socket</tt> method when finished work.
It does not close persistent sockets, but if really you need to do it, pass
<tt>true</tt> as <tt>force</tt> parameter value.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/server.rb', line 74</span>

<span class='def def kw'>def</span> <span class='free_socket identifier id'>free_socket</span><span class='lparen token'>(</span><span class='socket identifier id'>socket</span><span class='comma token'>,</span> <span class='force identifier id'>force</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='comment val'># Socket has not been open</span>
  <span class='return return kw'>return</span> <span class='false false kw'>false</span> <span class='if if_mod kw'>if</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>

  <span class='comment val'># Do we try to close persistent socket?</span>
  <span class='if if kw'>if</span> <span class='socket identifier id'>socket</span> <span class='eq op'>==</span> <span class='@socket ivar id'>@socket</span>
    <span class='comment val'># do not close it if not forced</span>
    <span class='if if kw'>if</span> <span class='force identifier id'>force</span>
      <span class='@socket ivar id'>@socket</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='unless unless_mod kw'>unless</span> <span class='@socket ivar id'>@socket</span><span class='dot token'>.</span><span class='closed? fid id'>closed?</span>
      <span class='@socket ivar id'>@socket</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
      <span class='true true kw'>true</span>
    <span class='else else kw'>else</span>
      <span class='false false kw'>false</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># Just close this socket</span>
    <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='unless unless_mod kw'>unless</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='closed? fid id'>closed?</span>
    <span class='true true kw'>true</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_socket-instance_method">
  
    - (<tt>Object</tt>) <strong>get_socket</strong>(&amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Gets the opened socket to the server.
</p>
<p>
You can pass a block to make any connection establishing related things,
like protocol version interchange. They will be treated as a part of
connection routine, so connection timeout will include them.
</p>
<p>
In case of connection error, <tt>SphinxConnectError</tt> exception will be
raised.
</p>
<p>
Method returns opened socket, so do not forget to close it using
<tt>free_socket</tt> method. Make sure you will close socket in case of any
emergency.
</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><a title="Sphinx::SphinxConnectError" href="SphinxConnectError.html">Sphinx::SphinxConnectError</a></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/server.rb', line 42</span>

<span class='def def kw'>def</span> <span class='get_socket identifier id'>get_socket</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='persistent? fid id'>persistent?</span>
    <span class='yield yield kw'>yield</span> <span class='@socket ivar id'>@socket</span>
    <span class='@socket ivar id'>@socket</span>
  <span class='else else kw'>else</span>
    <span class='socket identifier id'>socket</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='Sphinx constant id'>Sphinx</span><span class='colon2 op'>::</span><span class='safe_execute identifier id'>safe_execute</span><span class='lparen token'>(</span><span class='@sphinx ivar id'>@sphinx</span><span class='dot token'>.</span><span class='timeout identifier id'>timeout</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
      <span class='socket identifier id'>socket</span> <span class='assign token'>=</span> <span class='establish_connection identifier id'>establish_connection</span>

      <span class='comment val'># Do custom initialization</span>
      <span class='yield yield kw'>yield</span> <span class='socket identifier id'>socket</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span>
    <span class='end end kw'>end</span>
    <span class='socket identifier id'>socket</span>
  <span class='end end kw'>end</span>
<span class='rescue rescue kw'>rescue</span> <span class='SocketError constant id'>SocketError</span><span class='comma token'>,</span> <span class='SystemCallError constant id'>SystemCallError</span><span class='comma token'>,</span> <span class='IOError constant id'>IOError</span><span class='comma token'>,</span> <span class='EOFError constant id'>EOFError</span><span class='comma token'>,</span> <span class='colon3 op'>::</span><span class='Timeout constant id'>Timeout</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span><span class='comma token'>,</span> <span class='colon3 op'>::</span><span class='Errno constant id'>Errno</span><span class='colon2 op'>::</span><span class='EPIPE constant id'>EPIPE</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
  <span class='comment val'># Close previously opened socket (in case of it has been really opened)</span>
  <span class='free_socket identifier id'>free_socket</span><span class='lparen token'>(</span><span class='socket identifier id'>socket</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>

  <span class='error identifier id'>error</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;connection to #{to_s} failed (&quot;</span>
  <span class='if if kw'>if</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='SystemCallError constant id'>SystemCallError</span><span class='rparen token'>)</span>
    <span class='error identifier id'>error</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;errno=#{e.class::Errno}, &quot;</span>
  <span class='end end kw'>end</span>
  <span class='error identifier id'>error</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;msg=#{e.message})&quot;</span>
  <span class='raise identifier id'>raise</span> <span class='Sphinx constant id'>Sphinx</span><span class='colon2 op'>::</span><span class='SphinxConnectError constant id'>SphinxConnectError</span><span class='comma token'>,</span> <span class='error identifier id'>error</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="make_persistent!-instance_method">
  
    - (<tt>Object</tt>) <strong>make_persistent!</strong>(socket) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Makes specified socket persistent.
</p>
<p>
Previous persistent socket will be closed as well.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100
101
102
103
104</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/server.rb', line 98</span>

<span class='def def kw'>def</span> <span class='make_persistent! fid id'>make_persistent!</span><span class='lparen token'>(</span><span class='socket identifier id'>socket</span><span class='rparen token'>)</span>
  <span class='unless unless kw'>unless</span> <span class='socket identifier id'>socket</span> <span class='eq op'>==</span> <span class='@socket ivar id'>@socket</span>
    <span class='close_persistent! fid id'>close_persistent!</span>
    <span class='@socket ivar id'>@socket</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span>
  <span class='end end kw'>end</span>
  <span class='@socket ivar id'>@socket</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="persistent?-instance_method">
  
    - (<tt>Object</tt>) <strong>persistent?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Gets a value indicating whether server has persistent socket associated.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


112
113
114</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/server.rb', line 112</span>

<span class='def def kw'>def</span> <span class='persistent? fid id'>persistent?</span>
  <span class='notop op'>!</span><span class='@socket ivar id'>@socket</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="to_s-instance_method">
  
    - (<tt>Object</tt>) <strong>to_s</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


116
117
118</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/server.rb', line 116</span>

<span class='def def kw'>def</span> <span class='to_s identifier id'>to_s</span>
  <span class='@path ivar id'>@path</span> <span class='orop op'>||</span> <span class='dstring node'>&quot;#{@host}:#{@port}&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="establish_connection-instance_method">
  
    - (<tt>Object</tt>) <strong>establish_connection</strong>  <span class="extras">(private)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This is internal method which establishes a connection to a configured
server.
</p>
<p>
Method configures various socket options (like TCP_NODELAY), and sets
socket timeouts.
</p>
<p>
It does not close socket on any failure, please do it from calling code!
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/server.rb', line 129</span>

<span class='def def kw'>def</span> <span class='establish_connection identifier id'>establish_connection</span>
  <span class='if if kw'>if</span> <span class='@path ivar id'>@path</span>
    <span class='sock identifier id'>sock</span> <span class='assign token'>=</span> <span class='UNIXSocket constant id'>UNIXSocket</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@path ivar id'>@path</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='sock identifier id'>sock</span> <span class='assign token'>=</span> <span class='TCPSocket constant id'>TCPSocket</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@host ivar id'>@host</span><span class='comma token'>,</span> <span class='@port ivar id'>@port</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='io identifier id'>io</span> <span class='assign token'>=</span> <span class='Sphinx constant id'>Sphinx</span><span class='colon2 op'>::</span><span class='BufferedIO constant id'>BufferedIO</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='sock identifier id'>sock</span><span class='rparen token'>)</span>
  <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='setsockopt identifier id'>setsockopt</span><span class='lparen token'>(</span><span class='Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='IPPROTO_TCP constant id'>IPPROTO_TCP</span><span class='comma token'>,</span> <span class='Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='TCP_NODELAY constant id'>TCP_NODELAY</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='@sphinx ivar id'>@sphinx</span><span class='dot token'>.</span><span class='reqtimeout identifier id'>reqtimeout</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='read_timeout identifier id'>read_timeout</span> <span class='assign token'>=</span> <span class='@sphinx ivar id'>@sphinx</span><span class='dot token'>.</span><span class='reqtimeout identifier id'>reqtimeout</span>

    <span class='comment val'># This is a part of memcache-client library.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># Getting reports from several customers, including 37signals,</span>
    <span class='comment val'># that the non-blocking timeouts in 1.7.5 don't seem to be reliable.</span>
    <span class='comment val'># It can't hurt to set the underlying socket timeout also, if possible.</span>
    <span class='secs identifier id'>secs</span> <span class='assign token'>=</span> <span class='Integer constant id'>Integer</span><span class='lparen token'>(</span><span class='@sphinx ivar id'>@sphinx</span><span class='dot token'>.</span><span class='reqtimeout identifier id'>reqtimeout</span><span class='rparen token'>)</span>
    <span class='usecs identifier id'>usecs</span> <span class='assign token'>=</span> <span class='Integer constant id'>Integer</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='@sphinx ivar id'>@sphinx</span><span class='dot token'>.</span><span class='reqtimeout identifier id'>reqtimeout</span> <span class='minus op'>-</span> <span class='secs identifier id'>secs</span><span class='rparen token'>)</span> <span class='mult op'>*</span> <span class='integer val'>1_000_000</span><span class='rparen token'>)</span>
    <span class='optval identifier id'>optval</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='secs identifier id'>secs</span><span class='comma token'>,</span> <span class='usecs identifier id'>usecs</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;l_2&quot;</span><span class='rparen token'>)</span>
    <span class='begin begin kw'>begin</span>
      <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='setsockopt identifier id'>setsockopt</span> <span class='Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='SOL_SOCKET constant id'>SOL_SOCKET</span><span class='comma token'>,</span> <span class='Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='SO_RCVTIMEO constant id'>SO_RCVTIMEO</span><span class='comma token'>,</span> <span class='optval identifier id'>optval</span>
      <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='setsockopt identifier id'>setsockopt</span> <span class='Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='SOL_SOCKET constant id'>SOL_SOCKET</span><span class='comma token'>,</span> <span class='Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='SO_SNDTIMEO constant id'>SO_SNDTIMEO</span><span class='comma token'>,</span> <span class='optval identifier id'>optval</span>
    <span class='rescue rescue kw'>rescue</span> <span class='Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='ex identifier id'>ex</span>
      <span class='comment val'># Solaris, for one, does not like/support socket timeouts.</span>
      <span class='@warning ivar id'>@warning</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;Unable to use raw socket timeouts: #{ex.class.name}: #{ex.message}&quot;</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='read_timeout identifier id'>read_timeout</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>

  <span class='io identifier id'>io</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Sun Nov 22 16:49:56 2009 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>
  0.4.0 (ruby-1.8.7).
</div>

  </body>
</html>