<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Sphinx::Client
  
    &mdash; Sphinx Client API Documentation
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Sphinx.html" title="Sphinx (module)">Sphinx</a></span></span>
     &raquo; 
    <span class="title">Client</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Sphinx::Client
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Sphinx::Client</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="Constants.html" title="Sphinx::Constants (module)">Constants</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/sphinx/client.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>The Sphinx Client API is used to communicate with <tt>searchd</tt> daemon
and perform requests.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span> <span class='op'>=</span> <span class='const'>Sphinx</span><span class='op'>::</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>test</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_ids'>ids</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>matches</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_match'>match</span><span class='op'>|</span> <span class='id identifier rubyid_match'>match</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>id</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_posts'>posts</span> <span class='op'>=</span> <span class='const'>Post</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span> <span class='symbol'>:conditions</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ids'>ids</span> <span class='rbrace'>}</span><span class='comma'>,</span>
                 <span class='symbol'>:order</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>FIELD(id,</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ids'>ids</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>,</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_docs'>docs</span> <span class='op'>=</span> <span class='id identifier rubyid_posts'>posts</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:body</span><span class='rparen'>)</span>
<span class='id identifier rubyid_excerpts'>excerpts</span> <span class='op'>=</span> <span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_build_excerpts'>build_excerpts</span><span class='lparen'>(</span><span class='id identifier rubyid_docs'>docs</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>index</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>test</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span></code></pre>
    
  </div>


</div>
  <h2>Constant Summary</h2>
  



  <h2>Constant Summary</h2>
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="Constants.html" title="Sphinx::Constants (module)">Constants</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Constants.html#QUERY_FLAGS-constant" title="Sphinx::Constants::QUERY_FLAGS (constant)">Sphinx::Constants::QUERY_FLAGS</a></span>, <span class='object_link'><a href="Constants.html#SPH_ATTR_BIGINT-constant" title="Sphinx::Constants::SPH_ATTR_BIGINT (constant)">Sphinx::Constants::SPH_ATTR_BIGINT</a></span>, <span class='object_link'><a href="Constants.html#SPH_ATTR_BOOL-constant" title="Sphinx::Constants::SPH_ATTR_BOOL (constant)">Sphinx::Constants::SPH_ATTR_BOOL</a></span>, <span class='object_link'><a href="Constants.html#SPH_ATTR_FACTORS-constant" title="Sphinx::Constants::SPH_ATTR_FACTORS (constant)">Sphinx::Constants::SPH_ATTR_FACTORS</a></span>, <span class='object_link'><a href="Constants.html#SPH_ATTR_FLOAT-constant" title="Sphinx::Constants::SPH_ATTR_FLOAT (constant)">Sphinx::Constants::SPH_ATTR_FLOAT</a></span>, <span class='object_link'><a href="Constants.html#SPH_ATTR_INTEGER-constant" title="Sphinx::Constants::SPH_ATTR_INTEGER (constant)">Sphinx::Constants::SPH_ATTR_INTEGER</a></span>, <span class='object_link'><a href="Constants.html#SPH_ATTR_MULTI-constant" title="Sphinx::Constants::SPH_ATTR_MULTI (constant)">Sphinx::Constants::SPH_ATTR_MULTI</a></span>, <span class='object_link'><a href="Constants.html#SPH_ATTR_MULTI64-constant" title="Sphinx::Constants::SPH_ATTR_MULTI64 (constant)">Sphinx::Constants::SPH_ATTR_MULTI64</a></span>, <span class='object_link'><a href="Constants.html#SPH_ATTR_ORDINAL-constant" title="Sphinx::Constants::SPH_ATTR_ORDINAL (constant)">Sphinx::Constants::SPH_ATTR_ORDINAL</a></span>, <span class='object_link'><a href="Constants.html#SPH_ATTR_STRING-constant" title="Sphinx::Constants::SPH_ATTR_STRING (constant)">Sphinx::Constants::SPH_ATTR_STRING</a></span>, <span class='object_link'><a href="Constants.html#SPH_ATTR_TIMESTAMP-constant" title="Sphinx::Constants::SPH_ATTR_TIMESTAMP (constant)">Sphinx::Constants::SPH_ATTR_TIMESTAMP</a></span>, <span class='object_link'><a href="Constants.html#SPH_FILTER_FLOATRANGE-constant" title="Sphinx::Constants::SPH_FILTER_FLOATRANGE (constant)">Sphinx::Constants::SPH_FILTER_FLOATRANGE</a></span>, <span class='object_link'><a href="Constants.html#SPH_FILTER_RANGE-constant" title="Sphinx::Constants::SPH_FILTER_RANGE (constant)">Sphinx::Constants::SPH_FILTER_RANGE</a></span>, <span class='object_link'><a href="Constants.html#SPH_FILTER_VALUES-constant" title="Sphinx::Constants::SPH_FILTER_VALUES (constant)">Sphinx::Constants::SPH_FILTER_VALUES</a></span>, <span class='object_link'><a href="Constants.html#SPH_GROUPBY_ATTR-constant" title="Sphinx::Constants::SPH_GROUPBY_ATTR (constant)">Sphinx::Constants::SPH_GROUPBY_ATTR</a></span>, <span class='object_link'><a href="Constants.html#SPH_GROUPBY_ATTRPAIR-constant" title="Sphinx::Constants::SPH_GROUPBY_ATTRPAIR (constant)">Sphinx::Constants::SPH_GROUPBY_ATTRPAIR</a></span>, <span class='object_link'><a href="Constants.html#SPH_GROUPBY_DAY-constant" title="Sphinx::Constants::SPH_GROUPBY_DAY (constant)">Sphinx::Constants::SPH_GROUPBY_DAY</a></span>, <span class='object_link'><a href="Constants.html#SPH_GROUPBY_MONTH-constant" title="Sphinx::Constants::SPH_GROUPBY_MONTH (constant)">Sphinx::Constants::SPH_GROUPBY_MONTH</a></span>, <span class='object_link'><a href="Constants.html#SPH_GROUPBY_WEEK-constant" title="Sphinx::Constants::SPH_GROUPBY_WEEK (constant)">Sphinx::Constants::SPH_GROUPBY_WEEK</a></span>, <span class='object_link'><a href="Constants.html#SPH_GROUPBY_YEAR-constant" title="Sphinx::Constants::SPH_GROUPBY_YEAR (constant)">Sphinx::Constants::SPH_GROUPBY_YEAR</a></span>, <span class='object_link'><a href="Constants.html#SPH_MATCH_ALL-constant" title="Sphinx::Constants::SPH_MATCH_ALL (constant)">Sphinx::Constants::SPH_MATCH_ALL</a></span>, <span class='object_link'><a href="Constants.html#SPH_MATCH_ANY-constant" title="Sphinx::Constants::SPH_MATCH_ANY (constant)">Sphinx::Constants::SPH_MATCH_ANY</a></span>, <span class='object_link'><a href="Constants.html#SPH_MATCH_BOOLEAN-constant" title="Sphinx::Constants::SPH_MATCH_BOOLEAN (constant)">Sphinx::Constants::SPH_MATCH_BOOLEAN</a></span>, <span class='object_link'><a href="Constants.html#SPH_MATCH_EXTENDED-constant" title="Sphinx::Constants::SPH_MATCH_EXTENDED (constant)">Sphinx::Constants::SPH_MATCH_EXTENDED</a></span>, <span class='object_link'><a href="Constants.html#SPH_MATCH_EXTENDED2-constant" title="Sphinx::Constants::SPH_MATCH_EXTENDED2 (constant)">Sphinx::Constants::SPH_MATCH_EXTENDED2</a></span>, <span class='object_link'><a href="Constants.html#SPH_MATCH_FULLSCAN-constant" title="Sphinx::Constants::SPH_MATCH_FULLSCAN (constant)">Sphinx::Constants::SPH_MATCH_FULLSCAN</a></span>, <span class='object_link'><a href="Constants.html#SPH_MATCH_PHRASE-constant" title="Sphinx::Constants::SPH_MATCH_PHRASE (constant)">Sphinx::Constants::SPH_MATCH_PHRASE</a></span>, <span class='object_link'><a href="Constants.html#SPH_RANK_BM25-constant" title="Sphinx::Constants::SPH_RANK_BM25 (constant)">Sphinx::Constants::SPH_RANK_BM25</a></span>, <span class='object_link'><a href="Constants.html#SPH_RANK_EXPR-constant" title="Sphinx::Constants::SPH_RANK_EXPR (constant)">Sphinx::Constants::SPH_RANK_EXPR</a></span>, <span class='object_link'><a href="Constants.html#SPH_RANK_FIELDMASK-constant" title="Sphinx::Constants::SPH_RANK_FIELDMASK (constant)">Sphinx::Constants::SPH_RANK_FIELDMASK</a></span>, <span class='object_link'><a href="Constants.html#SPH_RANK_MATCHANY-constant" title="Sphinx::Constants::SPH_RANK_MATCHANY (constant)">Sphinx::Constants::SPH_RANK_MATCHANY</a></span>, <span class='object_link'><a href="Constants.html#SPH_RANK_NONE-constant" title="Sphinx::Constants::SPH_RANK_NONE (constant)">Sphinx::Constants::SPH_RANK_NONE</a></span>, <span class='object_link'><a href="Constants.html#SPH_RANK_PROXIMITY-constant" title="Sphinx::Constants::SPH_RANK_PROXIMITY (constant)">Sphinx::Constants::SPH_RANK_PROXIMITY</a></span>, <span class='object_link'><a href="Constants.html#SPH_RANK_PROXIMITY_BM25-constant" title="Sphinx::Constants::SPH_RANK_PROXIMITY_BM25 (constant)">Sphinx::Constants::SPH_RANK_PROXIMITY_BM25</a></span>, <span class='object_link'><a href="Constants.html#SPH_RANK_SPH04-constant" title="Sphinx::Constants::SPH_RANK_SPH04 (constant)">Sphinx::Constants::SPH_RANK_SPH04</a></span>, <span class='object_link'><a href="Constants.html#SPH_RANK_WORDCOUNT-constant" title="Sphinx::Constants::SPH_RANK_WORDCOUNT (constant)">Sphinx::Constants::SPH_RANK_WORDCOUNT</a></span>, <span class='object_link'><a href="Constants.html#SPH_SORT_ATTR_ASC-constant" title="Sphinx::Constants::SPH_SORT_ATTR_ASC (constant)">Sphinx::Constants::SPH_SORT_ATTR_ASC</a></span>, <span class='object_link'><a href="Constants.html#SPH_SORT_ATTR_DESC-constant" title="Sphinx::Constants::SPH_SORT_ATTR_DESC (constant)">Sphinx::Constants::SPH_SORT_ATTR_DESC</a></span>, <span class='object_link'><a href="Constants.html#SPH_SORT_EXPR-constant" title="Sphinx::Constants::SPH_SORT_EXPR (constant)">Sphinx::Constants::SPH_SORT_EXPR</a></span>, <span class='object_link'><a href="Constants.html#SPH_SORT_EXTENDED-constant" title="Sphinx::Constants::SPH_SORT_EXTENDED (constant)">Sphinx::Constants::SPH_SORT_EXTENDED</a></span>, <span class='object_link'><a href="Constants.html#SPH_SORT_RELEVANCE-constant" title="Sphinx::Constants::SPH_SORT_RELEVANCE (constant)">Sphinx::Constants::SPH_SORT_RELEVANCE</a></span>, <span class='object_link'><a href="Constants.html#SPH_SORT_TIME_SEGMENTS-constant" title="Sphinx::Constants::SPH_SORT_TIME_SEGMENTS (constant)">Sphinx::Constants::SPH_SORT_TIME_SEGMENTS</a></span></p>





  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_query-instance_method" title="#add_query (instance method)">- (Integer) <strong>add_query</strong>(query, index = '*', comment = '', log = true) </a>
    

    
      (also: #AddQuery)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Adds additional query with current settings to multi-query batch.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_excerpts-instance_method" title="#build_excerpts (instance method)">- (Array&lt;String&gt;, false) <strong>build_excerpts</strong>(docs, index, words, opts = {}) </a>
    

    
      (also: #BuildExcerpts)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Excerpts (snippets) builder function.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#build_keywords-instance_method" title="#build_keywords (instance method)">- (Array&lt;Hash&gt;) <strong>build_keywords</strong>(query, index, hits) </a>
    

    
      (also: #BuildKeywords)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Extracts keywords from query using tokenizer settings for given index,
optionally with per-keyword occurrence statistics.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close-instance_method" title="#close (instance method)">- (Boolean) <strong>close</strong> </a>
    

    
      (also: #Close)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Closes previously opened persistent connection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connect_error%3F-instance_method" title="#connect_error? (instance method)">- (Boolean) <strong>connect_error?</strong> </a>
    

    
      (also: #IsConnectError)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks whether the last error was a network error on API side, or a remote
error reported by searchd.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#escape_string-instance_method" title="#escape_string (instance method)">- (String) <strong>escape_string</strong>(string) </a>
    

    
      (also: #EscapeString)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Escapes characters that are treated as special operators by the query
language parser.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#flush_attributes-instance_method" title="#flush_attributes (instance method)">- (Integer) <strong>flush_attributes</strong> </a>
    

    
      (also: #FlushAttributes, #FlushAttrs, #flush_attrs)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Force attribute flush, and block until it completes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Client) <strong>initialize</strong>(logger = nil) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Constructs the <tt>Sphinx::Client</tt> object and sets options to their
default values.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inspect-instance_method" title="#inspect (instance method)">- (Object) <strong>inspect</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a string representation of the sphinx client object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#last_error-instance_method" title="#last_error (instance method)">- (String) <strong>last_error</strong> </a>
    

    
      (also: #GetLastError)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns last error message, as a string, in human readable format.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#last_warning-instance_method" title="#last_warning (instance method)">- (String) <strong>last_warning</strong> </a>
    

    
      (also: #GetLastWarning)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns last warning message, as a string, in human readable format.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#method_missing-instance_method" title="#method_missing (instance method)">- (Object) <strong>method_missing</strong>(method_id, *arguments, &amp;block) </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Enables ability to skip <tt>set_</tt> prefix for methods inside <span class='object_link'><a href="#query-instance_method" title="Sphinx::Client#query (method)">#query</a></span>
block.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#open-instance_method" title="#open (instance method)">- (Boolean) <strong>open</strong> </a>
    

    
      (also: #Open)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Opens persistent connection to the server.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#perform_request-instance_method" title="#perform_request (instance method)">- (Sphinx::Response) <strong>perform_request</strong>(command, request, additional = nil, server = nil) {|server, socket| ... }</a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Connect, send query, get response.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#query-instance_method" title="#query (instance method)">- (Hash, false) <strong>query</strong>(query, index = '*', comment = '') {|Client| ... }</a>
    

    
      (also: #Query)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Connects to searchd server, runs given search query with current settings,
obtains and returns the result set.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_filters-instance_method" title="#reset_filters (instance method)">- (Sphinx::Client) <strong>reset_filters</strong> </a>
    

    
      (also: #ResetFilters)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Clears all currently set filters.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_group_by-instance_method" title="#reset_group_by (instance method)">- (Sphinx::Client) <strong>reset_group_by</strong> </a>
    

    
      (also: #ResetGroupBy)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Clears all currently group-by settings, and disables group-by.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_outer_select-instance_method" title="#reset_outer_select (instance method)">- (Object) <strong>reset_outer_select</strong> </a>
    

    
      (also: #ResetOuterSelect)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_overrides-instance_method" title="#reset_overrides (instance method)">- (Sphinx::Client) <strong>reset_overrides</strong> </a>
    

    
      (also: #ResetOverrides)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Clear all attribute value overrides (for multi-queries).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_query_flag-instance_method" title="#reset_query_flag (instance method)">- (Object) <strong>reset_query_flag</strong> </a>
    

    
      (also: #ResetQueryFlag)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run_queries-instance_method" title="#run_queries (instance method)">- (Array&lt;Hash&gt;) <strong>run_queries</strong> </a>
    

    
      (also: #RunQueries)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Connect to searchd, runs a batch of all queries added using <span class='object_link'><a href="#add_query-instance_method" title="Sphinx::Client#add_query (method)">#add_query</a></span>,
obtains and returns the result sets.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#set_bit-instance_method" title="#set_bit (instance method)">- (Object) <strong>set_bit</strong>(bitset, index, value) </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets or resets given bit in a bitset.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_connect_timeout-instance_method" title="#set_connect_timeout (instance method)">- (Sphinx::Client) <strong>set_connect_timeout</strong>(timeout, retries = 1) </a>
    

    
      (also: #SetConnectTimeout)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the time allowed to spend connecting to the server before giving up
and number of retries to perform.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_field_weights-instance_method" title="#set_field_weights (instance method)">- (Sphinx::Client) <strong>set_field_weights</strong>(weights) </a>
    

    
      (also: #SetFieldWeights)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Binds per-field weights by name.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_filter-instance_method" title="#set_filter (instance method)">- (Sphinx::Client) <strong>set_filter</strong>(attribute, values, exclude = false) </a>
    

    
      (also: #SetFilter)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Adds new integer values set filter.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_filter_float_range-instance_method" title="#set_filter_float_range (instance method)">- (Sphinx::Client) <strong>set_filter_float_range</strong>(attribute, min, max, exclude = false) </a>
    

    
      (also: #SetFilterFloatRange)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Adds new float range filter.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_filter_range-instance_method" title="#set_filter_range (instance method)">- (Sphinx::Client) <strong>set_filter_range</strong>(attribute, min, max, exclude = false) </a>
    

    
      (also: #SetFilterRange)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Adds new integer range filter.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_geo_anchor-instance_method" title="#set_geo_anchor (instance method)">- (Sphinx::Client) <strong>set_geo_anchor</strong>(attrlat, attrlong, lat, long) </a>
    

    
      (also: #SetGeoAnchor)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets anchor point for and geosphere distance (geodistance) calculations,
and enable them.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_group_by-instance_method" title="#set_group_by (instance method)">- (Sphinx::Client) <strong>set_group_by</strong>(attribute, func, groupsort = '@group desc') </a>
    

    
      (also: #SetGroupBy)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets grouping attribute, function, and groups sorting mode; and enables
grouping (as described in Section 4.6, "Grouping (clustering) search
results").</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_group_distinct-instance_method" title="#set_group_distinct (instance method)">- (Sphinx::Client) <strong>set_group_distinct</strong>(attribute) </a>
    

    
      (also: #SetGroupDistinct)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets attribute name for per-group distinct values count calculations.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_id_range-instance_method" title="#set_id_range (instance method)">- (Sphinx::Client) <strong>set_id_range</strong>(min, max) </a>
    

    
      (also: #SetIDRange)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets an accepted range of document IDs.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_index_weights-instance_method" title="#set_index_weights (instance method)">- (Sphinx::Client) <strong>set_index_weights</strong>(weights) </a>
    

    
      (also: #SetIndexWeights)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets per-index weights, and enables weighted summing of match weights
across different indexes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_limits-instance_method" title="#set_limits (instance method)">- (Sphinx::Client) <strong>set_limits</strong>(offset, limit, max = 0, cutoff = 0) </a>
    

    
      (also: #SetLimits)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets offset into server-side result set (<tt>offset</tt>) and amount of
matches to return to client starting from that offset (<tt>limit</tt>).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_match_mode-instance_method" title="#set_match_mode (instance method)">- (Sphinx::Client) <strong>set_match_mode</strong>(mode) </a>
    

    
      (also: #SetMatchMode)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets full-text query matching mode.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_max_query_time-instance_method" title="#set_max_query_time (instance method)">- (Sphinx::Client) <strong>set_max_query_time</strong>(max) </a>
    

    
      (also: #SetMaxQueryTime)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets maximum search query time, in milliseconds.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_outer_select-instance_method" title="#set_outer_select (instance method)">- (Object) <strong>set_outer_select</strong>(orderby, offset, limit) </a>
    

    
      (also: #SetOuterSelect)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_override-instance_method" title="#set_override (instance method)">- (Sphinx::Client) <strong>set_override</strong>(attribute, attrtype, values) </a>
    

    
      (also: #SetOverride)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets temporary (per-query) per-document attribute value overrides.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_query_flag-instance_method" title="#set_query_flag (instance method)">- (Sphinx::Client) <strong>set_query_flag</strong>(flag_name, flag_value) </a>
    

    
      (also: #SetQueryFlag)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Allows to control a number of per-query options.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_ranking_mode-instance_method" title="#set_ranking_mode (instance method)">- (Sphinx::Client) <strong>set_ranking_mode</strong>(ranker, rankexpr = '') </a>
    

    
      (also: #SetRankingMode)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets ranking mode.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_request_timeout-instance_method" title="#set_request_timeout (instance method)">- (Sphinx::Client) <strong>set_request_timeout</strong>(timeout, retries = 1) </a>
    

    
      (also: #SetRequestTimeout)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the time allowed to spend performing request to the server before
giving up and number of retries to perform.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_retries-instance_method" title="#set_retries (instance method)">- (Sphinx::Client) <strong>set_retries</strong>(count, delay = 0) </a>
    

    
      (also: #SetRetries)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets distributed retry count and delay.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_select-instance_method" title="#set_select (instance method)">- (Sphinx::Client) <strong>set_select</strong>(select) </a>
    

    
      (also: #SetSelect)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the select clause, listing specific attributes to fetch, and
expressions to compute and fetch.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_server-instance_method" title="#set_server (instance method)">- (Sphinx::Client) <strong>set_server</strong>(host, port = 9312) </a>
    

    
      (also: #SetServer)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets searchd host name and TCP port.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_servers-instance_method" title="#set_servers (instance method)">- (Sphinx::Client) <strong>set_servers</strong>(servers) </a>
    

    
      (also: #SetServers)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the list of searchd servers.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_sort_mode-instance_method" title="#set_sort_mode (instance method)">- (Sphinx::Client) <strong>set_sort_mode</strong>(mode, sortby = '') </a>
    

    
      (also: #SetSortMode)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set matches sorting mode.</p>
</div></span>
  
</li>

      
        <li class="public deprecated">
  <span class="summary_signature">
    
      <a href="#set_weights-instance_method" title="#set_weights (instance method)">- (Sphinx::Client) <strong>set_weights</strong>(weights) </a>
    

    
      (also: #SetWeights)
    
  </span>
  
  
  
  
  
  <span class="deprecated note title">deprecated</span>
  

  
    <span class="summary_desc"><strong>Deprecated.</strong> <div class='inline'>
<p>Use <span class='object_link'><a href="#set_field_weights-instance_method" title="Sphinx::Client#set_field_weights (method)">#set_field_weights</a></span> instead.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#status-instance_method" title="#status (instance method)">- (Array&lt;Array&gt;, Array&lt;Hash&gt;) <strong>status</strong> </a>
    

    
      (also: #Status)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Queries searchd status, and returns an array of status variable name and
value pairs.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_attributes-instance_method" title="#update_attributes (instance method)">- (Integer) <strong>update_attributes</strong>(index, attrs, values, mva = false, ignore_non_existent = false) </a>
    

    
      (also: #UpdateAttributes)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Instantly updates given attribute values in given documents.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#with_server-instance_method" title="#with_server (instance method)">- (Object) <strong>with_server</strong>(server = nil, attempts = nil) {|server| ... }</a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This is internal method which selects next server (round-robin) and yields
it to the block passed.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#with_socket-instance_method" title="#with_socket (instance method)">- (Object) <strong>with_socket</strong>(server) {|socket| ... }</a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This is internal method which retrieves socket for a given server,
initiates Sphinx session, and yields this socket to a block passed.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Client</a></span></tt>) <strong>initialize</strong>(logger = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Constructs the <tt>Sphinx::Client</tt> object and sets options to their
default values.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>logger</span>
      
      
        <span class='type'>(<tt>Logger</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>a logger object to put logs to. No logging will be performed when not set.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 47</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_logger'>logger</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='comment'># per-query settings
</span>  <span class='ivar'>@offset</span>        <span class='op'>=</span> <span class='int'>0</span>                       <span class='comment'># how many records to seek from result-set start (default is 0)
</span>  <span class='ivar'>@limit</span>         <span class='op'>=</span> <span class='int'>20</span>                      <span class='comment'># how many records to return from result-set starting at offset (default is 20)
</span>  <span class='ivar'>@mode</span>          <span class='op'>=</span> <span class='const'>SPH_MATCH_ALL</span>           <span class='comment'># query matching mode (default is SPH_MATCH_ALL)
</span>  <span class='ivar'>@weights</span>       <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>                      <span class='comment'># per-field weights (default is 1 for all fields)
</span>  <span class='ivar'>@sort</span>          <span class='op'>=</span> <span class='const'>SPH_SORT_RELEVANCE</span>      <span class='comment'># match sorting mode (default is SPH_SORT_RELEVANCE)
</span>  <span class='ivar'>@sortby</span>        <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>                      <span class='comment'># attribute to sort by (defualt is &quot;&quot;)
</span>  <span class='ivar'>@min_id</span>        <span class='op'>=</span> <span class='int'>0</span>                       <span class='comment'># min ID to match (default is 0, which means no limit)
</span>  <span class='ivar'>@max_id</span>        <span class='op'>=</span> <span class='int'>0</span>                       <span class='comment'># max ID to match (default is 0, which means no limit)
</span>  <span class='ivar'>@filters</span>       <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>                      <span class='comment'># search filters
</span>  <span class='ivar'>@groupby</span>       <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>                      <span class='comment'># group-by attribute name
</span>  <span class='ivar'>@groupfunc</span>     <span class='op'>=</span> <span class='const'>SPH_GROUPBY_DAY</span>         <span class='comment'># function to pre-process group-by attribute value with
</span>  <span class='ivar'>@groupsort</span>     <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>@group desc</span><span class='tstring_end'>'</span></span>           <span class='comment'># group-by sorting clause (to sort groups in result set with)
</span>  <span class='ivar'>@groupdistinct</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>                      <span class='comment'># group-by count-distinct attribute
</span>  <span class='ivar'>@maxmatches</span>    <span class='op'>=</span> <span class='int'>1000</span>                    <span class='comment'># max matches to retrieve
</span>  <span class='ivar'>@cutoff</span>        <span class='op'>=</span> <span class='int'>0</span>                       <span class='comment'># cutoff to stop searching at (default is 0)
</span>  <span class='ivar'>@retrycount</span>    <span class='op'>=</span> <span class='int'>0</span>                       <span class='comment'># distributed retries count
</span>  <span class='ivar'>@retrydelay</span>    <span class='op'>=</span> <span class='int'>0</span>                       <span class='comment'># distributed retries delay
</span>  <span class='ivar'>@anchor</span>        <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>                      <span class='comment'># geographical anchor point
</span>  <span class='ivar'>@indexweights</span>  <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>                      <span class='comment'># per-index weights
</span>  <span class='ivar'>@ranker</span>        <span class='op'>=</span> <span class='const'>SPH_RANK_PROXIMITY_BM25</span> <span class='comment'># ranking mode (default is SPH_RANK_PROXIMITY_BM25)
</span>  <span class='ivar'>@rankexpr</span>      <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>                      <span class='comment'># ranking expression
</span>  <span class='ivar'>@maxquerytime</span>  <span class='op'>=</span> <span class='int'>0</span>                       <span class='comment'># max query time, milliseconds (default is 0, do not limit)
</span>  <span class='ivar'>@fieldweights</span>  <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>                      <span class='comment'># per-field-name weights
</span>  <span class='ivar'>@overrides</span>     <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>                      <span class='comment'># per-query attribute values overrides
</span>  <span class='ivar'>@select</span>        <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>*</span><span class='tstring_end'>'</span></span>                     <span class='comment'># select-list (attributes or expressions, with optional aliases)
</span>  <span class='ivar'>@query_flags</span>   <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@predictedtime</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@outerorderby</span>  <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
  <span class='ivar'>@outeroffset</span>   <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@outerlimit</span>    <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@hasouter</span>      <span class='op'>=</span> <span class='kw'>false</span>

  <span class='comment'># per-reply fields (for single-query case)
</span>  <span class='ivar'>@error</span>         <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>                      <span class='comment'># last error message
</span>  <span class='ivar'>@warning</span>       <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>                      <span class='comment'># last warning message
</span>  <span class='ivar'>@connerror</span>     <span class='op'>=</span> <span class='kw'>false</span>                   <span class='comment'># connection error vs remote error flag
</span>
  <span class='ivar'>@reqs</span>          <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>                      <span class='comment'># requests storage (for multi-query case)
</span>  <span class='ivar'>@mbenc</span>         <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>                      <span class='comment'># stored mbstring encoding
</span>  <span class='ivar'>@timeout</span>       <span class='op'>=</span> <span class='int'>0</span>                       <span class='comment'># connect timeout
</span>  <span class='ivar'>@retries</span>       <span class='op'>=</span> <span class='int'>1</span>                       <span class='comment'># number of connect retries in case of emergency
</span>  <span class='ivar'>@reqtimeout</span>    <span class='op'>=</span> <span class='int'>0</span>                       <span class='comment'># request timeout
</span>  <span class='ivar'>@reqretries</span>    <span class='op'>=</span> <span class='int'>1</span>                       <span class='comment'># number of request retries in case of emergency
</span>
  <span class='comment'># per-client-object settings
</span>  <span class='comment'># searchd servers list
</span>  <span class='ivar'>@servers</span>       <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Sphinx</span><span class='op'>::</span><span class='const'>Server</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>localhost</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='int'>9312</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>
  <span class='ivar'>@logger</span>        <span class='op'>=</span> <span class='id identifier rubyid_logger'>logger</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[sphinx] version: </span><span class='embexpr_beg'>#{</span><span class='const'>VERSION</span><span class='rbrace'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>
<div id="method_missing_details" class="method_details_list">
  <h2>Dynamic Method Handling</h2>
  <p class="notice this">
    This class handles dynamic methods through the <tt>method_missing</tt> method
    
  </p>
  
    <div class="method_details first">
  <h3 class="signature first" id="method_missing-instance_method">
  
    - (<tt>Object</tt>) <strong>method_missing</strong>(method_id, *arguments, &amp;block)  <span class="extras">(protected)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Enables ability to skip <tt>set_</tt> prefix for methods inside <span class='object_link'><a href="#query-instance_method" title="Sphinx::Client#query (method)">#query</a></span>
block.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>test</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_match_mode'>match_mode</span> <span class='symbol'>:all</span>
  <span class='id identifier rubyid_id_range'>id_range</span> <span class='int'>10</span><span class='comma'>,</span> <span class='int'>100</span>
<span class='kw'>end</span></code></pre>
    
  </div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2595
2596
2597
2598
2599
2600
2601</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 2595</span>

<span class='kw'>def</span> <span class='id identifier rubyid_method_missing'>method_missing</span><span class='lparen'>(</span><span class='id identifier rubyid_method_id'>method_id</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_arguments'>arguments</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@inside_eval</span> <span class='kw'>and</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>set_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method_id'>method_id</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>set_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method_id'>method_id</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_arguments'>arguments</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='kw'>super</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_query-instance_method">
  
    - (<tt>Integer</tt>) <strong>add_query</strong>(query, index = '*', comment = '', log = true) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='AddQuery-instance_method'>AddQuery</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Adds additional query with current settings to multi-query batch.
<tt>query</tt> is a query string. <tt>index</tt> is an index name (or
names) string. Additionally if provided, the contents of <tt>comment</tt>
are sent to the query log, marked in square brackets, just before the
search terms, which can be very useful for debugging. Currently, this is
limited to 128 characters. Returns index to results array returned from
<span class='object_link'><a href="#run_queries-instance_method" title="Sphinx::Client#run_queries (method)">#run_queries</a></span>.</p>

<p>Batch queries (or multi-queries) enable searchd to perform internal
optimizations if possible. They also reduce network connection overheads
and search process creation overheads in all cases. They do not result in
any additional overheads compared to simple queries. Thus, if you run
several different queries from your web page, you should always consider
using multi-queries.</p>

<p>For instance, running the same full-text query but with different sorting
or group-by settings will enable searchd to perform expensive full-text
search and ranking operation only once, but compute multiple group-by
results from its output.</p>

<p>This can be a big saver when you need to display not just plain search
results but also some per-category counts, such as the amount of products
grouped by vendor. Without multi-query, you would have to run several
queries which perform essentially the same search and retrieve the same
matches, but create result sets differently. With multi-query, you simply
pass all these queries in a single batch and Sphinx optimizes the redundant
full-text search internally.</p>

<p><span class='object_link'><a href="#add_query-instance_method" title="Sphinx::Client#add_query (method)">#add_query</a></span> internally saves full current settings state along with the
query, and you can safely change them afterwards for subsequent
<span class='object_link'><a href="#add_query-instance_method" title="Sphinx::Client#add_query (method)">#add_query</a></span> calls. Already added queries will not be affected; there's
actually no way to change them at all. Here's an example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_sort_mode'>set_sort_mode</span><span class='lparen'>(</span><span class='symbol'>:relevance</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_add_query'>add_query</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hello world</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>documents</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_sort_mode'>set_sort_mode</span><span class='lparen'>(</span><span class='symbol'>:attr_desc</span><span class='comma'>,</span> <span class='symbol'>:price</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_add_query'>add_query</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ipod</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>products</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_add_query'>add_query</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>harry potter</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>books</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_run_queries'>run_queries</span></code></pre>

<p>With the code above, 1st query will search for "hello world" in "documents"
index and sort results by relevance, 2nd query will search for "ipod" in
"products" index and sort results by price, and 3rd query will search for
"harry potter" in "books" index while still sorting by price. Note that 2nd
<span class='object_link'><a href="#set_sort_mode-instance_method" title="Sphinx::Client#set_sort_mode (method)">#set_sort_mode</a></span> call does not affect the first query (because it's already
added) but affects both other subsequent queries.</p>

<p>Additionally, any filters set up before an <span class='object_link'><a href="#add_query-instance_method" title="Sphinx::Client#add_query (method)">#add_query</a></span> will fall through
to subsequent queries. So, if <span class='object_link'><a href="#set_filter-instance_method" title="Sphinx::Client#set_filter (method)">#set_filter</a></span> is called before the first
query, the same filter will be in place for the second (and subsequent)
queries batched through <span class='object_link'><a href="#add_query-instance_method" title="Sphinx::Client#add_query (method)">#add_query</a></span> unless you call <span class='object_link'><a href="#reset_filters-instance_method" title="Sphinx::Client#reset_filters (method)">#reset_filters</a></span>
first. Alternatively, you can add additional filters as well.</p>

<p>This would also be true for grouping options and sorting options; no
current sorting, filtering, and grouping settings are affected by this
call; so subsequent queries will reuse current query settings.</p>

<p><span class='object_link'><a href="#add_query-instance_method" title="Sphinx::Client#add_query (method)">#add_query</a></span> returns an index into an array of results that will be
returned from <span class='object_link'><a href="#run_queries-instance_method" title="Sphinx::Client#run_queries (method)">#run_queries</a></span> call. It is simply a sequentially increasing
0-based integer, ie. first call will return 0, second will return 1, and so
on. Just a small helper so you won't have to track the indexes manualy if
you need then.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_add_query'>add_query</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>some search text</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>*</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>search page</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>query</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a query string.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>index</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>'*'</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>an index name (or names).</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>comment</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>''</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>a comment to be sent to the query log.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>log</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>true</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>indicating whether this call should be logged.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an index into an array of results that will be returned from <span class='object_link'><a href="#run_queries-instance_method" title="Sphinx::Client#run_queries (method)">#run_queries</a></span>
call.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-addquery" target="_parent" title="Section 6.6.2, &quot;AddQuery&quot;">Section 6.6.2, "AddQuery"</a></li>
    
      <li><span class='object_link'><a href="#query-instance_method" title="Sphinx::Client#query (method)">#query</a></span></li>
    
      <li><span class='object_link'><a href="#run_queries-instance_method" title="Sphinx::Client#run_queries (method)">#run_queries</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1570
1571
1572
1573
1574
1575
1576
1577
1578
1579
1580
1581
1582
1583
1584
1585
1586
1587
1588
1589
1590
1591
1592
1593
1594
1595
1596
1597
1598
1599
1600
1601
1602
1603
1604
1605
1606
1607
1608
1609
1610
1611
1612
1613
1614
1615
1616
1617
1618
1619
1620
1621
1622
1623
1624
1625
1626
1627
1628
1629
1630
1631
1632
1633
1634
1635
1636
1637
1638
1639
1640
1641
1642
1643
1644
1645
1646
1647
1648
1649
1650
1651
1652
1653
1654
1655
1656
1657
1658
1659
1660
1661
1662
1663
1664
1665
1666
1667
1668
1669
1670
1671
1672
1673
1674
1675
1676
1677
1678
1679
1680
1681</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1570</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_query'>add_query</span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>*</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_comment'>comment</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_log'>log</span> <span class='op'>=</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[sphinx] add_query('</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_query'>query</span><span class='rbrace'>}</span><span class='tstring_content'>', '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_index'>index</span><span class='rbrace'>}</span><span class='tstring_content'>', '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_comment'>comment</span><span class='rbrace'>}</span><span class='tstring_content'>'), </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_log'>log</span> <span class='kw'>and</span> <span class='id identifier rubyid_logger'>logger</span>
  <span class='comment'># build request
</span>
  <span class='comment'># mode and limits
</span>  <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='ivar'>@query_flags</span><span class='comma'>,</span> <span class='ivar'>@offset</span><span class='comma'>,</span> <span class='ivar'>@limit</span><span class='comma'>,</span> <span class='ivar'>@mode</span>
  <span class='comment'># ranker
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='ivar'>@ranker</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='ivar'>@rankexpr</span> <span class='kw'>if</span> <span class='ivar'>@ranker</span> <span class='op'>==</span> <span class='const'>SPH_RANK_EXPR</span>
  <span class='comment'># sorting
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='ivar'>@sort</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='ivar'>@sortby</span>
  <span class='comment'># query itself
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='id identifier rubyid_query'>query</span>
  <span class='comment'># weights
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int_array'>put_int_array</span> <span class='ivar'>@weights</span>
  <span class='comment'># indexes
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='id identifier rubyid_index'>index</span>
  <span class='comment'># id64 range marker
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='int'>1</span>
  <span class='comment'># id64 range
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int64'>put_int64</span> <span class='ivar'>@min_id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span> <span class='ivar'>@max_id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>

  <span class='comment'># filters
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='ivar'>@filters</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='ivar'>@filters</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_filter'>filter</span><span class='op'>|</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='id identifier rubyid_filter'>filter</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>attr</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='id identifier rubyid_filter'>filter</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>

    <span class='kw'>case</span> <span class='id identifier rubyid_filter'>filter</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
      <span class='kw'>when</span> <span class='const'>SPH_FILTER_VALUES</span>
        <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int64_array'>put_int64_array</span> <span class='id identifier rubyid_filter'>filter</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>values</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
      <span class='kw'>when</span> <span class='const'>SPH_FILTER_RANGE</span>
        <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int64'>put_int64</span> <span class='id identifier rubyid_filter'>filter</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>min</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_filter'>filter</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>max</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
      <span class='kw'>when</span> <span class='const'>SPH_FILTER_FLOATRANGE</span>
        <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_float'>put_float</span> <span class='id identifier rubyid_filter'>filter</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>min</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_filter'>filter</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>max</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>SphinxInternalError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Internal error: unhandled filter type</span><span class='tstring_end'>'</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='id identifier rubyid_filter'>filter</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>exclude</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='int'>0</span>
  <span class='kw'>end</span>

  <span class='comment'># group-by clause, max-matches count, group-sort clause, cutoff count
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='ivar'>@groupfunc</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='ivar'>@groupby</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='ivar'>@maxmatches</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='ivar'>@groupsort</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='ivar'>@cutoff</span><span class='comma'>,</span> <span class='ivar'>@retrycount</span><span class='comma'>,</span> <span class='ivar'>@retrydelay</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='ivar'>@groupdistinct</span>

  <span class='comment'># anchor point
</span>  <span class='kw'>if</span> <span class='ivar'>@anchor</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='int'>0</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='int'>1</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='ivar'>@anchor</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>attrlat</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@anchor</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>attrlong</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_float'>put_float</span> <span class='ivar'>@anchor</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>lat</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@anchor</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>long</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># per-index weights
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='ivar'>@indexweights</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='ivar'>@indexweights</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_idx'>idx</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='op'>|</span> <span class='id identifier rubyid_idx'>idx</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_idx'>idx</span><span class='comma'>,</span> <span class='id identifier rubyid_weight'>weight</span><span class='op'>|</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='id identifier rubyid_idx'>idx</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='id identifier rubyid_weight'>weight</span>
  <span class='kw'>end</span>

  <span class='comment'># max query time
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='ivar'>@maxquerytime</span>

  <span class='comment'># per-field weights
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='ivar'>@fieldweights</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='ivar'>@fieldweights</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_idx'>idx</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='op'>|</span> <span class='id identifier rubyid_idx'>idx</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_field'>field</span><span class='comma'>,</span> <span class='id identifier rubyid_weight'>weight</span><span class='op'>|</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='id identifier rubyid_field'>field</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='id identifier rubyid_weight'>weight</span>
  <span class='kw'>end</span>

  <span class='comment'># comment
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='id identifier rubyid_comment'>comment</span>

  <span class='comment'># attribute overrides
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='ivar'>@overrides</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='kw'>for</span> <span class='id identifier rubyid_entry'>entry</span> <span class='kw'>in</span> <span class='ivar'>@overrides</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='id identifier rubyid_entry'>entry</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>attr</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='id identifier rubyid_entry'>entry</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>values</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
    <span class='id identifier rubyid_entry'>entry</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>values</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='op'>|</span>
      <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int64'>put_int64</span> <span class='id identifier rubyid_id'>id</span>
      <span class='kw'>case</span> <span class='id identifier rubyid_entry'>entry</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
        <span class='kw'>when</span> <span class='const'>SPH_ATTR_FLOAT</span>
          <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_float'>put_float</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
        <span class='kw'>when</span> <span class='const'>SPH_ATTR_BIGINT</span>
          <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int64'>put_int64</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># select-list
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='ivar'>@select</span>

  <span class='comment'># max_predicted_time
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='ivar'>@predictedtime</span> <span class='kw'>if</span> <span class='ivar'>@predictedtime</span> <span class='op'>&gt;</span> <span class='int'>0</span>

  <span class='comment'># outer select
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='ivar'>@outerorderby</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='ivar'>@outeroffset</span><span class='comma'>,</span> <span class='ivar'>@outerlimit</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='ivar'>@hasouter</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='int'>0</span><span class='rparen'>)</span>

  <span class='comment'># store request to requests array
</span>  <span class='ivar'>@reqs</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='semicolon'>;</span>
  <span class='kw'>return</span> <span class='ivar'>@reqs</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>-</span> <span class='int'>1</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="build_excerpts-instance_method">
  
    - (<tt>Array&lt;String&gt;</tt>, <tt>false</tt>) <strong>build_excerpts</strong>(docs, index, words, opts = {}) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='BuildExcerpts-instance_method'>BuildExcerpts</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Excerpts (snippets) builder function. Connects to searchd, asks it to
generate excerpts (snippets) from given documents, and returns the results.</p>

<p><tt>docs</tt> is a plain array of strings that carry the documents'
contents. <tt>index</tt> is an index name string. Different settings (such
as charset, morphology, wordforms) from given index will be used.
<tt>words</tt> is a string that contains the keywords to highlight. They
will be processed with respect to index settings. For instance, if English
stemming is enabled in the index, "shoes" will be highlighted even if
keyword is "shoe". Starting with version 0.9.9-rc1, keywords can contain
wildcards, that work similarly to star-syntax available in queries.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_build_excerpts'>build_excerpts</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hello world</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hello me</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>idx</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hello</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>docs</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an array of strings which represent the documents' contents.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>index</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an index which settings will be used for stemming, lexing and case folding.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>words</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a string which contains the words to highlight.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>a <tt>Hash</tt> which contains additional optional highlighting parameters.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>opts</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">'before_match'</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>&quot;&lt;b&gt;&quot;</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>a string to insert before a keyword match.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">'after_match'</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>&quot;&lt;/b&gt;&quot;</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>a string to insert after a keyword match.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">'chunk_separator'</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>&quot; ... &quot;</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>a string to insert between snippet chunks (passages).</p>
</div>
          
        </li>
      
        <li>
          <span class="name">'limit'</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>256</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>maximum snippet size, in symbols (codepoints).</p>
</div>
          
        </li>
      
        <li>
          <span class="name">'around'</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>5</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>how many words to pick around each matching keywords block.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">'exact_phrase'</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>whether to highlight exact query phrase matches only instead of individual
keywords.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">'single_passage'</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>whether to extract single best passage only.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">'use_boundaries'</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>whether to extract passages by phrase boundaries setup in tokenizer.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">'weight_order'</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>whether to sort the extracted passages in order of relevance (decreasing
weight), or in order of appearance in the document (increasing position).</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>, <tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a plain array of strings with excerpts (snippets) on success; otherwise,
<tt>false</tt>.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-buildexcerpts" target="_parent" title="Section 6.7.1, &quot;BuildExcerpts&quot;">Section 6.7.1, "BuildExcerpts"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1868
1869
1870
1871
1872
1873
1874
1875
1876
1877
1878
1879
1880
1881
1882
1883
1884
1885
1886
1887
1888
1889
1890
1891
1892
1893
1894
1895
1896
1897
1898
1899
1900
1901
1902
1903
1904
1905
1906
1907
1908
1909
1910
1911
1912
1913
1914
1915
1916
1917
1918
1919
1920
1921
1922
1923
1924
1925
1926
1927
1928
1929
1930
1931
1932
1933
1934
1935
1936
1937
1938</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1868</span>

<span class='kw'>def</span> <span class='id identifier rubyid_build_excerpts'>build_excerpts</span><span class='lparen'>(</span><span class='id identifier rubyid_docs'>docs</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_words'>words</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;docs&quot; argument must be Array</span><span class='tstring_end'>'</span></span>   <span class='kw'>unless</span> <span class='id identifier rubyid_docs'>docs</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;index&quot; argument must be String</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;words&quot; argument must be String</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_words'>words</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;opts&quot; argument must be Hash</span><span class='tstring_end'>'</span></span>    <span class='kw'>unless</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_docs'>docs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_doc'>doc</span><span class='op'>|</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;docs&quot; argument must be Array of Strings</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># fixup options
</span>  <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='const'>HashWithIndifferentAccess</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
    <span class='symbol'>:before_match</span>         <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&lt;b&gt;</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
    <span class='symbol'>:after_match</span>          <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&lt;/b&gt;</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
    <span class='symbol'>:chunk_separator</span>      <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'> ... </span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
    <span class='symbol'>:limit</span>                <span class='op'>=&gt;</span> <span class='int'>256</span><span class='comma'>,</span>
    <span class='symbol'>:limit_passages</span>       <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span>
    <span class='symbol'>:limit_words</span>          <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span>
    <span class='symbol'>:around</span>               <span class='op'>=&gt;</span> <span class='int'>5</span><span class='comma'>,</span>
    <span class='symbol'>:exact_phrase</span>         <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
    <span class='symbol'>:single_passage</span>       <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
    <span class='symbol'>:use_boundaries</span>       <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
    <span class='symbol'>:weight_order</span>         <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
    <span class='symbol'>:query_mode</span>           <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
    <span class='symbol'>:force_all_words</span>      <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
    <span class='symbol'>:start_passage_id</span>     <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
    <span class='symbol'>:load_files</span>           <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
    <span class='symbol'>:html_strip_mode</span>      <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>index</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
    <span class='symbol'>:allow_empty</span>          <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
    <span class='symbol'>:passage_boundary</span>     <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>none</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
    <span class='symbol'>:emit_zones</span>           <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span>
    <span class='symbol'>:load_files_scattered</span> <span class='op'>=&gt;</span> <span class='kw'>false</span>
  <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>

  <span class='comment'># build request
</span>
  <span class='comment'># v.1.2 req
</span>  <span class='id identifier rubyid_flags'>flags</span>  <span class='op'>=</span> <span class='int'>1</span>
  <span class='id identifier rubyid_flags'>flags</span> <span class='op'>|=</span> <span class='int'>2</span>    <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:exact_phrase</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_flags'>flags</span> <span class='op'>|=</span> <span class='int'>4</span>    <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:single_passage</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_flags'>flags</span> <span class='op'>|=</span> <span class='int'>8</span>    <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:use_boundaries</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_flags'>flags</span> <span class='op'>|=</span> <span class='int'>16</span>   <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:weight_order</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_flags'>flags</span> <span class='op'>|=</span> <span class='int'>32</span>   <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:query_mode</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_flags'>flags</span> <span class='op'>|=</span> <span class='int'>64</span>   <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:force_all_words</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_flags'>flags</span> <span class='op'>|=</span> <span class='int'>128</span>  <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:load_files</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_flags'>flags</span> <span class='op'>|=</span> <span class='int'>256</span>  <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:allow_empty</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_flags'>flags</span> <span class='op'>|=</span> <span class='int'>512</span>  <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:emit_zones</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_flags'>flags</span> <span class='op'>|=</span> <span class='int'>1024</span> <span class='kw'>if</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:load_files_scattered</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span> <span class='comment'># mode=0, flags=1 (remove spaces)
</span>  <span class='comment'># req index
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='comment'># req words
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='id identifier rubyid_words'>words</span>

  <span class='comment'># options
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:before_match</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:after_match</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:chunk_separator</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:limit</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:around</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:limit_passages</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:limit_words</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:start_passage_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:html_strip_mode</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:passage_boundary</span><span class='rbracket'>]</span>

  <span class='comment'># documents
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='id identifier rubyid_docs'>docs</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_docs'>docs</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='id identifier rubyid_perform_request'>perform_request</span><span class='lparen'>(</span><span class='symbol'>:excerpt</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>

  <span class='comment'># parse response
</span>  <span class='id identifier rubyid_docs'>docs</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_string'>get_string</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="build_keywords-instance_method">
  
    - (<tt>Array&lt;Hash&gt;</tt>) <strong>build_keywords</strong>(query, index, hits) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='BuildKeywords-instance_method'>BuildKeywords</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Extracts keywords from query using tokenizer settings for given index,
optionally with per-keyword occurrence statistics. Returns an array of
hashes with per-keyword information.</p>

<p><tt>query</tt> is a query to extract keywords from. <tt>index</tt> is a
name of the index to get tokenizing settings and keyword occurrence
statistics from. <tt>hits</tt> is a boolean flag that indicates whether
keyword occurrence statistics are required.</p>

<p>The result set consists of <tt>Hash</tt>es with the following keys and values:</p>
<table class="rdoc-list"><tr><td class="rdoc-term"><p><tt>'tokenized'</tt></p></td>
<td>
<p>Tokenized keyword.</p>
</td></tr><tr><td class="rdoc-term"><p><tt>'normalized'</tt></p></td>
<td>
<p>Normalized keyword.</p>
</td></tr><tr><td class="rdoc-term"><p><tt>'docs'</tt></p></td>
<td>
<p>A number of documents where keyword is found (if <tt>hits</tt> param is
<tt>true</tt>).</p>
</td></tr><tr><td class="rdoc-term"><p><tt>'hits'</tt></p></td>
<td>
<p>A number of keywords occurrences among all documents (if <tt>hits</tt>
param is <tt>true</tt>).</p>
</td></tr></table>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_keywords'>keywords</span> <span class='op'>=</span> <span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_build_keywords'>build_keywords</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>this.is.my query</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>test1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>query</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a query string.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>index</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an index to get tokenizing settings and keyword occurrence statistics from.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>hits</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>indicates whether keyword occurrence statistics are required.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an <tt>Array</tt> of <tt>Hash</tt>es in format specified above.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-buildkeywords" target="_parent" title="Section 6.7.3, &quot;BuildKeywords&quot;">Section 6.7.3, "BuildKeywords"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1976
1977
1978
1979
1980
1981
1982
1983
1984
1985
1986
1987
1988
1989
1990
1991
1992
1993
1994
1995
1996
1997
1998
1999
2000
2001</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1976</span>

<span class='kw'>def</span> <span class='id identifier rubyid_build_keywords'>build_keywords</span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_hits'>hits</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;query&quot; argument must be String</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;index&quot; argument must be String</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;hits&quot; argument must be Boolean</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_hits'>hits</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_hits'>hits</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>FalseClass</span><span class='rparen'>)</span>

  <span class='comment'># build request
</span>  <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='comment'># v.1.0 req
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='id identifier rubyid_query'>query</span> <span class='comment'># req query
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='id identifier rubyid_index'>index</span> <span class='comment'># req index
</span>  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='id identifier rubyid_hits'>hits</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='int'>0</span>

  <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='id identifier rubyid_perform_request'>perform_request</span><span class='lparen'>(</span><span class='symbol'>:keywords</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>

  <span class='comment'># parse response
</span>  <span class='id identifier rubyid_nwords'>nwords</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int'>get_int</span>
  <span class='lparen'>(</span><span class='int'>0</span><span class='op'>...</span><span class='id identifier rubyid_nwords'>nwords</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_tokenized'>tokenized</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_string'>get_string</span>
    <span class='id identifier rubyid_normalized'>normalized</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_string'>get_string</span>

    <span class='id identifier rubyid_entry'>entry</span> <span class='op'>=</span> <span class='const'>HashWithIndifferentAccess</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>tokenized</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_tokenized'>tokenized</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>normalized</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_normalized'>normalized</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_entry'>entry</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>docs</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hits</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_ints'>get_ints</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_hits'>hits</span>

    <span class='id identifier rubyid_entry'>entry</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="close-instance_method">
  
    - (<tt>Boolean</tt>) <strong>close</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='Close-instance_method'>Close</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Closes previously opened persistent connection.</p>

<p>This method could be used only when a single searchd server configured.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='kw'>begin</span>
  <span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span>
  <span class='comment'># perform several requests
</span><span class='kw'>ensure</span>
  <span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
<span class='kw'>end</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p><tt>true</tt> when persistent connection has been closed; otherwise,
<tt>false</tt>.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#open-instance_method" title="Sphinx::Client#open (method)">#open</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2265
2266
2267
2268
2269
2270
2271
2272
2273
2274
2275
2276
2277</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 2265</span>

<span class='kw'>def</span> <span class='id identifier rubyid_close'>close</span>
  <span class='kw'>if</span> <span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span>
    <span class='ivar'>@error</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>too many servers. persistent socket allowed only for a single server.</span><span class='tstring_end'>'</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_persistent?'>persistent?</span>
    <span class='ivar'>@error</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>not connected</span><span class='tstring_end'>'</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span><span class='semicolon'>;</span>
  <span class='kw'>end</span>

  <span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_close_persistent!'>close_persistent!</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="connect_error?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>connect_error?</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='IsConnectError-instance_method'>IsConnectError</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks whether the last error was a network error on API side, or a remote
error reported by searchd. Returns true if the last connection attempt to
searchd failed on API side, false otherwise (if the error was remote, or
there were no connection attempts at all).</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Connection failed!</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_connect_error?'>connect_error?</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the value indicating whether last error was a nework error on API side.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#last_error-instance_method" title="Sphinx::Client#last_error (method)">#last_error</a></span></li>
    
      <li><span class='object_link'><a href="#last_warning-instance_method" title="Sphinx::Client#last_warning (method)">#last_warning</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


199
200
201</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 199</span>

<span class='kw'>def</span> <span class='id identifier rubyid_connect_error?'>connect_error?</span>
  <span class='ivar'>@connerror</span> <span class='op'>||</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="escape_string-instance_method">
  
    - (<tt>String</tt>) <strong>escape_string</strong>(string) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='EscapeString-instance_method'>EscapeString</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Escapes characters that are treated as special operators by the query
language parser.</p>

<p>This function might seem redundant because it's trivial to implement in any
calling application. However, as the set of special characters might change
over time, it makes sense to have an API call that is guaranteed to escape
all such characters at all times.</p>

<p>@example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_escaped'>escaped</span> <span class='op'>=</span> <span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_escape_string'>escape_string</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>escaping-sample@query/string</span><span class='tstring_end'>&quot;</span></span></code></pre>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>string</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>is a string to escape.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an escaped string.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2123
2124
2125</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 2123</span>

<span class='kw'>def</span> <span class='id identifier rubyid_escape_string'>escape_string</span><span class='lparen'>(</span><span class='id identifier rubyid_string'>string</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_string'>string</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>([\\()|\-!@~&quot;&amp;\/\^\$=])</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>\\\\\\1</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="flush_attributes-instance_method">
  
    - (<tt>Integer</tt>) <strong>flush_attributes</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='FlushAttributes-instance_method'>FlushAttributes</span>, <span id='FlushAttrs-instance_method'>FlushAttrs</span>, <span id='flush_attrs-instance_method'>flush_attrs</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Force attribute flush, and block until it completes.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_flush_attrs'>flush_attrs</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>current internal flush tag on success, -1 on failure.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2187
2188
2189
2190
2191
2192
2193
2194
2195
2196
2197
2198</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 2187</span>

<span class='kw'>def</span> <span class='id identifier rubyid_flush_attributes'>flush_attributes</span>
  <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='id identifier rubyid_perform_request'>perform_request</span><span class='lparen'>(</span><span class='symbol'>:flushattrs</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>

  <span class='comment'># parse response
</span>  <span class='kw'>begin</span>
    <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int'>get_int</span>
  <span class='kw'>rescue</span> <span class='const'>EOFError</span>
    <span class='ivar'>@error</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>unexpected response length</span><span class='tstring_end'>'</span></span>
    <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="inspect-instance_method">
  
    - (<tt>Object</tt>) <strong>inspect</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a string representation of the sphinx client object.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 103</span>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
  <span class='id identifier rubyid_params'>params</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='symbol'>:error</span> <span class='op'>=&gt;</span> <span class='ivar'>@error</span><span class='comma'>,</span>
    <span class='symbol'>:warning</span> <span class='op'>=&gt;</span> <span class='ivar'>@warning</span><span class='comma'>,</span>
    <span class='symbol'>:connect_error</span> <span class='op'>=&gt;</span> <span class='ivar'>@connerror</span><span class='comma'>,</span>
    <span class='symbol'>:servers</span> <span class='op'>=&gt;</span> <span class='ivar'>@servers</span><span class='comma'>,</span>
    <span class='symbol'>:connect_timeout</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:timeout</span> <span class='op'>=&gt;</span> <span class='ivar'>@timeout</span><span class='comma'>,</span> <span class='symbol'>:retries</span> <span class='op'>=&gt;</span> <span class='ivar'>@retries</span> <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='symbol'>:request_timeout</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:timeout</span> <span class='op'>=&gt;</span> <span class='ivar'>@reqtimeout</span><span class='comma'>,</span> <span class='symbol'>:retries</span> <span class='op'>=&gt;</span> <span class='ivar'>@reqretries</span> <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='symbol'>:retries</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:count</span> <span class='op'>=&gt;</span> <span class='ivar'>@retrycount</span><span class='comma'>,</span> <span class='symbol'>:delay</span> <span class='op'>=&gt;</span> <span class='ivar'>@retrydelay</span> <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='symbol'>:limits</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:offset</span> <span class='op'>=&gt;</span> <span class='ivar'>@offset</span><span class='comma'>,</span> <span class='symbol'>:limit</span> <span class='op'>=&gt;</span> <span class='ivar'>@limit</span><span class='comma'>,</span> <span class='symbol'>:max</span> <span class='op'>=&gt;</span> <span class='ivar'>@maxmatches</span><span class='comma'>,</span> <span class='symbol'>:cutoff</span> <span class='op'>=&gt;</span> <span class='ivar'>@cutoff</span> <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='symbol'>:max_query_time</span> <span class='op'>=&gt;</span> <span class='ivar'>@maxquerytime</span><span class='comma'>,</span>
    <span class='symbol'>:overrides</span> <span class='op'>=&gt;</span> <span class='ivar'>@overrides</span><span class='comma'>,</span>
    <span class='symbol'>:select</span> <span class='op'>=&gt;</span> <span class='ivar'>@select</span><span class='comma'>,</span>
    <span class='symbol'>:match_mode</span> <span class='op'>=&gt;</span> <span class='ivar'>@mode</span><span class='comma'>,</span>
    <span class='symbol'>:ranking</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:mode</span> <span class='op'>=&gt;</span> <span class='ivar'>@ranker</span><span class='comma'>,</span> <span class='symbol'>:expression</span> <span class='op'>=&gt;</span> <span class='ivar'>@rankexpr</span> <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='symbol'>:sort_mode</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:mode</span> <span class='op'>=&gt;</span> <span class='ivar'>@sort</span><span class='comma'>,</span> <span class='symbol'>:sort_by</span> <span class='op'>=&gt;</span> <span class='ivar'>@sortby</span> <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='symbol'>:weights</span> <span class='op'>=&gt;</span> <span class='ivar'>@weights</span><span class='comma'>,</span>
    <span class='symbol'>:field_weights</span> <span class='op'>=&gt;</span> <span class='ivar'>@fieldweights</span><span class='comma'>,</span>
    <span class='symbol'>:index_weights</span> <span class='op'>=&gt;</span> <span class='ivar'>@indexweights</span><span class='comma'>,</span>
    <span class='symbol'>:id_range</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:min</span> <span class='op'>=&gt;</span> <span class='ivar'>@min_id</span><span class='comma'>,</span> <span class='symbol'>:max</span> <span class='op'>=&gt;</span> <span class='ivar'>@max_id</span> <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='symbol'>:filters</span> <span class='op'>=&gt;</span> <span class='ivar'>@filters</span><span class='comma'>,</span>
    <span class='symbol'>:geo_anchor</span> <span class='op'>=&gt;</span> <span class='ivar'>@anchor</span><span class='comma'>,</span>
    <span class='symbol'>:group_by</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:attribute</span> <span class='op'>=&gt;</span> <span class='ivar'>@groupby</span><span class='comma'>,</span> <span class='symbol'>:func</span> <span class='op'>=&gt;</span> <span class='ivar'>@groupfunc</span><span class='comma'>,</span> <span class='symbol'>:sort</span> <span class='op'>=&gt;</span> <span class='ivar'>@groupsort</span> <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='symbol'>:group_distinct</span> <span class='op'>=&gt;</span> <span class='ivar'>@groupdistinct</span><span class='comma'>,</span>
    <span class='symbol'>:query_flags</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:bitset</span> <span class='op'>=&gt;</span> <span class='ivar'>@query_flags</span><span class='comma'>,</span> <span class='symbol'>:predicted_time</span> <span class='op'>=&gt;</span> <span class='ivar'>@predictedtime</span> <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='symbol'>:outer_select</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:has_outer</span> <span class='op'>=&gt;</span> <span class='ivar'>@hasouter</span><span class='comma'>,</span> <span class='symbol'>:sort_by</span> <span class='op'>=&gt;</span> <span class='ivar'>@outerorderby</span><span class='comma'>,</span> <span class='symbol'>:offset</span> <span class='op'>=&gt;</span> <span class='ivar'>@outeroffset</span><span class='comma'>,</span> <span class='symbol'>:limit</span> <span class='op'>=&gt;</span> <span class='ivar'>@outerlimit</span><span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='rbrace'>}</span>

  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;Sphinx::Client: %d servers, params: %s&gt;</span><span class='tstring_end'>&quot;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="last_error-instance_method">
  
    - (<tt>String</tt>) <strong>last_error</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='GetLastError-instance_method'>GetLastError</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns last error message, as a string, in human readable format. If there
were no errors during the previous API call, empty string is returned.</p>

<p>You should call it when any other function (such as <span class='object_link'><a href="#query-instance_method" title="Sphinx::Client#query (method)">#query</a></span>) fails
(typically, the failing function returns false). The returned string will
contain the error description.</p>

<p>The error message is not reset by this call; so you can safely call it
several times if needed.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_last_error'>last_error</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>last error message.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#last_warning-instance_method" title="Sphinx::Client#last_warning (method)">#last_warning</a></span></li>
    
      <li><span class='object_link'><a href="#connect_error%3F-instance_method" title="Sphinx::Client#connect_error? (method)">#connect_error?</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


156
157
158</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 156</span>

<span class='kw'>def</span> <span class='id identifier rubyid_last_error'>last_error</span>
  <span class='ivar'>@error</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="last_warning-instance_method">
  
    - (<tt>String</tt>) <strong>last_warning</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='GetLastWarning-instance_method'>GetLastWarning</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns last warning message, as a string, in human readable format. If
there were no warnings during the previous API call, empty string is
returned.</p>

<p>You should call it to verify whether your request (such as <span class='object_link'><a href="#query-instance_method" title="Sphinx::Client#query (method)">#query</a></span>) was
completed but with warnings. For instance, search query against a
distributed index might complete succesfully even if several remote agents
timed out. In that case, a warning message would be produced.</p>

<p>The warning message is not reset by this call; so you can safely call it
several times if needed.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_last_warning'>last_warning</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>last warning message.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#last_error-instance_method" title="Sphinx::Client#last_error (method)">#last_error</a></span></li>
    
      <li><span class='object_link'><a href="#connect_error%3F-instance_method" title="Sphinx::Client#connect_error? (method)">#connect_error?</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


180
181
182</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 180</span>

<span class='kw'>def</span> <span class='id identifier rubyid_last_warning'>last_warning</span>
  <span class='ivar'>@warning</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="open-instance_method">
  
    - (<tt>Boolean</tt>) <strong>open</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='Open-instance_method'>Open</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Opens persistent connection to the server.</p>

<p>This method could be used only when a single searchd server configured.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='kw'>begin</span>
  <span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_open'>open</span>
  <span class='comment'># perform several requests
</span><span class='kw'>ensure</span>
  <span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
<span class='kw'>end</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p><tt>true</tt> when persistent connection has been established; otherwise,
<tt>false</tt>.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#close-instance_method" title="Sphinx::Client#close (method)">#close</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2225
2226
2227
2228
2229
2230
2231
2232
2233
2234
2235
2236
2237
2238
2239
2240
2241
2242
2243
2244</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 2225</span>

<span class='kw'>def</span> <span class='id identifier rubyid_open'>open</span>
  <span class='kw'>if</span> <span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span>
    <span class='ivar'>@error</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>too many servers. persistent socket allowed only for a single server.</span><span class='tstring_end'>'</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_persistent?'>persistent?</span>
    <span class='ivar'>@error</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>already connected</span><span class='tstring_end'>'</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span><span class='semicolon'>;</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_perform_request'>perform_request</span><span class='lparen'>(</span><span class='symbol'>:persist</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_socket'>socket</span><span class='op'>|</span>
    <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_make_persistent!'>make_persistent!</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="perform_request-instance_method">
  
    - (<tt><span class='object_link'>Sphinx::Response</span></tt>) <strong>perform_request</strong>(command, request, additional = nil, server = nil) {|server, socket| ... } <span class="extras">(protected)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Connect, send query, get response.</p>

<p>Use this method to communicate with Sphinx server. It ensures connection
will be instantiated properly, all headers will be generated properly, etc.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>command</span>
      
      
        <span class='type'>(<tt>Symbol</tt>, <tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>searchd command to perform (<tt>:search</tt>, <tt>:excerpt</tt>,
<tt>:update</tt>, <tt>:keywords</tt>, <tt>:persist</tt>, <tt>:status</tt>,
<tt>:query</tt>, <tt>:flushattrs</tt>. See <tt>SEARCHD_COMMAND_*</tt> for
details).</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>request</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Request.html" title="Sphinx::Request (class)">Sphinx::Request</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>contains request body.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>additional</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>Array</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>additional integer or array of integers data to be placed between header
and body.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>server</span>
      
      
        <span class='type'>(<tt><span class='object_link'>Sphinx::Server</span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>where perform request on. This is special parameter for internal usage. If
specified, request will be performed on specified server, and it will try
to establish connection to this server only once.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>if block given, response will not be parsed, plain socket will be yielded
instead. This is special mode used for persistent connections, do not use
for other tasks.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>server</span>
      
      
        <span class='type'>(<tt><span class='object_link'>Sphinx::Server</span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a server where request was performed on.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>socket</span>
      
      
        <span class='type'>(<tt><span class='object_link'>Sphinx::BufferedIO</span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a socket used to perform the request.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'>Sphinx::Response</span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>contains response body.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'>#parse_response</span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2306
2307
2308
2309
2310
2311
2312
2313
2314
2315
2316
2317
2318
2319
2320
2321
2322
2323
2324
2325
2326
2327
2328
2329
2330
2331
2332
2333
2334
2335
2336
2337
2338
2339
2340
2341
2342
2343</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 2306</span>

<span class='kw'>def</span> <span class='id identifier rubyid_perform_request'>perform_request</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='id identifier rubyid_additional'>additional</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_server'>server</span>
    <span class='id identifier rubyid_attempts'>attempts</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_server'>server</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_request'>request</span>
      <span class='kw'>when</span> <span class='const'>String</span>
        <span class='const'>Zlib</span><span class='period'>.</span><span class='id identifier rubyid_crc32'>crc32</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
      <span class='kw'>when</span> <span class='const'>Request</span>
        <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_crc32'>crc32</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>request argument must be String or Sphinx::Request</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_attempts'>attempts</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_with_server'>with_server</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='comma'>,</span> <span class='id identifier rubyid_attempts'>attempts</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_srv'>srv</span><span class='op'>|</span>
    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[sphinx] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_command'>command</span><span class='rbrace'>}</span><span class='tstring_content'> on server </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_srv'>srv</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span>

    <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='id identifier rubyid_command'>command</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_upcase'>upcase</span>
    <span class='id identifier rubyid_command_id'>command_id</span> <span class='op'>=</span> <span class='const'>Sphinx</span><span class='op'>::</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_const_get'>const_get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SEARCHD_COMMAND_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_command_ver'>command_ver</span> <span class='op'>=</span> <span class='const'>Sphinx</span><span class='op'>::</span><span class='const'>Client</span><span class='period'>.</span><span class='id identifier rubyid_const_get'>const_get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>VER_COMMAND_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_with_socket'>with_socket</span><span class='lparen'>(</span><span class='id identifier rubyid_srv'>srv</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_socket'>socket</span><span class='op'>|</span>
      <span class='id identifier rubyid_additional'>additional</span> <span class='op'>=</span> <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_additional'>additional</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_len'>len</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='id identifier rubyid_additional'>additional</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>*</span> <span class='int'>4</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_header'>header</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_command_id'>command_id</span><span class='comma'>,</span> <span class='id identifier rubyid_command_ver'>command_ver</span><span class='comma'>,</span> <span class='id identifier rubyid_len'>len</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>nnN</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_header'>header</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_additional'>additional</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>N</span><span class='tstring_end'>'</span></span> <span class='op'>*</span> <span class='id identifier rubyid_additional'>additional</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_additional'>additional</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

      <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='id identifier rubyid_header'>header</span> <span class='op'>+</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rparen'>)</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
        <span class='kw'>yield</span> <span class='id identifier rubyid_srv'>srv</span><span class='comma'>,</span> <span class='id identifier rubyid_socket'>socket</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_parse_response'>parse_response</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='comma'>,</span> <span class='id identifier rubyid_command_ver'>command_ver</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="query-instance_method">
  
    - (<tt>Hash</tt>, <tt>false</tt>) <strong>query</strong>(query, index = '*', comment = '') {|Client| ... }
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='Query-instance_method'>Query</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Connects to searchd server, runs given search query with current settings,
obtains and returns the result set.</p>

<p><tt>query</tt> is a query string. <tt>index</tt> is an index name (or
names) string. Returns false and sets <span class='object_link'><a href="#last_error-instance_method" title="Sphinx::Client#last_error (method)">#last_error</a></span> message on general
error. Returns search result set on success. Additionally, the contents of
<tt>comment</tt> are sent to the query log, marked in square brackets, just
before the search terms, which can be very useful for debugging. Currently,
the comment is limited to 128 characters.</p>

<p>Default value for <tt>index</tt> is <tt>&quot;*&quot;</tt> that means to
query all local indexes. Characters allowed in index names include Latin
letters (a-z), numbers (0-9), minus sign (-), and underscore (_);
everything else is considered a separator. Therefore, all of the following
samples calls are valid and will search the same two indexes:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>test query</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>main delta</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>test query</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>main;delta</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>test query</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>main, delta</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='semicolon'>;</span></code></pre>

<p>Index specification order matters. If document with identical IDs are found
in two or more indexes, weight and attribute values from the very last
matching index will be used for sorting and returning to client (unless
explicitly overridden with <span class='object_link'><a href="#set_index_weights-instance_method" title="Sphinx::Client#set_index_weights (method)">#set_index_weights</a></span>). Therefore, in the example
above, matches from "delta" index will always win over matches from "main".</p>

<p>On success, <span class='object_link'><a href="#query-instance_method" title="Sphinx::Client#query (method)">#query</a></span> returns a result set that contains some of the found
matches (as requested by <span class='object_link'><a href="#set_limits-instance_method" title="Sphinx::Client#set_limits (method)">#set_limits</a></span>) and additional general per-query
statistics. The result set is an <tt>Hash</tt> with the following keys and
values:</p>
<table class="rdoc-list"><tr><td class="rdoc-term"><p><tt>&quot;matches&quot;</tt></p></td>
<td>
<p>Array with small <tt>Hash</tt>es containing document weight and attribute values.</p>
</td></tr><tr><td class="rdoc-term"><p><tt>&quot;total&quot;</tt></p></td>
<td>
<p>Total amount of matches retrieved on server (ie. to the server side result
set) by this query. You can retrieve up to this amount of matches from
server for this query text with current query settings.</p>
</td></tr><tr><td class="rdoc-term"><p><tt>&quot;total_found&quot;</tt></p></td>
<td>
<p>Total amount of matching documents in index (that were found and procesed
on server).</p>
</td></tr><tr><td class="rdoc-term"><p><tt>&quot;words&quot;</tt></p></td>
<td>
<p>Hash which maps query keywords (case-folded, stemmed, and otherwise
processed) to a small Hash with per-keyword statitics ("docs", "hits").</p>
</td></tr><tr><td class="rdoc-term"><p><tt>&quot;error&quot;</tt></p></td>
<td>
<p>Query error message reported by searchd (string, human readable). Empty if
there were no errors.</p>
</td></tr><tr><td class="rdoc-term"><p><tt>&quot;warning&quot;</tt></p></td>
<td>
<p>Query warning message reported by searchd (string, human readable). Empty
if there were no warnings.</p>
</td></tr></table>

<p>Please note: you can use both strings and symbols as <tt>Hash</tt> keys.</p>

<p>It should be noted that <span class='object_link'><a href="#query-instance_method" title="Sphinx::Client#query (method)">#query</a></span> carries out the same actions as
<span class='object_link'><a href="#add_query-instance_method" title="Sphinx::Client#add_query (method)">#add_query</a></span> and <span class='object_link'><a href="#run_queries-instance_method" title="Sphinx::Client#run_queries (method)">#run_queries</a></span> without the intermediate steps; it is
analoguous to a single <span class='object_link'><a href="#add_query-instance_method" title="Sphinx::Client#add_query (method)">#add_query</a></span> call, followed by a corresponding
<span class='object_link'><a href="#run_queries-instance_method" title="Sphinx::Client#run_queries (method)">#run_queries</a></span>, then returning the first array element of matches (from the
first, and only, query.)</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Regular query with previously set filters</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>some search text</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>*</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>search page</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span></code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Query with block</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>test</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sphinx'>sphinx</span><span class='op'>|</span>
  <span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_match_mode'>set_match_mode</span> <span class='symbol'>:all</span>
  <span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_id_range'>set_id_range</span> <span class='int'>10</span><span class='comma'>,</span> <span class='int'>100</span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Query with instant filters configuring</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>test</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_match_mode'>match_mode</span> <span class='symbol'>:all</span>
  <span class='id identifier rubyid_id_range'>id_range</span> <span class='int'>10</span><span class='comma'>,</span> <span class='int'>100</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>query</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a query string.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>index</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>'*'</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>an index name (or names).</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>comment</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>''</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>a comment to be sent to the query log.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>yields just before query performing. Useful to set filters or sortings.
When block does not accept any parameters, it will be eval'ed inside
<span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span> instance itself. In this case you can omit <tt>set_</tt> prefix
for configuration methods.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>sphinx</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>, <tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>result set described above or <tt>false</tt> on error.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-query" target="_parent" title="Section 6.6.1, &quot;Query&quot;">Section 6.6.1, "Query"</a></li>
    
      <li><span class='object_link'><a href="#add_query-instance_method" title="Sphinx::Client#add_query (method)">#add_query</a></span></li>
    
      <li><span class='object_link'><a href="#run_queries-instance_method" title="Sphinx::Client#run_queries (method)">#run_queries</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1454
1455
1456
1457
1458
1459
1460
1461
1462
1463
1464
1465
1466
1467
1468
1469
1470
1471
1472
1473
1474
1475
1476
1477
1478
1479
1480
1481
1482
1483</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1454</span>

<span class='kw'>def</span> <span class='id identifier rubyid_query'>query</span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>*</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_comment'>comment</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='ivar'>@reqs</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_arity'>arity</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='kw'>yield</span> <span class='kw'>self</span>
    <span class='kw'>else</span>
      <span class='kw'>begin</span>
        <span class='ivar'>@inside_eval</span> <span class='op'>=</span> <span class='kw'>true</span>
        <span class='id identifier rubyid_instance_eval'>instance_eval</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
      <span class='kw'>ensure</span>
        <span class='ivar'>@inside_eval</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[sphinx] query('</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_query'>query</span><span class='rbrace'>}</span><span class='tstring_content'>', '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_index'>index</span><span class='rbrace'>}</span><span class='tstring_content'>', '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_comment'>comment</span><span class='rbrace'>}</span><span class='tstring_content'>'), </span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_add_query'>add_query</span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_comment'>comment</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_run_queries'>run_queries</span>

  <span class='comment'># probably network error; error message should be already filled
</span>  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_instance_of?'>instance_of?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span>

  <span class='ivar'>@error</span> <span class='op'>=</span> <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>error</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
  <span class='ivar'>@warning</span> <span class='op'>=</span> <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>warning</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>

  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>status</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='const'>SEARCHD_ERROR</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_results'>results</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_filters-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>reset_filters</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='ResetFilters-instance_method'>ResetFilters</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Clears all currently set filters.</p>

<p>This call is only normally required when using multi-queries. You might
want to set different filters for different queries in the batch. To do
that, you should call <span class='object_link'><a href="#reset_filters-instance_method" title="Sphinx::Client#reset_filters (method)">#reset_filters</a></span> and add new filters using the
respective calls.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_reset_filters'>reset_filters</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#set_filter-instance_method" title="Sphinx::Client#set_filter (method)">#set_filter</a></span></li>
    
      <li><span class='object_link'><a href="#set_filter_range-instance_method" title="Sphinx::Client#set_filter_range (method)">#set_filter_range</a></span></li>
    
      <li><span class='object_link'><a href="#set_filter_float_range-instance_method" title="Sphinx::Client#set_filter_float_range (method)">#set_filter_float_range</a></span></li>
    
      <li><span class='object_link'><a href="#set_geo_anchor-instance_method" title="Sphinx::Client#set_geo_anchor (method)">#set_geo_anchor</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1293
1294
1295
1296
1297</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1293</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_filters'>reset_filters</span>
  <span class='ivar'>@filters</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@anchor</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_group_by-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>reset_group_by</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='ResetGroupBy-instance_method'>ResetGroupBy</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Clears all currently group-by settings, and disables group-by.</p>

<p>This call is only normally required when using multi-queries. You can
change individual group-by settings using <span class='object_link'><a href="#set_group_by-instance_method" title="Sphinx::Client#set_group_by (method)">#set_group_by</a></span> and
<span class='object_link'><a href="#set_group_distinct-instance_method" title="Sphinx::Client#set_group_distinct (method)">#set_group_distinct</a></span> calls, but you can not disable group-by using those
calls. <span class='object_link'><a href="#reset_group_by-instance_method" title="Sphinx::Client#reset_group_by (method)">#reset_group_by</a></span> fully resets previous group-by settings and
disables group-by mode in the current state, so that subsequent
<span class='object_link'><a href="#add_query-instance_method" title="Sphinx::Client#add_query (method)">#add_query</a></span> calls can perform non-grouping searches.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_reset_group_by'>reset_group_by</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#set_group_by-instance_method" title="Sphinx::Client#set_group_by (method)">#set_group_by</a></span></li>
    
      <li><span class='object_link'><a href="#set_group_distinct-instance_method" title="Sphinx::Client#set_group_distinct (method)">#set_group_distinct</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1317
1318
1319
1320
1321
1322
1323</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1317</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_group_by'>reset_group_by</span>
  <span class='ivar'>@groupby</span>       <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
  <span class='ivar'>@groupfunc</span>     <span class='op'>=</span> <span class='const'>SPH_GROUPBY_DAY</span>
  <span class='ivar'>@groupsort</span>     <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>@group desc</span><span class='tstring_end'>'</span></span>
  <span class='ivar'>@groupdistinct</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_outer_select-instance_method">
  
    - (<tt>Object</tt>) <strong>reset_outer_select</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='ResetOuterSelect-instance_method'>ResetOuterSelect</span></span>
    </span>
  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1353
1354
1355
1356
1357
1358
1359</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1353</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_outer_select'>reset_outer_select</span>
  <span class='ivar'>@outerorderby</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
  <span class='ivar'>@outeroffset</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@outerlimit</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@hasouter</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_overrides-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>reset_overrides</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='ResetOverrides-instance_method'>ResetOverrides</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Clear all attribute value overrides (for multi-queries).</p>

<p>This call is only normally required when using multi-queries. You might
want to set field overrides for different queries in the batch. To do that,
you should call <span class='object_link'><a href="#reset_overrides-instance_method" title="Sphinx::Client#reset_overrides (method)">#reset_overrides</a></span> and add new overrides using the
respective calls.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_reset_overrides'>reset_overrides</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#set_override-instance_method" title="Sphinx::Client#set_override (method)">#set_override</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1340
1341
1342
1343</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1340</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_overrides'>reset_overrides</span>
  <span class='ivar'>@overrides</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_query_flag-instance_method">
  
    - (<tt>Object</tt>) <strong>reset_query_flag</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='ResetQueryFlag-instance_method'>ResetQueryFlag</span></span>
    </span>
  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1346
1347
1348
1349
1350</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1346</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_query_flag'>reset_query_flag</span>
  <span class='ivar'>@query_flags</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@predictedtime</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="run_queries-instance_method">
  
    - (<tt>Array&lt;Hash&gt;</tt>) <strong>run_queries</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='RunQueries-instance_method'>RunQueries</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Connect to searchd, runs a batch of all queries added using <span class='object_link'><a href="#add_query-instance_method" title="Sphinx::Client#add_query (method)">#add_query</a></span>,
obtains and returns the result sets. Returns <tt>false</tt> and sets
<span class='object_link'><a href="#last_error-instance_method" title="Sphinx::Client#last_error (method)">#last_error</a></span> message on general error (such as network I/O failure).
Returns a plain array of result sets on success.</p>

<p>Each result set in the returned array is exactly the same as the result set
returned from <span class='object_link'><a href="#query-instance_method" title="Sphinx::Client#query (method)">#query</a></span>.</p>

<p>Note that the batch query request itself almost always succeds ??? unless
there's a network error, blocking index rotation in progress, or another
general failure which prevents the whole request from being processed.</p>

<p>However individual queries within the batch might very well fail. In this
case their respective result sets will contain non-empty "error" message,
but no matches or query statistics. In the extreme case all queries within
the batch could fail. There still will be no general error reported,
because API was able to succesfully connect to searchd, submit the batch,
and receive the results ??? but every result set will have a specific error
message.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_add_query'>add_query</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>some search text</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>*</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>search page</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_run_queries'>run_queries</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an <tt>Array</tt> of <tt>Hash</tt>es which are exactly the same as the result set
returned from <span class='object_link'><a href="#query-instance_method" title="Sphinx::Client#query (method)">#query</a></span>.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-runqueries" target="_parent" title="Section 6.6.3, &quot;RunQueries&quot;">Section 6.6.3, "RunQueries"</a></li>
    
      <li><span class='object_link'><a href="#add_query-instance_method" title="Sphinx::Client#add_query (method)">#add_query</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1717
1718
1719
1720
1721
1722
1723
1724
1725
1726
1727
1728
1729
1730
1731
1732
1733
1734
1735
1736
1737
1738
1739
1740
1741
1742
1743
1744
1745
1746
1747
1748
1749
1750
1751
1752
1753
1754
1755
1756
1757
1758
1759
1760
1761
1762
1763
1764
1765
1766
1767
1768
1769
1770
1771
1772
1773
1774
1775
1776
1777
1778
1779
1780
1781
1782
1783
1784
1785
1786
1787
1788
1789
1790
1791
1792
1793
1794
1795
1796
1797
1798
1799
1800
1801
1802
1803
1804
1805
1806
1807
1808
1809
1810
1811</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1717</span>

<span class='kw'>def</span> <span class='id identifier rubyid_run_queries'>run_queries</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[sphinx] run_queries(</span><span class='embexpr_beg'>#{</span><span class='ivar'>@reqs</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rbrace'>}</span><span class='tstring_content'> queries)</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span>
  <span class='kw'>if</span> <span class='ivar'>@reqs</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='ivar'>@error</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>No queries defined, issue add_query() first</span><span class='tstring_end'>'</span></span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_reqs'>reqs</span><span class='comma'>,</span> <span class='id identifier rubyid_nreqs'>nreqs</span> <span class='op'>=</span> <span class='ivar'>@reqs</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='ivar'>@reqs</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='ivar'>@reqs</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='id identifier rubyid_perform_request'>perform_request</span><span class='lparen'>(</span><span class='symbol'>:search</span><span class='comma'>,</span> <span class='id identifier rubyid_reqs'>reqs</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_nreqs'>nreqs</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='comment'># parse response
</span>  <span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_nreqs'>nreqs</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='const'>HashWithIndifferentAccess</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:error</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:warning</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>

    <span class='comment'># extract status
</span>    <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int'>get_int</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>!=</span> <span class='const'>SEARCHD_OK</span>
      <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_string'>get_string</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_status'>status</span> <span class='op'>==</span> <span class='const'>SEARCHD_WARNING</span>
        <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='symbol'>:warning</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_message'>message</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_message'>message</span>
        <span class='kw'>next</span> <span class='id identifier rubyid_result'>result</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='comment'># read schema
</span>    <span class='id identifier rubyid_nfields'>nfields</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int'>get_int</span>
    <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='symbol'>:fields</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_nfields'>nfields</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_string'>get_string</span> <span class='rbrace'>}</span>

    <span class='id identifier rubyid_attrs_names_in_order'>attrs_names_in_order</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_nattrs'>nattrs</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int'>get_int</span>
    <span class='id identifier rubyid_attrs'>attrs</span> <span class='op'>=</span> <span class='id identifier rubyid_nattrs'>nattrs</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='const'>HashWithIndifferentAccess</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
      <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_string'>get_string</span><span class='comma'>,</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int'>get_int</span>
      <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_type'>type</span>
      <span class='id identifier rubyid_attrs_names_in_order'>attrs_names_in_order</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_name'>name</span>
      <span class='id identifier rubyid_hash'>hash</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='symbol'>:attrs</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_attrs'>attrs</span>

    <span class='comment'># read match count
</span>    <span class='id identifier rubyid_count'>count</span><span class='comma'>,</span> <span class='id identifier rubyid_id64'>id64</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_ints'>get_ints</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>

    <span class='comment'># read matches
</span>    <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='symbol'>:matches</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_count'>count</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='id identifier rubyid_id64'>id64</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>?</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int'>get_int</span> <span class='op'>:</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int64'>get_int64</span>
      <span class='id identifier rubyid_weight'>weight</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int'>get_int</span>

      <span class='comment'># This is a single result put in the result['matches'] array
</span>      <span class='id identifier rubyid_match'>match</span> <span class='op'>=</span> <span class='const'>HashWithIndifferentAccess</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_doc'>doc</span><span class='comma'>,</span> <span class='symbol'>:weight</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_weight'>weight</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_match'>match</span><span class='lbracket'>[</span><span class='symbol'>:attrs</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_attrs_names_in_order'>attrs_names_in_order</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='const'>HashWithIndifferentAccess</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='op'>|</span>
        <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span>
          <span class='kw'>when</span> <span class='const'>SPH_ATTR_BIGINT</span>
            <span class='comment'># handle 64-bit ints
</span>            <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int64'>get_int64</span>
          <span class='kw'>when</span> <span class='const'>SPH_ATTR_FLOAT</span>
            <span class='comment'># handle floats
</span>            <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_float'>get_float</span>
          <span class='kw'>when</span> <span class='const'>SPH_ATTR_STRING</span>
            <span class='comment'># handle string
</span>            <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_string'>get_string</span>
          <span class='kw'>when</span> <span class='const'>SPH_ATTR_FACTORS</span>
            <span class='comment'># ???
</span>            <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int'>get_int</span>
          <span class='kw'>when</span> <span class='const'>SPH_ATTR_MULTI</span>
            <span class='comment'># handle array of integers
</span>            <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int'>get_int</span>
            <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_ints'>get_ints</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>&gt;</span> <span class='int'>0</span>
          <span class='kw'>when</span> <span class='const'>SPH_ATTR_MULTI64</span>
            <span class='comment'># handle array of 64-bit integers
</span>            <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int'>get_int</span>
            <span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span> <span class='op'>/</span> <span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int64'>get_int64</span> <span class='rbrace'>}</span>
          <span class='kw'>else</span>
            <span class='comment'># handle everything else as unsigned ints
</span>            <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int'>get_int</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_hash'>hash</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_match'>match</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='symbol'>:total</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='symbol'>:total_found</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_msecs'>msecs</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_ints'>get_ints</span><span class='lparen'>(</span><span class='int'>3</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='symbol'>:time</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%.3f</span><span class='tstring_end'>'</span></span> <span class='op'>%</span> <span class='lparen'>(</span><span class='id identifier rubyid_msecs'>msecs</span> <span class='op'>/</span> <span class='float'>1000.0</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_nwords'>nwords</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int'>get_int</span>
    <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='symbol'>:words</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_nwords'>nwords</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='comma'>,</span> <span class='id identifier rubyid_idx'>idx</span><span class='op'>|</span>
      <span class='id identifier rubyid_word'>word</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_string'>get_string</span>
      <span class='id identifier rubyid_docs'>docs</span><span class='comma'>,</span> <span class='id identifier rubyid_hits'>hits</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_ints'>get_ints</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='id identifier rubyid_word'>word</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>HashWithIndifferentAccess</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:docs</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_docs'>docs</span><span class='comma'>,</span> <span class='symbol'>:hits</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_hits'>hits</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_hash'>hash</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_result'>result</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_bit-instance_method">
  
    - (<tt>Object</tt>) <strong>set_bit</strong>(bitset, index, value)  <span class="extras">(protected)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets or resets given bit in a bitset.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>bitset</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>integer value to set bit in.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>index</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>integer offset of the bit to set.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Boolean</tt>, <tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>value to set bit into (<tt>true</tt>, <tt>false</tt>, <tt>0</tt>, or
<tt>1</tt>).</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2577
2578
2579
2580
2581
2582
2583
2584
2585</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 2577</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_bit'>set_bit</span><span class='lparen'>(</span><span class='id identifier rubyid_bitset'>bitset</span><span class='comma'>,</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bit'>bit</span> <span class='op'>=</span> <span class='int'>1</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_index'>index</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>==</span> <span class='kw'>true</span> <span class='op'>||</span> <span class='id identifier rubyid_value'>value</span> <span class='op'>==</span> <span class='int'>1</span>
    <span class='id identifier rubyid_bitset'>bitset</span> <span class='op'>|=</span> <span class='id identifier rubyid_bit'>bit</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_bitset'>bitset</span> <span class='op'>&amp;</span> <span class='id identifier rubyid_bit'>bit</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id identifier rubyid_bitset'>bitset</span> <span class='op'>^=</span> <span class='id identifier rubyid_bit'>bit</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_bitset'>bitset</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_connect_timeout-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_connect_timeout</strong>(timeout, retries = 1) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetConnectTimeout-instance_method'>SetConnectTimeout</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets the time allowed to spend connecting to the server before giving up
and number of retries to perform.</p>

<p>In the event of a failure to connect, an appropriate error code should be
returned back to the application in order for application-level error
handling to advise the user.</p>

<p>When multiple servers configured through <span class='object_link'><a href="#set_servers-instance_method" title="Sphinx::Client#set_servers (method)">#set_servers</a></span> method, and
<tt>retries</tt> number is greater than 1, library will try to connect to
another server. In case of single server configured, it will try to
reconnect <tt>retries</tt> times.</p>

<p>Please note, this timeout will only be used for connection establishing,
not for regular API requests.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Set connection timeout to 1 second and number of retries to 5</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_connect_timeout'>set_connect_timeout</span><span class='lparen'>(</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>5</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>timeout</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a connection timeout in seconds.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>retries</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>1</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>number of connect retries.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#set_server-instance_method" title="Sphinx::Client#set_server (method)">#set_server</a></span></li>
    
      <li><span class='object_link'><a href="#set_servers-instance_method" title="Sphinx::Client#set_servers (method)">#set_servers</a></span></li>
    
      <li><span class='object_link'><a href="#set_request_timeout-instance_method" title="Sphinx::Client#set_request_timeout (method)">#set_request_timeout</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


333
334
335
336
337
338
339
340
341</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 333</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_connect_timeout'>set_connect_timeout</span><span class='lparen'>(</span><span class='id identifier rubyid_timeout'>timeout</span><span class='comma'>,</span> <span class='id identifier rubyid_retries'>retries</span> <span class='op'>=</span> <span class='int'>1</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;timeout&quot; argument must be Integer</span><span class='tstring_end'>'</span></span>        <span class='kw'>unless</span> <span class='id identifier rubyid_timeout'>timeout</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;retries&quot; argument must be Integer</span><span class='tstring_end'>'</span></span>        <span class='kw'>unless</span> <span class='id identifier rubyid_retries'>retries</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;retries&quot; argument must be greater than 0</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_retries'>retries</span> <span class='op'>&gt;</span> <span class='int'>0</span>

  <span class='ivar'>@timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_timeout'>timeout</span>
  <span class='ivar'>@retries</span> <span class='op'>=</span> <span class='id identifier rubyid_retries'>retries</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_field_weights-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_field_weights</strong>(weights) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetFieldWeights-instance_method'>SetFieldWeights</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Binds per-field weights by name. Parameter must be a <tt>Hash</tt> mapping
string field names to integer weights.</p>

<p>Match ranking can be affected by per-field weights. For instance, see
Section 4.4, "Weighting" for an explanation how phrase proximity ranking is
affected. This call lets you specify what non-default weights to assign to
different full-text fields.</p>

<p>The weights must be positive 32-bit integers. The final weight will be a
32-bit integer too. Default weight value is 1. Unknown field names will be
silently ignored.</p>

<p>There is no enforced limit on the maximum weight value at the moment.
However, beware that if you set it too high you can start hitting 32-bit
wraparound issues. For instance, if you set a weight of 10,000,000 and
search in extended mode, then maximum possible weight will be equal to 10
million (your weight) by 1 thousand (internal BM25 scaling factor, see
Section 4.4, ???Weighting???) by 1 or more (phrase proximity rank). The
result is at least 10 billion that does not fit in 32 bits and will be
wrapped around, producing unexpected results.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_field_weights'>set_field_weights</span><span class='lparen'>(</span><span class='symbol'>:title</span> <span class='op'>=&gt;</span> <span class='int'>20</span><span class='comma'>,</span> <span class='symbol'>:text</span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>weights</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a <tt>Hash</tt> mapping string field names to integer weights.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#weighting" target="_parent" title="Section 4.4, &quot;Weighting&quot;">Section 4.4, "Weighting"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setfieldweights" target="_parent" title="Section 6.3.5, &quot;SetFieldWeights&quot;">Section 6.3.5, "SetFieldWeights"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


882
883
884
885
886
887
888
889
890
891
892</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 882</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_field_weights'>set_field_weights</span><span class='lparen'>(</span><span class='id identifier rubyid_weights'>weights</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;weights&quot; argument must be Hash</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_weight'>weight</span><span class='op'>|</span>
    <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id identifier rubyid_weight'>weight</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;weights&quot; argument must be Hash map of strings to integers</span><span class='tstring_end'>'</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='ivar'>@fieldweights</span> <span class='op'>=</span> <span class='id identifier rubyid_weights'>weights</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_filter-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_filter</strong>(attribute, values, exclude = false) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetFilter-instance_method'>SetFilter</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Adds new integer values set filter.</p>

<p>On this call, additional new filter is added to the existing list of
filters. $attribute must be a string with attribute name. <tt>values</tt>
must be a plain array containing integer values. <tt>exclude</tt> must be a
boolean value; it controls whether to accept the matching documents
(default mode, when <tt>exclude</tt> is <tt>false</tt>) or reject them.</p>

<p>Only those documents where <tt>attribute</tt> column value stored in the
index matches any of the values from <tt>values</tt> array will be matched
(or rejected, if <tt>exclude</tt> is <tt>true</tt>).</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_filter'>set_filter</span><span class='lparen'>(</span><span class='symbol'>:group_id</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>10</span><span class='comma'>,</span> <span class='int'>15</span><span class='comma'>,</span> <span class='int'>20</span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_filter'>set_filter</span><span class='lparen'>(</span><span class='symbol'>:group_id</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>10</span><span class='comma'>,</span> <span class='int'>15</span><span class='comma'>,</span> <span class='int'>20</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>attribute</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an attribute name to filter by.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>values</span>
      
      
        <span class='type'>(<tt>Array&lt;Integer&gt;</tt>, <tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an <tt>Array</tt> of integers or single Integer with given attribute
values.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>exclude</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>indicating whether documents with given attribute matching specified values
should be excluded from search results.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setfilter" target="_parent" title="Section 6.4.2, &quot;SetFilter&quot;">Section 6.4.2, "SetFilter"</a></li>
    
      <li><span class='object_link'><a href="#set_filter_range-instance_method" title="Sphinx::Client#set_filter_range (method)">#set_filter_range</a></span></li>
    
      <li><span class='object_link'><a href="#set_filter_float_range-instance_method" title="Sphinx::Client#set_filter_float_range (method)">#set_filter_float_range</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1004</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_filter'>set_filter</span><span class='lparen'>(</span><span class='id identifier rubyid_attribute'>attribute</span><span class='comma'>,</span> <span class='id identifier rubyid_values'>values</span><span class='comma'>,</span> <span class='id identifier rubyid_exclude'>exclude</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;attribute&quot; argument must be String or Symbol</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_values'>values</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;values&quot; argument must be Array</span><span class='tstring_end'>'</span></span>               <span class='kw'>unless</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;values&quot; argument must be Array of Integers</span><span class='tstring_end'>'</span></span>   <span class='kw'>unless</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_all?'>all?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;exclude&quot; argument must be Boolean</span><span class='tstring_end'>'</span></span>            <span class='kw'>unless</span> <span class='lbracket'>[</span><span class='const'>TrueClass</span><span class='comma'>,</span> <span class='const'>FalseClass</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_exclude'>exclude</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
    <span class='ivar'>@filters</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='const'>SPH_FILTER_VALUES</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>attr</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>exclude</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_exclude'>exclude</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>values</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_values'>values</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_filter_float_range-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_filter_float_range</strong>(attribute, min, max, exclude = false) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetFilterFloatRange-instance_method'>SetFilterFloatRange</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Adds new float range filter.</p>

<p>On this call, additional new filter is added to the existing list of
filters. <tt>attribute</tt> must be a string with attribute name.
<tt>min</tt> and <tt>max</tt> must be floats that define the acceptable
attribute values range (including the boundaries). <tt>exclude</tt> must be
a boolean value; it controls whether to accept the matching documents
(default mode, when <tt>exclude</tt> is false) or reject them.</p>

<p>Only those documents where <tt>attribute</tt> column value stored in the
index is between <tt>min</tt> and <tt>max</tt> (including values that are
exactly equal to <tt>min</tt> or <tt>max</tt>) will be matched (or
rejected, if <tt>exclude</tt> is true).</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_filter_float_range'>set_filter_float_range</span><span class='lparen'>(</span><span class='symbol'>:group_id</span><span class='comma'>,</span> <span class='float'>10.5</span><span class='comma'>,</span> <span class='int'>20</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_filter_float_range'>set_filter_float_range</span><span class='lparen'>(</span><span class='symbol'>:group_id</span><span class='comma'>,</span> <span class='float'>10.5</span><span class='comma'>,</span> <span class='int'>20</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>attribute</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an attribute name to filter by.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>min</span>
      
      
        <span class='type'>(<tt>Numeric</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>min value of the given attribute.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>max</span>
      
      
        <span class='type'>(<tt>Numeric</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>max value of the given attribute.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>exclude</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>indicating whether documents with given attribute matching specified
boundaries should be excluded from search results.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setfilterfloatrange" target="_parent" title="Section 6.4.4, &quot;SetFilterFloatRange&quot;">Section 6.4.4, "SetFilterFloatRange"</a></li>
    
      <li><span class='object_link'><a href="#set_filter-instance_method" title="Sphinx::Client#set_filter (method)">#set_filter</a></span></li>
    
      <li><span class='object_link'><a href="#set_filter_range-instance_method" title="Sphinx::Client#set_filter_range (method)">#set_filter_range</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1093
1094
1095
1096
1097
1098
1099
1100
1101
1102</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1093</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_filter_float_range'>set_filter_float_range</span><span class='lparen'>(</span><span class='id identifier rubyid_attribute'>attribute</span><span class='comma'>,</span> <span class='id identifier rubyid_min'>min</span><span class='comma'>,</span> <span class='id identifier rubyid_max'>max</span><span class='comma'>,</span> <span class='id identifier rubyid_exclude'>exclude</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;attribute&quot; argument must be String or Symbol</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;min&quot; argument must be Numeric</span><span class='tstring_end'>'</span></span>                <span class='kw'>unless</span> <span class='id identifier rubyid_min'>min</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Numeric</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;max&quot; argument must be Numeric</span><span class='tstring_end'>'</span></span>                <span class='kw'>unless</span> <span class='id identifier rubyid_max'>max</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Numeric</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;max&quot; argument greater or equal to &quot;min&quot;</span><span class='tstring_end'>'</span></span>      <span class='kw'>unless</span> <span class='id identifier rubyid_min'>min</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_max'>max</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;exclude&quot; argument must be Boolean</span><span class='tstring_end'>'</span></span>            <span class='kw'>unless</span> <span class='id identifier rubyid_exclude'>exclude</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_exclude'>exclude</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>FalseClass</span><span class='rparen'>)</span>

  <span class='ivar'>@filters</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='const'>SPH_FILTER_FLOATRANGE</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>attr</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>exclude</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_exclude'>exclude</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>min</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_min'>min</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>max</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_max'>max</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='rbrace'>}</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_filter_range-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_filter_range</strong>(attribute, min, max, exclude = false) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetFilterRange-instance_method'>SetFilterRange</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Adds new integer range filter.</p>

<p>On this call, additional new filter is added to the existing list of
filters. <tt>attribute</tt> must be a string with attribute name.
<tt>min</tt> and <tt>max</tt> must be integers that define the acceptable
attribute values range (including the boundaries). <tt>exclude</tt> must be
a boolean value; it controls whether to accept the matching documents
(default mode, when <tt>exclude</tt> is false) or reject them.</p>

<p>Only those documents where <tt>attribute</tt> column value stored in the
index is between <tt>min</tt> and <tt>max</tt> (including values that are
exactly equal to <tt>min</tt> or <tt>max</tt>) will be matched (or
rejected, if <tt>exclude</tt> is true).</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_filter_range'>set_filter_range</span><span class='lparen'>(</span><span class='symbol'>:group_id</span><span class='comma'>,</span> <span class='int'>10</span><span class='comma'>,</span> <span class='int'>20</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_filter_range'>set_filter_range</span><span class='lparen'>(</span><span class='symbol'>:group_id</span><span class='comma'>,</span> <span class='int'>10</span><span class='comma'>,</span> <span class='int'>20</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>attribute</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an attribute name to filter by.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>min</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>min value of the given attribute.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>max</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>max value of the given attribute.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>exclude</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>indicating whether documents with given attribute matching specified
boundaries should be excluded from search results.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setfilterrange" target="_parent" title="Section 6.4.3, &quot;SetFilterRange&quot;">Section 6.4.3, "SetFilterRange"</a></li>
    
      <li><span class='object_link'><a href="#set_filter-instance_method" title="Sphinx::Client#set_filter (method)">#set_filter</a></span></li>
    
      <li><span class='object_link'><a href="#set_filter_float_range-instance_method" title="Sphinx::Client#set_filter_float_range (method)">#set_filter_float_range</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1050
1051
1052
1053
1054
1055
1056
1057
1058
1059</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1050</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_filter_range'>set_filter_range</span><span class='lparen'>(</span><span class='id identifier rubyid_attribute'>attribute</span><span class='comma'>,</span> <span class='id identifier rubyid_min'>min</span><span class='comma'>,</span> <span class='id identifier rubyid_max'>max</span><span class='comma'>,</span> <span class='id identifier rubyid_exclude'>exclude</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;attribute&quot; argument must be String or Symbol</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;min&quot; argument must be Integer</span><span class='tstring_end'>'</span></span>                <span class='kw'>unless</span> <span class='id identifier rubyid_min'>min</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;max&quot; argument must be Integer</span><span class='tstring_end'>'</span></span>                <span class='kw'>unless</span> <span class='id identifier rubyid_max'>max</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;max&quot; argument greater or equal to &quot;min&quot;</span><span class='tstring_end'>'</span></span>      <span class='kw'>unless</span> <span class='id identifier rubyid_min'>min</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_max'>max</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;exclude&quot; argument must be Boolean</span><span class='tstring_end'>'</span></span>            <span class='kw'>unless</span> <span class='id identifier rubyid_exclude'>exclude</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_exclude'>exclude</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>FalseClass</span><span class='rparen'>)</span>

  <span class='ivar'>@filters</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='const'>SPH_FILTER_RANGE</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>attr</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>exclude</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_exclude'>exclude</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>min</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_min'>min</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>max</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_max'>max</span> <span class='rbrace'>}</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_geo_anchor-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_geo_anchor</strong>(attrlat, attrlong, lat, long) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetGeoAnchor-instance_method'>SetGeoAnchor</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets anchor point for and geosphere distance (geodistance) calculations,
and enable them.</p>

<p><tt>attrlat</tt> and <tt>attrlong</tt> must be strings that contain the
names of latitude and longitude attributes, respectively. <tt>lat</tt> and
<tt>long</tt> are floats that specify anchor point latitude and longitude,
in radians.</p>

<p>Once an anchor point is set, you can use magic
<tt>&quot;@geodist&quot;</tt> attribute name in your filters and/or sorting
expressions. Sphinx will compute geosphere distance between the given
anchor point and a point specified by latitude and lognitude attributes
from each full-text match, and attach this value to the resulting match.
The latitude and longitude values both in <span class='object_link'><a href="#set_geo_anchor-instance_method" title="Sphinx::Client#set_geo_anchor (method)">#set_geo_anchor</a></span> and the index
attribute data are expected to be in radians. The result will be returned
in meters, so geodistance value of 1000.0 means 1 km. 1 mile is
approximately 1609.344 meters.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_geo_anchor'>set_geo_anchor</span><span class='lparen'>(</span><span class='symbol'>:latitude</span><span class='comma'>,</span> <span class='symbol'>:longitude</span><span class='comma'>,</span> <span class='float'>192.5</span><span class='comma'>,</span> <span class='float'>143.5</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>attrlat</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a name of latitude attribute.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attrlong</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a name of longitude attribute.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>lat</span>
      
      
        <span class='type'>(<tt>Numeric</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an anchor point latitude, in radians.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>long</span>
      
      
        <span class='type'>(<tt>Numeric</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an anchor point longitude, in radians.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setgeoanchor" target="_parent" title="Section 6.4.5, &quot;SetGeoAnchor&quot;">Section 6.4.5, "SetGeoAnchor"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1136
1137
1138
1139
1140
1141
1142
1143
1144</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1136</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_geo_anchor'>set_geo_anchor</span><span class='lparen'>(</span><span class='id identifier rubyid_attrlat'>attrlat</span><span class='comma'>,</span> <span class='id identifier rubyid_attrlong'>attrlong</span><span class='comma'>,</span> <span class='id identifier rubyid_lat'>lat</span><span class='comma'>,</span> <span class='id identifier rubyid_long'>long</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;attrlat&quot; argument must be String or Symbol</span><span class='tstring_end'>'</span></span>  <span class='kw'>unless</span> <span class='id identifier rubyid_attrlat'>attrlat</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>  <span class='kw'>or</span> <span class='id identifier rubyid_attrlat'>attrlat</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;attrlong&quot; argument must be String or Symbol</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_attrlong'>attrlong</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_attrlong'>attrlong</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;lat&quot; argument must be Numeric</span><span class='tstring_end'>'</span></span>               <span class='kw'>unless</span> <span class='id identifier rubyid_lat'>lat</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Numeric</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;long&quot; argument must be Numeric</span><span class='tstring_end'>'</span></span>              <span class='kw'>unless</span> <span class='id identifier rubyid_long'>long</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Numeric</span><span class='rparen'>)</span>

  <span class='ivar'>@anchor</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>attrlat</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_attrlat'>attrlat</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>attrlong</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_attrlong'>attrlong</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>lat</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_lat'>lat</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>long</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_long'>long</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='rbrace'>}</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_group_by-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_group_by</strong>(attribute, func, groupsort = '@group desc') 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetGroupBy-instance_method'>SetGroupBy</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets grouping attribute, function, and groups sorting mode; and enables
grouping (as described in Section 4.6, "Grouping (clustering) search
results").</p>

<p><tt>attribute</tt> is a string that contains group-by attribute name.
<tt>func</tt> is a constant that chooses a function applied to the
attribute value in order to compute group-by key. <tt>groupsort</tt> is a
clause that controls how the groups will be sorted. Its syntax is similar
to that described in Section 4.5, "SPH_SORT_EXTENDED mode".</p>

<p>Grouping feature is very similar in nature to <tt>GROUP BY</tt> clause from
SQL. Results produces by this function call are going to be the same as
produced by the following pseudo code:</p>

<pre class="code ruby"><code class="ruby">SELECT ... GROUP BY func(attribute) ORDER BY groupsort</code></pre>

<p>Note that it's <tt>groupsort</tt> that affects the order of matches in the
final result set. Sorting mode (see <span class='object_link'><a href="#set_sort_mode-instance_method" title="Sphinx::Client#set_sort_mode (method)">#set_sort_mode</a></span>) affect the ordering
of matches within group, ie. what match will be selected as the best one
from the group. So you can for instance order the groups by matches count
and select the most relevant match within each group at the same time.</p>

<p>Starting with version 0.9.9-rc2, aggregate functions (<tt>AVG()</tt>,
<tt>MIN()</tt>, <tt>MAX()</tt>, <tt>SUM()</tt>) are supported through
<span class='object_link'><a href="#set_select-instance_method" title="Sphinx::Client#set_select (method)">#set_select</a></span> API call when using <tt>GROUP BY</tt>.</p>

<p>You can specify group function and attribute as String ("attr", "day",
etc), Symbol (:attr, :day, etc), or Fixnum constant (SPH_GROUPBY_ATTR,
SPH_GROUPBY_DAY, etc).</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_group_by'>set_group_by</span><span class='lparen'>(</span><span class='symbol'>:tag_id</span><span class='comma'>,</span> <span class='symbol'>:attr</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>attribute</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an attribute name to group by.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>func</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a grouping function.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>groupsort</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>'@group desc'</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>a groups sorting mode.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#clustering" target="_parent" title="Section 4.6, &quot;Grouping (clustering) search results&quot;">Section 4.6, "Grouping (clustering) search results"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#sort-extended" target="_parent" title="Section 4.5, &quot;SPH_SORT_EXTENDED mode&quot;">Section 4.5, "SPH_SORT_EXTENDED mode"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setgroupby" target="_parent" title="Section 6.5.1, &quot;SetGroupBy&quot;">Section 6.5.1, "SetGroupBy"</a></li>
    
      <li><span class='object_link'><a href="#set_sort_mode-instance_method" title="Sphinx::Client#set_sort_mode (method)">#set_sort_mode</a></span></li>
    
      <li><span class='object_link'><a href="#set_select-instance_method" title="Sphinx::Client#set_select (method)">#set_select</a></span></li>
    
      <li><span class='object_link'><a href="#set_group_distinct-instance_method" title="Sphinx::Client#set_group_distinct (method)">#set_group_distinct</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1199
1200
1201
1202
1203
1204
1205
1206
1207
1208
1209
1210
1211
1212
1213
1214
1215
1216
1217
1218
1219
1220</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1199</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_group_by'>set_group_by</span><span class='lparen'>(</span><span class='id identifier rubyid_attribute'>attribute</span><span class='comma'>,</span> <span class='id identifier rubyid_func'>func</span><span class='comma'>,</span> <span class='id identifier rubyid_groupsort'>groupsort</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>@group desc</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;attribute&quot; argument must be String or Symbol</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>  <span class='kw'>or</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;groupsort&quot; argument must be String</span><span class='tstring_end'>'</span></span>           <span class='kw'>unless</span> <span class='id identifier rubyid_groupsort'>groupsort</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_func'>func</span>
    <span class='kw'>when</span> <span class='const'>String</span><span class='comma'>,</span> <span class='const'>Symbol</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_func'>func</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_const_get'>const_get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SPH_GROUPBY_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_func'>func</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_upcase'>upcase</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'>NameError</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;func\&quot; argument value \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_func'>func</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot; is invalid</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='const'>Fixnum</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;func\&quot; argument value \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_func'>func</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot; is invalid</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='const'>SPH_GROUPBY_DAY</span><span class='op'>..</span><span class='const'>SPH_GROUPBY_ATTRPAIR</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_func'>func</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;func&quot; argument must be Fixnum, String, or Symbol</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>

  <span class='ivar'>@groupby</span> <span class='op'>=</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='ivar'>@groupfunc</span> <span class='op'>=</span> <span class='id identifier rubyid_func'>func</span>
  <span class='ivar'>@groupsort</span> <span class='op'>=</span> <span class='id identifier rubyid_groupsort'>groupsort</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_group_distinct-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_group_distinct</strong>(attribute) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetGroupDistinct-instance_method'>SetGroupDistinct</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets attribute name for per-group distinct values count calculations. Only
available for grouping queries.</p>

<p><tt>attribute</tt> is a string that contains the attribute name. For each
group, all values of this attribute will be stored (as RAM limits permit),
then the amount of distinct values will be calculated and returned to the
client. This feature is similar to <tt>COUNT(DISTINCT)</tt> clause in
standard SQL; so these Sphinx calls:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_group_by'>set_group_by</span><span class='lparen'>(</span><span class='symbol'>:category</span><span class='comma'>,</span> <span class='symbol'>:attr</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>@count desc</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_group_distinct'>set_group_distinct</span><span class='lparen'>(</span><span class='symbol'>:vendor</span><span class='rparen'>)</span></code></pre>

<p>can be expressed using the following SQL clauses:</p>

<pre class="code ruby"><code class="ruby">SELECT id, weight, all-attributes,
  COUNT(DISTINCT vendor) AS @distinct,
  COUNT(*) AS @count
FROM products
GROUP BY category
ORDER BY @count DESC</code></pre>

<p>In the sample pseudo code shown just above, <span class='object_link'><a href="#set_group_distinct-instance_method" title="Sphinx::Client#set_group_distinct (method)">#set_group_distinct</a></span> call
corresponds to <tt>COUNT(DISINCT vendor)</tt> clause only. <tt>GROUP
BY</tt>, <tt>ORDER BY</tt>, and <tt>COUNT(*)</tt> clauses are all an
equivalent of <span class='object_link'><a href="#set_group_by-instance_method" title="Sphinx::Client#set_group_by (method)">#set_group_by</a></span> settings. Both queries will return one
matching row for each category. In addition to indexed attributes, matches
will also contain total per-category matches count, and the count of
distinct vendor IDs within each category.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_group_distinct'>set_group_distinct</span><span class='lparen'>(</span><span class='symbol'>:category_id</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>attribute</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an attribute name.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setgroupdistinct" target="_parent" title="Section 6.5.2, &quot;SetGroupDistinct&quot;">Section 6.5.2, "SetGroupDistinct"</a></li>
    
      <li><span class='object_link'><a href="#set_group_by-instance_method" title="Sphinx::Client#set_group_by (method)">#set_group_by</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1265
1266
1267
1268
1269
1270</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1265</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_group_distinct'>set_group_distinct</span><span class='lparen'>(</span><span class='id identifier rubyid_attribute'>attribute</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;attribute&quot; argument must be String or Symbol</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>  <span class='kw'>or</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>

  <span class='ivar'>@groupdistinct</span> <span class='op'>=</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_id_range-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_id_range</strong>(min, max) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetIDRange-instance_method'>SetIDRange</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets an accepted range of document IDs. Parameters must be integers.
Defaults are 0 and 0; that combination means to not limit by range.</p>

<p>After this call, only those records that have document ID between
<tt>min</tt> and <tt>max</tt> (including IDs exactly equal to <tt>min</tt>
or <tt>max</tt>) will be matched.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_id_range'>set_id_range</span><span class='lparen'>(</span><span class='int'>10</span><span class='comma'>,</span> <span class='int'>1000</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>min</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>min document ID.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>min</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>max document ID.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setidrange" target="_parent" title="Section 6.4.1, &quot;SetIDRange&quot;">Section 6.4.1, "SetIDRange"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


963
964
965
966
967
968
969
970
971</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 963</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_id_range'>set_id_range</span><span class='lparen'>(</span><span class='id identifier rubyid_min'>min</span><span class='comma'>,</span> <span class='id identifier rubyid_max'>max</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;min&quot; argument must be Integer</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_min'>min</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;max&quot; argument must be Integer</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_max'>max</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;max&quot; argument greater or equal to &quot;min&quot;</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_min'>min</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_max'>max</span>

  <span class='ivar'>@min_id</span> <span class='op'>=</span> <span class='id identifier rubyid_min'>min</span>
  <span class='ivar'>@max_id</span> <span class='op'>=</span> <span class='id identifier rubyid_max'>max</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_index_weights-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_index_weights</strong>(weights) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetIndexWeights-instance_method'>SetIndexWeights</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets per-index weights, and enables weighted summing of match weights
across different indexes. Parameter must be a hash (associative array)
mapping string index names to integer weights. Default is empty array that
means to disable weighting summing.</p>

<p>When a match with the same document ID is found in several different local
indexes, by default Sphinx simply chooses the match from the index
specified last in the query. This is to support searching through partially
overlapping index partitions.</p>

<p>However in some cases the indexes are not just partitions, and you might
want to sum the weights across the indexes instead of picking one.
<span class='object_link'><a href="#set_index_weights-instance_method" title="Sphinx::Client#set_index_weights (method)">#set_index_weights</a></span> lets you do that. With summing enabled, final match
weight in result set will be computed as a sum of match weight coming from
the given index multiplied by respective per-index weight specified in this
call. Ie. if the document 123 is found in index A with the weight of 2, and
also in index B with the weight of 3, and you called <span class='object_link'><a href="#set_index_weights-instance_method" title="Sphinx::Client#set_index_weights (method)">#set_index_weights</a></span>
with <tt>{&quot;A&quot;=&gt;100, &quot;B&quot;=&gt;10}</tt>, the final
weight return to the client will be 2*100+3*10 = 230.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_field_weights'>set_field_weights</span><span class='lparen'>(</span><span class='symbol'>:fresh</span> <span class='op'>=&gt;</span> <span class='int'>20</span><span class='comma'>,</span> <span class='symbol'>:archived</span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>weights</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a <tt>Hash</tt> mapping string index names to integer weights.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setindexweights" target="_parent" title="Section 6.3.6, &quot;SetIndexWeights&quot;">Section 6.3.6, "SetIndexWeights"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


928
929
930
931
932
933
934
935
936
937
938</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 928</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_index_weights'>set_index_weights</span><span class='lparen'>(</span><span class='id identifier rubyid_weights'>weights</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;weights&quot; argument must be Hash</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_weight'>weight</span><span class='op'>|</span>
    <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id identifier rubyid_weight'>weight</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;weights&quot; argument must be Hash map of strings to integers</span><span class='tstring_end'>'</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='ivar'>@indexweights</span> <span class='op'>=</span> <span class='id identifier rubyid_weights'>weights</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_limits-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_limits</strong>(offset, limit, max = 0, cutoff = 0) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetLimits-instance_method'>SetLimits</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets offset into server-side result set (<tt>offset</tt>) and amount of
matches to return to client starting from that offset (<tt>limit</tt>). Can
additionally control maximum server-side result set size for current query
(<tt>max_matches</tt>) and the threshold amount of matches to stop
searching at (<tt>cutoff</tt>). All parameters must be non-negative
integers.</p>

<p>First two parameters to <span class='object_link'><a href="#set_limits-instance_method" title="Sphinx::Client#set_limits (method)">#set_limits</a></span> are identical in behavior to MySQL
LIMIT clause. They instruct searchd to return at most <tt>limit</tt>
matches starting from match number <tt>offset</tt>. The default offset and
limit settings are <tt>0</tt> and <tt>20</tt>, that is, to return first
<tt>20</tt> matches.</p>

<p><tt>max_matches</tt> setting controls how much matches searchd will keep in
RAM while searching. All matching documents will be normally processed,
ranked, filtered, and sorted even if max_matches is set to <tt>1</tt>. But
only best <tt>N</tt> documents are stored in memory at any given moment for
performance and RAM usage reasons, and this setting controls that N. Note
that there are two places where max_matches limit is enforced. Per-query
limit is controlled by this API call, but there also is per-server limit
controlled by <tt>max_matches</tt> setting in the config file. To prevent
RAM usage abuse, server will not allow to set per-query limit higher than
the per-server limit.</p>

<p>You can't retrieve more than <tt>max_matches</tt> matches to the client
application. The default limit is set to <tt>1000</tt>. Normally, you must
not have to go over this limit. One thousand records is enough to present
to the end user. And if you're thinking about pulling the results to
application for further sorting or filtering, that would be much more
efficient if performed on Sphinx side.</p>

<p><tt>cutoff</tt> setting is intended for advanced performance control. It
tells searchd to forcibly stop search query once $cutoff matches had been
found and processed.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_limits'>set_limits</span><span class='lparen'>(</span><span class='int'>100</span><span class='comma'>,</span> <span class='int'>50</span><span class='comma'>,</span> <span class='int'>1000</span><span class='comma'>,</span> <span class='int'>5000</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>offset</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an offset into server-side result set.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>limit</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an amount of matches to return.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>max</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>0</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>a maximum server-side result set size.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>cutoff</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>0</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>a threshold amount of matches to stop searching at.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 459</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_limits'>set_limits</span><span class='lparen'>(</span><span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='id identifier rubyid_limit'>limit</span><span class='comma'>,</span> <span class='id identifier rubyid_max'>max</span> <span class='op'>=</span> <span class='int'>0</span><span class='comma'>,</span> <span class='id identifier rubyid_cutoff'>cutoff</span> <span class='op'>=</span> <span class='int'>0</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;offset&quot; argument must be Integer</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_offset'>offset</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;limit&quot; argument must be Integer</span><span class='tstring_end'>'</span></span>  <span class='kw'>unless</span> <span class='id identifier rubyid_limit'>limit</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;max&quot; argument must be Integer</span><span class='tstring_end'>'</span></span>    <span class='kw'>unless</span> <span class='id identifier rubyid_max'>max</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;cutoff&quot; argument must be Integer</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_cutoff'>cutoff</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;offset&quot; argument should be greater or equal to zero</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_offset'>offset</span> <span class='op'>&gt;=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;limit&quot; argument should be greater to zero</span><span class='tstring_end'>'</span></span>           <span class='kw'>unless</span> <span class='id identifier rubyid_limit'>limit</span> <span class='op'>&gt;</span> <span class='int'>0</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;max&quot; argument should be greater or equal to zero</span><span class='tstring_end'>'</span></span>    <span class='kw'>unless</span> <span class='id identifier rubyid_max'>max</span> <span class='op'>&gt;=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;cutoff&quot; argument should be greater or equal to zero</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_cutoff'>cutoff</span> <span class='op'>&gt;=</span> <span class='int'>0</span>

  <span class='ivar'>@offset</span> <span class='op'>=</span> <span class='id identifier rubyid_offset'>offset</span>
  <span class='ivar'>@limit</span> <span class='op'>=</span> <span class='id identifier rubyid_limit'>limit</span>
  <span class='ivar'>@maxmatches</span> <span class='op'>=</span> <span class='id identifier rubyid_max'>max</span> <span class='kw'>if</span> <span class='id identifier rubyid_max'>max</span> <span class='op'>&gt;</span> <span class='int'>0</span>
  <span class='ivar'>@cutoff</span> <span class='op'>=</span> <span class='id identifier rubyid_cutoff'>cutoff</span> <span class='kw'>if</span> <span class='id identifier rubyid_cutoff'>cutoff</span> <span class='op'>&gt;</span> <span class='int'>0</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_match_mode-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_match_mode</strong>(mode) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetMatchMode-instance_method'>SetMatchMode</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets full-text query matching mode.</p>

<p>Parameter must be a <tt>Fixnum</tt> constant specifying one of the known
modes (<tt>SPH_MATCH_ALL</tt>, <tt>SPH_MATCH_ANY</tt>, etc),
<tt>String</tt> with identifier (<tt>&quot;all&quot;</tt>,
<tt>&quot;any&quot;</tt>, etc), or a <tt>Symbol</tt> (<tt>:all</tt>,
<tt>:any</tt>, etc).</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_match_mode'>set_match_mode</span><span class='lparen'>(</span><span class='const'>Sphinx</span><span class='op'>::</span><span class='const'>SPH_MATCH_ALL</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_match_mode'>set_match_mode</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_match_mode'>set_match_mode</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>all</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>mode</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>full-text query matching mode.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#matching-modes" target="_parent" title="Section 4.1, &quot;Matching modes&quot;">Section 4.1, "Matching modes"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setmatchmode" target="_parent" title="Section 6.3.1, &quot;SetMatchMode&quot;">Section 6.3.1, "SetMatchMode"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 698</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_match_mode'>set_match_mode</span><span class='lparen'>(</span><span class='id identifier rubyid_mode'>mode</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_mode'>mode</span>
    <span class='kw'>when</span> <span class='const'>String</span><span class='comma'>,</span> <span class='const'>Symbol</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_mode'>mode</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_const_get'>const_get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SPH_MATCH_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mode'>mode</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_upcase'>upcase</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'>NameError</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;mode\&quot; argument value \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mode'>mode</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot; is invalid</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='const'>Fixnum</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;mode\&quot; argument value \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mode'>mode</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot; is invalid</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='const'>SPH_MATCH_ALL</span><span class='op'>..</span><span class='const'>SPH_MATCH_EXTENDED2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_mode'>mode</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;mode&quot; argument must be Fixnum, String, or Symbol</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>

  <span class='ivar'>@mode</span> <span class='op'>=</span> <span class='id identifier rubyid_mode'>mode</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_max_query_time-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_max_query_time</strong>(max) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetMaxQueryTime-instance_method'>SetMaxQueryTime</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets maximum search query time, in milliseconds. Parameter must be a
non-negative integer. Default valus is <tt>0</tt> which means "do not
limit".</p>

<p>Similar to <tt>cutoff</tt> setting from <span class='object_link'><a href="#set_limits-instance_method" title="Sphinx::Client#set_limits (method)">#set_limits</a></span>, but limits elapsed
query time instead of processed matches count. Local search queries will be
stopped once that much time has elapsed. Note that if you're performing a
search which queries several local indexes, this limit applies to each
index separately.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_max_query_time'>set_max_query_time</span><span class='lparen'>(</span><span class='int'>200</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>max</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>maximum search query time in milliseconds.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


495
496
497
498
499
500
501</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 495</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_max_query_time'>set_max_query_time</span><span class='lparen'>(</span><span class='id identifier rubyid_max'>max</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;max&quot; argument must be Integer</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_max'>max</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;max&quot; argument should be greater or equal to zero</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_max'>max</span> <span class='op'>&gt;=</span> <span class='int'>0</span>

  <span class='ivar'>@maxquerytime</span> <span class='op'>=</span> <span class='id identifier rubyid_max'>max</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_outer_select-instance_method">
  
    - (<tt>Object</tt>) <strong>set_outer_select</strong>(orderby, offset, limit) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetOuterSelect-instance_method'>SetOuterSelect</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


659
660
661
662
663
664
665
666
667
668
669
670
671
672</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 659</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_outer_select'>set_outer_select</span><span class='lparen'>(</span><span class='id identifier rubyid_orderby'>orderby</span><span class='comma'>,</span> <span class='id identifier rubyid_offset'>offset</span><span class='comma'>,</span> <span class='id identifier rubyid_limit'>limit</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;orderby&quot; argument must be String</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_orderby'>orderby</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;offset&quot; argument must be Integer</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_offset'>offset</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;limit&quot; argument must be Integer</span><span class='tstring_end'>'</span></span>  <span class='kw'>unless</span> <span class='id identifier rubyid_limit'>limit</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;offset&quot; argument should be greater or equal to zero</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_offset'>offset</span> <span class='op'>&gt;=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;limit&quot; argument should be greater to zero</span><span class='tstring_end'>'</span></span>           <span class='kw'>unless</span> <span class='id identifier rubyid_limit'>limit</span> <span class='op'>&gt;</span> <span class='int'>0</span>

  <span class='ivar'>@outerorderby</span> <span class='op'>=</span> <span class='id identifier rubyid_orderby'>orderby</span>
  <span class='ivar'>@outeroffset</span> <span class='op'>=</span> <span class='id identifier rubyid_offset'>offset</span>
  <span class='ivar'>@outerlimit</span> <span class='op'>=</span> <span class='id identifier rubyid_limit'>limit</span>
  <span class='ivar'>@hasouter</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_override-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_override</strong>(attribute, attrtype, values) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetOverride-instance_method'>SetOverride</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets temporary (per-query) per-document attribute value overrides. Only
supports scalar attributes. <tt>values</tt> must be a <tt>Hash</tt> that
maps document IDs to overridden attribute values.</p>

<p>Override feature lets you "temporary" update attribute values for some
documents within a single query, leaving all other queries unaffected. This
might be useful for personalized data. For example, assume you're
implementing a personalized search function that wants to boost the posts
that the user's friends recommend. Such data is not just dynamic, but also
personal; so you can't simply put it in the index because you don't want
everyone's searches affected. Overrides, on the other hand, are local to a
single query and invisible to everyone else. So you can, say, setup a
"friends_weight" value for every document, defaulting to 0, then temporary
override it with 1 for documents 123, 456 and 789 (recommended by exactly
the friends of current user), and use that value when ranking.</p>

<p>You can specify attribute type as String ("integer", "float", etc), Symbol
(:integer, :float, etc), or Fixnum constant (SPH_ATTR_INTEGER,
SPH_ATTR_FLOAT, etc).</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_override'>set_override</span><span class='lparen'>(</span><span class='symbol'>:friends_weight</span><span class='comma'>,</span> <span class='symbol'>:integer</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='int'>123</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>456</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>789</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>attribute</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an attribute name to override values of.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attrtype</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>attribute type.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>values</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a <tt>Hash</tt> that maps document IDs to overridden attribute values.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setoverride" target="_parent" title="Section 6.2.3, &quot;SetOverride&quot;">Section 6.2.3, "SetOverride"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 536</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_override'>set_override</span><span class='lparen'>(</span><span class='id identifier rubyid_attribute'>attribute</span><span class='comma'>,</span> <span class='id identifier rubyid_attrtype'>attrtype</span><span class='comma'>,</span> <span class='id identifier rubyid_values'>values</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;attribute&quot; argument must be String or Symbol</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_attrtype'>attrtype</span>
    <span class='kw'>when</span> <span class='const'>String</span><span class='comma'>,</span> <span class='const'>Symbol</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_attrtype'>attrtype</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_const_get'>const_get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SPH_ATTR_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attrtype'>attrtype</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_upcase'>upcase</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'>NameError</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;attrtype\&quot; argument value \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attrtype'>attrtype</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot; is invalid</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='const'>Fixnum</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;attrtype\&quot; argument value \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attrtype'>attrtype</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot; is invalid</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='const'>SPH_ATTR_INTEGER</span><span class='op'>..</span><span class='const'>SPH_ATTR_BIGINT</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_attrtype'>attrtype</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;attrtype&quot; argument must be Fixnum, String, or Symbol</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;values&quot; argument must be Hash</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;values&quot; argument must be Hash map of Integer to Integer or Time</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_attrtype'>attrtype</span>
      <span class='kw'>when</span> <span class='const'>SPH_ATTR_TIMESTAMP</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;values&quot; argument must be Hash map of Integer to Numeric</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Time</span><span class='rparen'>)</span>
      <span class='kw'>when</span> <span class='const'>SPH_ATTR_FLOAT</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;values&quot; argument must be Hash map of Integer to Numeric</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Numeric</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='comment'># SPH_ATTR_INTEGER, SPH_ATTR_ORDINAL, SPH_ATTR_BOOL, SPH_ATTR_BIGINT
</span>        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;values&quot; argument must be Hash map of Integer to Integer</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='ivar'>@overrides</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>attr</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_attribute'>attribute</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>type</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_attrtype'>attrtype</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>values</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_values'>values</span> <span class='rbrace'>}</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_query_flag-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_query_flag</strong>(flag_name, flag_value) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetQueryFlag-instance_method'>SetQueryFlag</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Allows to control a number of per-query options.</p>

<p>Supported options and respectively allowed values are:</p>
<ul><li>
<p><tt>reverse_scan</tt> -- <tt>0</tt> or <tt>1</tt>, lets you control the
order in which full-scan query processes the rows.</p>
</li><li>
<p><tt>sort_method</tt> -- <tt>&quot;pq&quot;</tt> (priority queue, set by default) or
<tt>&quot;kbuffer&quot;</tt> (gives faster sorting for already pre-sorted data, e.g. index
data sorted by id). The result set is in both cases the same; picking one
option or the other may just improve (or worsen!) performance.</p>
</li><li>
<p><tt>boolean_simplify</tt> -- <tt>false</tt> or <tt>true</tt>, enables
simplifying the query to speed it up.</p>
</li><li>
<p><tt>idf</tt> -- either <tt>&quot;normalized&quot;</tt> (default) or <tt>&quot;plain&quot;</tt>.</p>
</li></ul>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>flag_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>name of the option to set value for</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>flag_value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>value to set</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://sphinxsearch.com/docs/current.html#sphinxql-select" target="_parent" title="http://sphinxsearch.com/docs/current.html#sphinxql-select">http://sphinxsearch.com/docs/current.html#sphinxql-select</a></li>
    
      <li><a href="http://sphinxsearch.com/docs/current.html#conf-predicted-time-costs" target="_parent" title="http://sphinxsearch.com/docs/current.html#conf-predicted-time-costs">http://sphinxsearch.com/docs/current.html#conf-predicted-time-costs</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 639</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_query_flag'>set_query_flag</span><span class='lparen'>(</span><span class='id identifier rubyid_flag_name'>flag_name</span><span class='comma'>,</span> <span class='id identifier rubyid_flag_value'>flag_value</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>unknown &quot;flag_name&quot; argument value</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='const'>QUERY_FLAGS</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='id identifier rubyid_flag_name'>flag_name</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_flag'>flag</span>   <span class='op'>=</span> <span class='const'>QUERY_FLAGS</span><span class='lbracket'>[</span><span class='id identifier rubyid_flag_name'>flag_name</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_values'>values</span> <span class='op'>=</span> <span class='const'>QUERY_FLAGS</span><span class='lbracket'>[</span><span class='id identifier rubyid_flag_name'>flag_name</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:values</span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_flag_name'>flag_name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>max_predicted_time</span><span class='tstring_end'>'</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;flag_value\&quot; should be a positive integer for \&quot;max_predicted_time\&quot; flag</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_flag_value'>flag_value</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='id identifier rubyid_flag_value'>flag_value</span> <span class='op'>&gt;=</span> <span class='int'>0</span>

    <span class='ivar'>@predictedtime</span> <span class='op'>=</span> <span class='id identifier rubyid_flag_value'>flag_value</span>
  <span class='kw'>elsif</span> <span class='op'>!</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_flag_value'>flag_value</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>unknown \&quot;flag_value\&quot;, should be one of </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_is_set'>is_set</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:call</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_flag_value'>flag_value</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_flag_value'>flag_value</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='int'>1</span>
  <span class='ivar'>@query_flags</span> <span class='op'>=</span> <span class='id identifier rubyid_set_bit'>set_bit</span><span class='lparen'>(</span><span class='ivar'>@query_flags</span><span class='comma'>,</span> <span class='id identifier rubyid_flag'>flag</span><span class='lbracket'>[</span><span class='symbol'>:index</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_is_set'>is_set</span><span class='rparen'>)</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_ranking_mode-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_ranking_mode</strong>(ranker, rankexpr = '') 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetRankingMode-instance_method'>SetRankingMode</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets ranking mode. Only available in <tt>SPH_MATCH_EXTENDED2</tt> matching
mode at the time of this writing. Parameter must be a constant specifying
one of the known modes.</p>

<p>By default, in the <tt>EXTENDED</tt> matching mode Sphinx computes two
factors which contribute to the final match weight. The major part is a
phrase proximity value between the document text and the query. The minor
part is so-called BM25 statistical function, which varies from 0 to 1
depending on the keyword frequency within document (more occurrences yield
higher weight) and within the whole index (more rare keywords yield higher
weight).</p>

<p>However, in some cases you'd want to compute weight differently - or maybe
avoid computing it at all for performance reasons because you're sorting
the result set by something else anyway. This can be accomplished by
setting the appropriate ranking mode.</p>

<p>You can specify ranking mode as String ("proximity_bm25", "bm25", etc),
Symbol (:proximity_bm25, :bm25, etc), or Fixnum constant
(SPH_RANK_PROXIMITY_BM25, SPH_RANK_BM25, etc).</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_ranking_mode'>set_ranking_mode</span><span class='lparen'>(</span><span class='const'>Sphinx</span><span class='op'>::</span><span class='const'>SPH_RANK_BM25</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_ranking_mode'>set_ranking_mode</span><span class='lparen'>(</span><span class='symbol'>:bm25</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_ranking_mode'>set_ranking_mode</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>bm25</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_ranking_mode'>set_ranking_mode</span><span class='lparen'>(</span><span class='symbol'>:expr</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>sum(lcs*user_weight)*1000+bm25</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>ranker</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>ranking mode.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>rankexpr</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>''</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>ranking formula to use with the expression based ranker
(<tt>SPH_RANK_EXPR</tt>).</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#matching-modes" target="_parent" title="Section 4.1, &quot;Matching modes&quot;">Section 4.1, "Matching modes"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setmatchmode" target="_parent" title="Section 6.3.1, &quot;SetMatchMode&quot;">Section 6.3.1, "SetMatchMode"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setrankingmode" target="_parent" title="Section 6.3.2, &quot;SetRankingMode&quot;">Section 6.3.2, "SetRankingMode"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 755</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_ranking_mode'>set_ranking_mode</span><span class='lparen'>(</span><span class='id identifier rubyid_ranker'>ranker</span><span class='comma'>,</span> <span class='id identifier rubyid_rankexpr'>rankexpr</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_ranker'>ranker</span>
    <span class='kw'>when</span> <span class='const'>String</span><span class='comma'>,</span> <span class='const'>Symbol</span>
      <span class='id identifier rubyid_const_name'>const_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SPH_RANK_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ranker'>ranker</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_upcase'>upcase</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>unless</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_const_defined?'>const_defined?</span><span class='lparen'>(</span><span class='id identifier rubyid_const_name'>const_name</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;ranker\&quot; argument value \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ranker'>ranker</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot; is invalid</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_ranker'>ranker</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_const_get'>const_get</span><span class='lparen'>(</span><span class='id identifier rubyid_const_name'>const_name</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>Fixnum</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;ranker\&quot; argument value \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ranker'>ranker</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot; is invalid</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='const'>SPH_RANK_PROXIMITY_BM25</span><span class='op'>..</span><span class='const'>SPH_RANK_SPH04</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_ranker'>ranker</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;ranker&quot; argument must be Fixnum, String, or Symbol</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;rankexpr&quot; argument must be String</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_rankexpr'>rankexpr</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;rankexpr&quot; should not be empty if ranker is SPH_RANK_EXPR</span><span class='tstring_end'>'</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_ranker'>ranker</span> <span class='op'>==</span> <span class='const'>SPH_RANK_EXPR</span> <span class='kw'>and</span> <span class='id identifier rubyid_rankexpr'>rankexpr</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='ivar'>@ranker</span> <span class='op'>=</span> <span class='id identifier rubyid_ranker'>ranker</span>
  <span class='ivar'>@rankexpr</span> <span class='op'>=</span> <span class='id identifier rubyid_rankexpr'>rankexpr</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_request_timeout-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_request_timeout</strong>(timeout, retries = 1) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetRequestTimeout-instance_method'>SetRequestTimeout</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets the time allowed to spend performing request to the server before
giving up and number of retries to perform.</p>

<p>In the event of a failure to do request, an appropriate error code should
be returned back to the application in order for application-level error
handling to advise the user.</p>

<p>When multiple servers configured through <span class='object_link'><a href="#set_servers-instance_method" title="Sphinx::Client#set_servers (method)">#set_servers</a></span> method, and
<tt>retries</tt> number is greater than 1, library will try to do another
try with this server (with full reconnect). If connection would fail,
behavior depends on <span class='object_link'><a href="#set_connect_timeout-instance_method" title="Sphinx::Client#set_connect_timeout (method)">#set_connect_timeout</a></span> settings.</p>

<p>Please note, this timeout will only be used for request performing, not for
connection establishing.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Set request timeout to 1 second and number of retries to 5</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_request_timeout'>set_request_timeout</span><span class='lparen'>(</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>5</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>timeout</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a request timeout in seconds.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>retries</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>1</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>number of request retries.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#set_server-instance_method" title="Sphinx::Client#set_server (method)">#set_server</a></span></li>
    
      <li><span class='object_link'><a href="#set_servers-instance_method" title="Sphinx::Client#set_servers (method)">#set_servers</a></span></li>
    
      <li><span class='object_link'><a href="#set_connect_timeout-instance_method" title="Sphinx::Client#set_connect_timeout (method)">#set_connect_timeout</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


371
372
373
374
375
376
377
378
379</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 371</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_request_timeout'>set_request_timeout</span><span class='lparen'>(</span><span class='id identifier rubyid_timeout'>timeout</span><span class='comma'>,</span> <span class='id identifier rubyid_retries'>retries</span> <span class='op'>=</span> <span class='int'>1</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;timeout&quot; argument must be Integer</span><span class='tstring_end'>'</span></span>        <span class='kw'>unless</span> <span class='id identifier rubyid_timeout'>timeout</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;retries&quot; argument must be Integer</span><span class='tstring_end'>'</span></span>        <span class='kw'>unless</span> <span class='id identifier rubyid_retries'>retries</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;retries&quot; argument must be greater than 0</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_retries'>retries</span> <span class='op'>&gt;</span> <span class='int'>0</span>

  <span class='ivar'>@reqtimeout</span> <span class='op'>=</span> <span class='id identifier rubyid_timeout'>timeout</span>
  <span class='ivar'>@reqretries</span> <span class='op'>=</span> <span class='id identifier rubyid_retries'>retries</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_retries-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_retries</strong>(count, delay = 0) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetRetries-instance_method'>SetRetries</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets distributed retry count and delay.</p>

<p>On temporary failures searchd will attempt up to <tt>count</tt> retries per
agent. <tt>delay</tt> is the delay between the retries, in milliseconds.
Retries are disabled by default. Note that this call will not make the API
itself retry on temporary failure; it only tells searchd to do so.
Currently, the list of temporary failures includes all kinds of connection
failures and maxed out (too busy) remote agents.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Perform 5 retries with 200 ms between them</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_retries'>set_retries</span><span class='lparen'>(</span><span class='int'>5</span><span class='comma'>,</span> <span class='int'>200</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>count</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a number of retries to perform.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>delay</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>0</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>a delay between the retries.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#set_connect_timeout-instance_method" title="Sphinx::Client#set_connect_timeout (method)">#set_connect_timeout</a></span></li>
    
      <li><span class='object_link'><a href="#set_request_timeout-instance_method" title="Sphinx::Client#set_request_timeout (method)">#set_request_timeout</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


402
403
404
405
406
407
408
409</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 402</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_retries'>set_retries</span><span class='lparen'>(</span><span class='id identifier rubyid_count'>count</span><span class='comma'>,</span> <span class='id identifier rubyid_delay'>delay</span> <span class='op'>=</span> <span class='int'>0</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;count&quot; argument must be Integer</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_count'>count</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;delay&quot; argument must be Integer</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_delay'>delay</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>

  <span class='ivar'>@retrycount</span> <span class='op'>=</span> <span class='id identifier rubyid_count'>count</span>
  <span class='ivar'>@retrydelay</span> <span class='op'>=</span> <span class='id identifier rubyid_delay'>delay</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_select-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_select</strong>(select) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetSelect-instance_method'>SetSelect</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets the select clause, listing specific attributes to fetch, and
expressions to compute and fetch. Clause syntax mimics SQL.</p>

<p><span class='object_link'><a href="#set_select-instance_method" title="Sphinx::Client#set_select (method)">#set_select</a></span> is very similar to the part of a typical SQL query between
<tt>SELECT</tt> and <tt>FROM</tt>. It lets you choose what attributes
(columns) to fetch, and also what expressions over the columns to compute
and fetch. A certain difference from SQL is that expressions must always be
aliased to a correct identifier (consisting of letters and digits) using
<tt>AS</tt> keyword. SQL also lets you do that but does not require to.
Sphinx enforces aliases so that the computation results can always be
returned under a "normal" name in the result set, used in other clauses,
etc.</p>

<p>Everything else is basically identical to SQL. Star ('*') is supported.
Functions are supported. Arbitrary amount of expressions is supported.
Computed expressions can be used for sorting, filtering, and grouping, just
as the regular attributes.</p>

<p>Starting with version 0.9.9-rc2, aggregate functions (<tt>AVG()</tt>,
<tt>MIN()</tt>, <tt>MAX()</tt>, <tt>SUM()</tt>) are supported when using
<tt>GROUP BY</tt>.</p>

<p>Expression sorting (Section 4.5, ???SPH_SORT_EXPR mode???) and geodistance
functions (<span class='object_link'><a href="#set_geo_anchor-instance_method" title="Sphinx::Client#set_geo_anchor (method)">#set_geo_anchor</a></span>) are now internally implemented using this
computed expressions mechanism, using magic names '<tt>@expr</tt>' and
'<tt>@geodist</tt>' respectively.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_select'>set_select</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>*, @weight+(user_karma+ln(pageviews))*0.1 AS myweight</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_select'>set_select</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>exp_years, salary_gbp*{$gbp_usd_rate} AS salary_usd, IF(age&gt;40,1,0) AS over40</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_select'>set_select</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>*, AVG(price) AS avgprice</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>select</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a select clause, listing specific attributes to fetch.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#sort-expr" target="_parent" title="Section 4.5, &quot;SPH_SORT_EXPR mode&quot;">Section 4.5, "SPH_SORT_EXPR mode"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setgeoanchor" target="_parent" title="Section 6.4.5, &quot;SetGeoAnchor&quot;">Section 6.4.5, "SetGeoAnchor"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setselect" target="_parent" title="Section 6.2.4, &quot;SetSelect&quot;">Section 6.2.4, "SetSelect"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


612
613
614
615
616
617</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 612</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_select'>set_select</span><span class='lparen'>(</span><span class='id identifier rubyid_select'>select</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;select&quot; argument must be String</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_select'>select</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>

  <span class='ivar'>@select</span> <span class='op'>=</span> <span class='id identifier rubyid_select'>select</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_server-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_server</strong>(host, port = 9312) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetServer-instance_method'>SetServer</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets searchd host name and TCP port. All subsequent requests will use the
new host and port settings. Default <tt>host</tt> and <tt>port</tt> are
'localhost' and 9312, respectively.</p>

<p>Also, you can specify an absolute path to Sphinx's UNIX socket as
<tt>host</tt>, in this case pass port as <tt>0</tt> or <tt>nil</tt>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_server'>set_server</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>localhost</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='int'>9312</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_server'>set_server</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/opt/sphinx/var/run/sphinx.sock</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>host</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the searchd host name or UNIX socket absolute path.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>port</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>9312</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the searchd port name (could be any if UNIX socket path specified).</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#set_servers-instance_method" title="Sphinx::Client#set_servers (method)">#set_servers</a></span></li>
    
      <li><span class='object_link'><a href="#set_connect_timeout-instance_method" title="Sphinx::Client#set_connect_timeout (method)">#set_connect_timeout</a></span></li>
    
      <li><span class='object_link'><a href="#set_request_timeout-instance_method" title="Sphinx::Client#set_request_timeout (method)">#set_request_timeout</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 225</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_server'>set_server</span><span class='lparen'>(</span><span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span> <span class='op'>=</span> <span class='int'>9312</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;host&quot; argument must be String</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_host'>host</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='comment'># Check if UNIX socket should be used
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_host'>host</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='CHAR'>?/</span>
    <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_host'>host</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_host'>host</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>7</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>unix://</span><span class='tstring_end'>'</span></span>
    <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_host'>host</span><span class='lbracket'>[</span><span class='int'>7</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;port&quot; argument must be Integer</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_port'>port</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_host'>host</span> <span class='op'>=</span> <span class='id identifier rubyid_port'>port</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='ivar'>@servers</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='const'>Sphinx</span><span class='op'>::</span><span class='const'>Server</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[sphinx] servers now: </span><span class='embexpr_beg'>#{</span><span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_servers-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_servers</strong>(servers) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetServers-instance_method'>SetServers</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets the list of searchd servers. Each subsequent request will use next
server in list (round-robin). In case of one server failure, request could
be retried on another server (see <span class='object_link'><a href="#set_connect_timeout-instance_method" title="Sphinx::Client#set_connect_timeout (method)">#set_connect_timeout</a></span> and
<span class='object_link'><a href="#set_request_timeout-instance_method" title="Sphinx::Client#set_request_timeout (method)">#set_request_timeout</a></span>).</p>

<p>Method accepts an <tt>Array</tt> of <tt>Hash</tt>es, each of them should have
<tt>:host</tt> and <tt>:port</tt> (to connect to searchd through network)
or <tt>:path</tt> (an absolute path to UNIX socket) specified.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_servers'>set_servers</span><span class='lparen'>(</span><span class='lbracket'>[</span>
  <span class='lbrace'>{</span> <span class='symbol'>:host</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>browse01.local</span><span class='tstring_end'>'</span></span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='comment'># default port is 9312
</span>  <span class='lbrace'>{</span> <span class='symbol'>:host</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>browse02.local</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:port</span> <span class='op'>=&gt;</span> <span class='int'>9312</span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='lbrace'>{</span> <span class='symbol'>:path</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/opt/sphinx/var/run/sphinx.sock</span><span class='tstring_end'>'</span></span> <span class='rbrace'>}</span>
<span class='rbracket'>]</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>servers</span>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an <tt>Array</tt> of <tt>Hash</tt> objects with servers parameters.</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>servers</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:host</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>the searchd host name or UNIX socket absolute path.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:path</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>the searchd UNIX socket absolute path.</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:port</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>9312</tt>
            
          </span>
          
            &mdash; <div class='inline'>
<p>the searchd port name (skiped when UNIX socket path specified)</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#set_server-instance_method" title="Sphinx::Client#set_server (method)">#set_server</a></span></li>
    
      <li><span class='object_link'><a href="#set_connect_timeout-instance_method" title="Sphinx::Client#set_connect_timeout (method)">#set_connect_timeout</a></span></li>
    
      <li><span class='object_link'><a href="#set_request_timeout-instance_method" title="Sphinx::Client#set_request_timeout (method)">#set_request_timeout</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 274</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_servers'>set_servers</span><span class='lparen'>(</span><span class='id identifier rubyid_servers'>servers</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;servers&quot; argument must be Array</span><span class='tstring_end'>'</span></span>     <span class='kw'>unless</span> <span class='id identifier rubyid_servers'>servers</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;servers&quot; argument must be not empty</span><span class='tstring_end'>'</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_servers'>servers</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='ivar'>@servers</span> <span class='op'>=</span> <span class='id identifier rubyid_servers'>servers</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;servers&quot; argument must be Array of Hashes</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_server'>server</span> <span class='op'>=</span> <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_with_indifferent_access'>with_indifferent_access</span>

    <span class='id identifier rubyid_host'>host</span> <span class='op'>=</span> <span class='id identifier rubyid_server'>server</span><span class='lbracket'>[</span><span class='symbol'>:path</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_server'>server</span><span class='lbracket'>[</span><span class='symbol'>:host</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_port'>port</span> <span class='op'>=</span> <span class='id identifier rubyid_server'>server</span><span class='lbracket'>[</span><span class='symbol'>:port</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='int'>9312</span>
    <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;host&quot; argument must be String</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_host'>host</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>

    <span class='comment'># Check if UNIX socket should be used
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_host'>host</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='CHAR'>?/</span>
      <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_host'>host</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_host'>host</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>7</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>unix://</span><span class='tstring_end'>'</span></span>
      <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='id identifier rubyid_host'>host</span><span class='lbracket'>[</span><span class='int'>7</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;port&quot; argument must be Integer</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_port'>port</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_host'>host</span> <span class='op'>=</span> <span class='id identifier rubyid_port'>port</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_path'>path</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

    <span class='const'>Sphinx</span><span class='op'>::</span><span class='const'>Server</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span>
  <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[sphinx] servers now: </span><span class='embexpr_beg'>#{</span><span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_sort_mode-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_sort_mode</strong>(mode, sortby = '') 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetSortMode-instance_method'>SetSortMode</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set matches sorting mode.</p>

<p>You can specify sorting mode as String ("relevance", "attr_desc", etc),
Symbol (:relevance, :attr_desc, etc), or Fixnum constant
(SPH_SORT_RELEVANCE, SPH_SORT_ATTR_DESC, etc).</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_sort_mode'>set_sort_mode</span><span class='lparen'>(</span><span class='const'>Sphinx</span><span class='op'>::</span><span class='const'>SPH_SORT_ATTR_ASC</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>attr</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_sort_mode'>set_sort_mode</span><span class='lparen'>(</span><span class='symbol'>:attr_asc</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>attr</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_sort_mode'>set_sort_mode</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>attr_asc</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>attr</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>mode</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>matches sorting mode.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>sortby</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>''</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>sorting clause, with the syntax depending on specific mode. Should be
specified unless sorting mode is <tt>SPH_SORT_RELEVANCE</tt>.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#sorting-modes" target="_parent" title="Section 4.5, &quot;Sorting modes&quot;">Section 4.5, "Sorting modes"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setsortmode" target="_parent" title="Section 6.3.3, &quot;SetSortMode&quot;">Section 6.3.3, "SetSortMode"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 801</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_sort_mode'>set_sort_mode</span><span class='lparen'>(</span><span class='id identifier rubyid_mode'>mode</span><span class='comma'>,</span> <span class='id identifier rubyid_sortby'>sortby</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_mode'>mode</span>
    <span class='kw'>when</span> <span class='const'>String</span><span class='comma'>,</span> <span class='const'>Symbol</span>
      <span class='kw'>begin</span>
        <span class='id identifier rubyid_mode'>mode</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_const_get'>const_get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SPH_SORT_</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mode'>mode</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_upcase'>upcase</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>rescue</span> <span class='const'>NameError</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;mode\&quot; argument value \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mode'>mode</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot; is invalid</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='const'>Fixnum</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;mode\&quot; argument value \&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_mode'>mode</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot; is invalid</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='const'>SPH_SORT_RELEVANCE</span><span class='op'>..</span><span class='const'>SPH_SORT_EXPR</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_mode'>mode</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;mode&quot; argument must be Fixnum, String, or Symbol</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;sortby&quot; argument must be String</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_sortby'>sortby</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;sortby&quot; should not be empty unless mode is SPH_SORT_RELEVANCE</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_mode'>mode</span> <span class='op'>==</span> <span class='const'>SPH_SORT_RELEVANCE</span> <span class='kw'>or</span> <span class='op'>!</span><span class='id identifier rubyid_sortby'>sortby</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='ivar'>@sort</span> <span class='op'>=</span> <span class='id identifier rubyid_mode'>mode</span>
  <span class='ivar'>@sortby</span> <span class='op'>=</span> <span class='id identifier rubyid_sortby'>sortby</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_weights-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>) <strong>set_weights</strong>(weights) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='SetWeights-instance_method'>SetWeights</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <div class="note deprecated"><strong>Deprecated.</strong> <div class='inline'>
<p>Use <span class='object_link'><a href="#set_field_weights-instance_method" title="Sphinx::Client#set_field_weights (method)">#set_field_weights</a></span> instead.</p>
</div></div>

<p>Binds per-field weights in the order of appearance in the index.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_weights'>set_weights</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>3</span><span class='comma'>,</span> <span class='int'>5</span><span class='rbracket'>]</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>weights</span>
      
      
        <span class='type'>(<tt>Array&lt;Integer&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an <tt>Array</tt> of integer per-field weights.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Sphinx::Client (class)">Sphinx::Client</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>self.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#set_field_weights-instance_method" title="Sphinx::Client#set_field_weights (method)">#set_field_weights</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


837
838
839
840
841
842
843
844
845</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 837</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_weights'>set_weights</span><span class='lparen'>(</span><span class='id identifier rubyid_weights'>weights</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;weights&quot; argument must be Array</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_weights'>weights</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_weight'>weight</span><span class='op'>|</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;weights&quot; argument must be Array of integers</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_weight'>weight</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='ivar'>@weights</span> <span class='op'>=</span> <span class='id identifier rubyid_weights'>weights</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="status-instance_method">
  
    - (<tt>Array&lt;Array&gt;</tt>, <tt>Array&lt;Hash&gt;</tt>) <strong>status</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='Status-instance_method'>Status</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Queries searchd status, and returns an array of status variable name and
value pairs.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Single server</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_rjust'>rjust</span><span class='lparen'>(</span><span class='int'>20</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span></code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Multiple servers</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_set_servers'>set_servers</span><span class='lparen'>(</span><span class='lbracket'>[</span>
  <span class='lbrace'>{</span> <span class='symbol'>:host</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>localhost</span><span class='tstring_end'>'</span></span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='lbrace'>{</span> <span class='symbol'>:host</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>browse02.local</span><span class='tstring_end'>'</span></span> <span class='rbrace'>}</span>
<span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_report'>report</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>=== </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_report'>report</span><span class='lbracket'>[</span><span class='symbol'>:server</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>if</span> <span class='id identifier rubyid_report'>report</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_report'>report</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_report'>report</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_rjust'>rjust</span><span class='lparen'>(</span><span class='int'>20</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_value'>value</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Array&gt;</tt>, <tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a table containing searchd status information. If there are more than one
server configured (<span class='object_link'><a href="#set_servers-instance_method" title="Sphinx::Client#set_servers (method)">#set_servers</a></span>), an <tt>Array</tt> of <tt>Hash</tt>es will be
returned, one for each server. Hash will contain <tt>:server</tt> element
with string name of server (<tt>host:port</tt>) and <tt>:status</tt> table
just like one for a single server. In case of any error, it will be stored
in the <tt>:error</tt> key.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2156
2157
2158
2159
2160
2161
2162
2163
2164
2165
2166
2167
2168
2169
2170
2171
2172
2173
2174
2175
2176
2177</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 2156</span>

<span class='kw'>def</span> <span class='id identifier rubyid_status'>status</span>
  <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span>

  <span class='comment'># parse response
</span>  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_server'>server</span><span class='op'>|</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='id identifier rubyid_perform_request'>perform_request</span><span class='lparen'>(</span><span class='symbol'>:status</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_server'>server</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_rows'>rows</span><span class='comma'>,</span> <span class='id identifier rubyid_cols'>cols</span> <span class='op'>=</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_ints'>get_ints</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_status'>status</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>0</span><span class='op'>...</span><span class='id identifier rubyid_rows'>rows</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span>
        <span class='lparen'>(</span><span class='int'>0</span><span class='op'>...</span><span class='id identifier rubyid_cols'>cols</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_string'>get_string</span> <span class='rbrace'>}</span>
      <span class='kw'>end</span>
      <span class='const'>HashWithIndifferentAccess</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:server</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_status'>status</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>SphinxError</span>
      <span class='comment'># Re-raise error when a single server configured
</span>      <span class='id identifier rubyid_raise'>raise</span> <span class='kw'>if</span> <span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>1</span>
      <span class='const'>HashWithIndifferentAccess</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:server</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='symbol'>:error</span> <span class='op'>=&gt;</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_last_error'>last_error</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span> <span class='op'>?</span> <span class='id identifier rubyid_results'>results</span> <span class='op'>:</span> <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_attributes-instance_method">
  
    - (<tt>Integer</tt>) <strong>update_attributes</strong>(index, attrs, values, mva = false, ignore_non_existent = false) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='UpdateAttributes-instance_method'>UpdateAttributes</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Instantly updates given attribute values in given documents. Returns number
of actually updated documents (0 or more) on success, or -1 on failure.</p>

<p><tt>index</tt> is a name of the index (or indexes) to be updated.
<tt>attrs</tt> is a plain array with string attribute names, listing
attributes that are updated. <tt>values</tt> is a Hash where key is
document ID, and value is a plain array of new attribute values.</p>

<p><tt>index</tt> can be either a single index name or a list, like in
<span class='object_link'><a href="#query-instance_method" title="Sphinx::Client#query (method)">#query</a></span>. Unlike <span class='object_link'><a href="#query-instance_method" title="Sphinx::Client#query (method)">#query</a></span>, wildcard is not allowed and all the indexes to
update must be specified explicitly. The list of indexes can include
distributed index names. Updates on distributed indexes will be pushed to
all agents.</p>

<p>The updates only work with docinfo=extern storage strategy. They are very
fast because they're working fully in RAM, but they can also be made
persistent: updates are saved on disk on clean searchd shutdown initiated
by SIGTERM signal. With additional restrictions, updates are also possible
on MVA attributes; refer to mva_updates_pool directive for details.</p>

<p>The first sample statement will update document 1 in index "test1", setting
"group_id" to 456. The second one will update documents 1001, 1002 and 1003
in index "products". For document 1001, the new price will be set to 123
and the new amount in stock to 5; for document 1002, the new price will be
37 and the new amount will be 11; etc. The third one updates document 1 in
index "test2", setting MVA attribute "group_id" to [456, 789].</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_update_attributes'>update_attributes</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>test1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>group_id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='int'>1</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>456</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='semicolon'>;</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_update_attributes'>update_attributes</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>products</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>price</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>amount_in_stock</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='lbrace'>{</span> <span class='int'>1001</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>123</span><span class='comma'>,</span> <span class='int'>5</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>1002</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>37</span><span class='comma'>,</span> <span class='int'>11</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='int'>1003</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>25</span><span class='comma'>,</span> <span class='int'>129</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='rparen'>)</span><span class='semicolon'>;</span>
<span class='id identifier rubyid_sphinx'>sphinx</span><span class='period'>.</span><span class='id identifier rubyid_update_attributes'>update_attributes</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>test2</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>group_id</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='int'>1</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='int'>456</span><span class='comma'>,</span> <span class='int'>789</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>index</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a name of the index to be updated.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attrs</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an array of attribute name strings.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>values</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>is a hash where key is document id, and value is an array of new attribute
values.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>mva</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>indicating whether to update MVA.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>number of actually updated documents (0 or more) on success, -1 on failure.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Occurred when parameters are invalid.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-updateatttributes" target="_parent" title="Section 6.7.2, &quot;UpdateAttributes&quot;">Section 6.7.2, "UpdateAttributes"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2052
2053
2054
2055
2056
2057
2058
2059
2060
2061
2062
2063
2064
2065
2066
2067
2068
2069
2070
2071
2072
2073
2074
2075
2076
2077
2078
2079
2080
2081
2082
2083
2084
2085
2086
2087
2088
2089
2090
2091
2092
2093
2094
2095
2096
2097
2098
2099
2100
2101
2102
2103
2104
2105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 2052</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_attributes'>update_attributes</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='comma'>,</span> <span class='id identifier rubyid_values'>values</span><span class='comma'>,</span> <span class='id identifier rubyid_mva'>mva</span> <span class='op'>=</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='id identifier rubyid_ignore_non_existent'>ignore_non_existent</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='comment'># verify everything
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;index&quot; argument must be String</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;mva&quot; argument must be Boolean</span><span class='tstring_end'>'</span></span>  <span class='kw'>unless</span> <span class='id identifier rubyid_mva'>mva</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_mva'>mva</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>FalseClass</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;ignore_non_existent&quot; argument must be Boolean</span><span class='tstring_end'>'</span></span>  <span class='kw'>unless</span> <span class='id identifier rubyid_ignore_non_existent'>ignore_non_existent</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>TrueClass</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_ignore_non_existent'>ignore_non_existent</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>FalseClass</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;attrs&quot; argument must be Array</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_attr'>attr</span><span class='op'>|</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;attrs&quot; argument must be Array of Strings</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_attr'>attr</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_attr'>attr</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;values&quot; argument must be Hash</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;values&quot; argument must be Hash map of Integer to Array</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;values&quot; argument must be Hash map of Integer to Array</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\&quot;values\&quot; argument Hash values Array must have </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rbrace'>}</span><span class='tstring_content'> elements</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
    <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_mva'>mva</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;values&quot; argument must be Hash map of Integer to Array of Arrays</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_vv'>vv</span><span class='op'>|</span>
          <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;values&quot; argument must be Hash map of Integer to Array of Arrays of Integers</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_vv'>vv</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;values&quot; argument must be Hash map of Integer to Array of Integers</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># build request
</span>  <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='const'>Request</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='id identifier rubyid_index'>index</span>

  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='id identifier rubyid_ignore_non_existent'>ignore_non_existent</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='int'>0</span>
  <span class='kw'>for</span> <span class='id identifier rubyid_attr'>attr</span> <span class='kw'>in</span> <span class='id identifier rubyid_attrs'>attrs</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_string'>put_string</span> <span class='id identifier rubyid_attr'>attr</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='id identifier rubyid_mva'>mva</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='int'>0</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
    <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int64'>put_int64</span> <span class='id identifier rubyid_id'>id</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_mva'>mva</span>
      <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int_array'>put_int_array</span> <span class='id identifier rubyid_v'>v</span> <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_put_int'>put_int</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_entry'>entry</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='id identifier rubyid_perform_request'>perform_request</span><span class='lparen'>(</span><span class='symbol'>:update</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>

  <span class='comment'># parse response
</span>  <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_get_int'>get_int</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="with_server-instance_method">
  
    
      <span class="overload">- (<tt>Object</tt>) <strong>with_server</strong>(server_index)  <span class="extras">(protected)</span></span>
    
      <span class="overload">- (<tt>Object</tt>) <strong>with_server</strong>(server)  <span class="extras">(protected)</span></span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This is internal method which selects next server (round-robin) and yields
it to the block passed.</p>

<p>In case of connection error, it will try next server several times (see
<span class='object_link'><a href="#set_connect_timeout-instance_method" title="Sphinx::Client#set_connect_timeout (method)">#set_connect_timeout</a></span> method details). If all servers are down, it will
set error attribute (could be retrieved with <span class='object_link'><a href="#last_error-instance_method" title="Sphinx::Client#last_error (method)">#last_error</a></span> method) with the
last exception message, and <span class='object_link'><a href="#connect_error%3F-instance_method" title="Sphinx::Client#connect_error? (method)">#connect_error?</a></span> method will return true.
Also, <span class='object_link'><a href="SphinxConnectError.html" title="Sphinx::SphinxConnectError (class)">SphinxConnectError</a></span> exception will be raised.</p>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>Object</tt>) <strong>with_server</strong>(server_index) </span>
        <div class="docstring">
  <div class="discussion">
    
<p>Get the server based on some seed value (usually CRC32 of request. In this
case initial server will be choosed using this seed value, in case of
connetion failure next server in servers list will be used).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>server_index</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>server index, must be any integer value (not necessarily less than number
of servers.)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attempts</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>how many retries to perform. Use <tt>nil</tt> to perform retries configured
with <span class='object_link'><a href="#set_connect_timeout-instance_method" title="Sphinx::Client#set_connect_timeout (method)">#set_connect_timeout</a></span>.</p>
</div>
      
    </li>
  
</ul>


</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>Object</tt>) <strong>with_server</strong>(server) </span>
        <div class="docstring">
  <div class="discussion">
    
<p>Get the server specified as a parameter. If specified, request will be
performed on specified server, and it will try to establish connection to
this server only once.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>server</span>
      
      
        <span class='type'>(<tt><span class='object_link'>Server</span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>server to perform request on.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>attempts</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>how many retries to perform. Use <tt>nil</tt> to perform retries configured
with <span class='object_link'><a href="#set_connect_timeout-instance_method" title="Sphinx::Client#set_connect_timeout (method)">#set_connect_timeout</a></span>.</p>
</div>
      
    </li>
  
</ul>


</div>
      </li>
    
  </ul>

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>a block which performs request on a given server.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>server</span>
      
      
        <span class='type'>(<tt><span class='object_link'>Sphinx::Server</span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>contains information about the server to perform request on.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="SphinxConnectError.html" title="Sphinx::SphinxConnectError (class)">SphinxConnectError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>on any connection error.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2447
2448
2449
2450
2451
2452
2453
2454
2455
2456
2457
2458
2459
2460
2461
2462
2463
2464
2465
2466
2467
2468
2469
2470
2471
2472
2473
2474
2475
2476
2477
2478
2479
2480
2481</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 2447</span>

<span class='kw'>def</span> <span class='id identifier rubyid_with_server'>with_server</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_attempts'>attempts</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_server'>server</span>
    <span class='kw'>when</span> <span class='const'>Server</span>
      <span class='id identifier rubyid_idx'>idx</span> <span class='op'>=</span> <span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='int'>0</span>
      <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_server'>server</span>
    <span class='kw'>when</span> <span class='const'>Integer</span>
      <span class='id identifier rubyid_idx'>idx</span> <span class='op'>=</span> <span class='id identifier rubyid_server'>server</span> <span class='op'>%</span> <span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
      <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='ivar'>@servers</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span>
    <span class='kw'>when</span> <span class='const'>NilClass</span>
      <span class='id identifier rubyid_idx'>idx</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='ivar'>@servers</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>server argument must be Integer or Sphinx::Server</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_attempts'>attempts</span> <span class='op'>||=</span> <span class='ivar'>@retries</span>
  <span class='kw'>begin</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_s'>s</span>
  <span class='kw'>rescue</span> <span class='const'>SphinxConnectError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[sphinx] server failed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span>
    <span class='comment'># Connection error! Do we need to try it again?
</span>    <span class='id identifier rubyid_attempts'>attempts</span> <span class='op'>-=</span> <span class='int'>1</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_attempts'>attempts</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[sphinx] connection to server </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_content'> DIED! Retrying operation...</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span>
      <span class='comment'># Get the next server
</span>      <span class='id identifier rubyid_idx'>idx</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_idx'>idx</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='op'>%</span> <span class='ivar'>@servers</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
      <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='ivar'>@servers</span><span class='lbracket'>[</span><span class='id identifier rubyid_idx'>idx</span><span class='rbracket'>]</span>
      <span class='kw'>retry</span>
    <span class='kw'>end</span>

    <span class='comment'># Re-raise original exception
</span>    <span class='ivar'>@error</span> <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span>
    <span class='ivar'>@connerror</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_raise'>raise</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="with_socket-instance_method">
  
    - (<tt>Object</tt>) <strong>with_socket</strong>(server) {|socket| ... } <span class="extras">(protected)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This is internal method which retrieves socket for a given server,
initiates Sphinx session, and yields this socket to a block passed.</p>

<p>In case of any problems with session initiation, <span class='object_link'><a href="SphinxConnectError.html" title="Sphinx::SphinxConnectError (class)">SphinxConnectError</a></span> will
be raised, because this is part of connection establishing. See
<span class='object_link'><a href="#with_server-instance_method" title="Sphinx::Client#with_server (method)">#with_server</a></span> method details to get more infromation about how this
exception is handled.</p>

<p>Socket retrieving routine is wrapped in a block with it's own timeout value
(see <span class='object_link'><a href="#set_connect_timeout-instance_method" title="Sphinx::Client#set_connect_timeout (method)">#set_connect_timeout</a></span>). This is done in <span class='object_link'>Server#get_socket</span> method,
so check it for details.</p>

<p>Request execution is wrapped with block with another timeout (see
<span class='object_link'><a href="#set_request_timeout-instance_method" title="Sphinx::Client#set_request_timeout (method)">#set_request_timeout</a></span>). This ensures no Sphinx request will take
unreasonable time.</p>

<p>In case of any Sphinx error (incomplete reply, internal or temporary
error), connection to the server will be re-established, and request will
be retried (see <span class='object_link'><a href="#set_request_timeout-instance_method" title="Sphinx::Client#set_request_timeout (method)">#set_request_timeout</a></span>). Of course, if connection could not
be established, next server will be selected (see explanation above).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>server</span>
      
      
        <span class='type'>(<tt><span class='object_link'>Sphinx::Server</span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>contains information about the server to perform request on.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'>
<p>a block which will actually perform the request.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>socket</span>
      
      
        <span class='type'>(<tt><span class='object_link'>Sphinx::BufferedIO</span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a socket used to perform the request.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="SphinxResponseError.html" title="Sphinx::SphinxResponseError (class)">SphinxResponseError</a></span></tt>, <tt><span class='object_link'><a href="SphinxInternalError.html" title="Sphinx::SphinxInternalError (class)">SphinxInternalError</a></span></tt>, <tt><span class='object_link'><a href="SphinxTemporaryError.html" title="Sphinx::SphinxTemporaryError (class)">SphinxTemporaryError</a></span></tt>, <tt><span class='object_link'><a href="SphinxUnknownError.html" title="Sphinx::SphinxUnknownError (class)">SphinxUnknownError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>on any response error.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="SphinxConnectError.html" title="Sphinx::SphinxConnectError (class)">SphinxConnectError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>on any connection error.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2515
2516
2517
2518
2519
2520
2521
2522
2523
2524
2525
2526
2527
2528
2529
2530
2531
2532
2533
2534
2535
2536
2537
2538
2539
2540
2541
2542
2543
2544
2545
2546
2547
2548
2549
2550
2551
2552
2553
2554
2555
2556
2557
2558
2559
2560
2561
2562
2563
2564
2565
2566
2567
2568
2569</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 2515</span>

<span class='kw'>def</span> <span class='id identifier rubyid_with_socket'>with_socket</span><span class='lparen'>(</span><span class='id identifier rubyid_server'>server</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_attempts'>attempts</span> <span class='op'>=</span> <span class='ivar'>@reqretries</span>
  <span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_get_socket'>get_socket</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sock'>sock</span><span class='op'>|</span>
      <span class='comment'># Remember socket to close it in case of emergency
</span>      <span class='id identifier rubyid_socket'>socket</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span>

      <span class='comment'># send my version
</span>      <span class='comment'># this is a subtle part. we must do it before (!) reading back from searchd.
</span>      <span class='comment'># because otherwise under some conditions (reported on FreeBSD for instance)
</span>      <span class='comment'># TCP stack could throttle write-write-read pattern because of Nagle.
</span>      <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>N</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_v'>v</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='int'>4</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>N*</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

      <span class='comment'># Ouch, invalid protocol!
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_v'>v</span> <span class='op'>&lt;</span> <span class='int'>1</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>SphinxConnectError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>expected searchd protocol version 1+, got version '</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v'>v</span><span class='rbrace'>}</span><span class='tstring_content'>'</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

    <span class='const'>Sphinx</span><span class='op'>::</span><span class='id identifier rubyid_safe_execute'>safe_execute</span><span class='lparen'>(</span><span class='ivar'>@reqtimeout</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_s'>s</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'>SocketError</span><span class='comma'>,</span> <span class='const'>SystemCallError</span><span class='comma'>,</span> <span class='const'>IOError</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>Errno</span><span class='op'>::</span><span class='const'>EPIPE</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[sphinx] socket failure: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span>
    <span class='comment'># Ouch, communication problem, will be treated as a connection problem.
</span>    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>SphinxConnectError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>failed to read searchd response (msg=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>rescue</span> <span class='const'>SphinxResponseError</span><span class='comma'>,</span> <span class='const'>SphinxInternalError</span><span class='comma'>,</span> <span class='const'>SphinxTemporaryError</span><span class='comma'>,</span> <span class='const'>SphinxUnknownError</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span><span class='comma'>,</span> <span class='const'>EOFError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='comment'># EOFError should not occur in ideal world, because we compare response length
</span>    <span class='comment'># with a value passed by Sphinx. But we want to ensure that client will not
</span>    <span class='comment'># fail with unexpected error when Sphinx implementation has bugs, aren't we?
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>EOFError</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='op'>::</span><span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_e'>new_e</span> <span class='op'>=</span> <span class='const'>SphinxResponseError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>failed to read searchd response (msg=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_e'>new_e</span><span class='period'>.</span><span class='id identifier rubyid_set_backtrace'>set_backtrace</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_backtrace'>backtrace</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_new_e'>new_e</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_warn'>warn</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>[sphinx] generic failure: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rbrace'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_logger'>logger</span>

    <span class='comment'># Close previously opened socket (in case of it has been really opened)
</span>    <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_free_socket'>free_socket</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='rparen'>)</span>

    <span class='comment'># Request error! Do we need to try it again?
</span>    <span class='id identifier rubyid_attempts'>attempts</span> <span class='op'>-=</span> <span class='int'>1</span>
    <span class='kw'>retry</span> <span class='kw'>if</span> <span class='id identifier rubyid_attempts'>attempts</span> <span class='op'>&gt;</span> <span class='int'>0</span>

    <span class='comment'># Re-raise original exception
</span>    <span class='ivar'>@error</span> <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_e'>e</span>
  <span class='kw'>ensure</span>
    <span class='comment'># Close previously opened socket on any other error
</span>    <span class='id identifier rubyid_server'>server</span><span class='period'>.</span><span class='id identifier rubyid_free_socket'>free_socket</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Thu Mar 14 12:34:40 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.5.2 (ruby-1.9.3).
</div>

  </body>
</html>