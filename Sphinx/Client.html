<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=UTF-8" />
<title>Class: Sphinx::Client</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (C)</a> &raquo; 
    <a href="../Sphinx.html" title="Sphinx">Sphinx</a>
     &raquo; 
    <span class="title">Client</span>
  
</div>

      <div id="search">
  <a id="class_list_link" href="#">Namespace List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Sphinx::Client 
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
      </dd>
    
  
  
    
  
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/sphinx/client.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
The Sphinx Client API is used to communicate with <tt>searchd</tt> daemon
and perform requests.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span> <span class='assign token'>=</span> <span class='Sphinx constant id'>Sphinx</span><span class='colon2 op'>::</span><span class='Client constant id'>Client</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='Query constant id'>Query</span><span class='lparen token'>(</span><span class='string val'>'test'</span><span class='rparen token'>)</span>
  <span class='ids identifier id'>ids</span> <span class='assign token'>=</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'matches'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='match identifier id'>match</span><span class='bitor op'>|</span> <span class='match identifier id'>match</span><span class='lbrack token'>[</span><span class='string val'>'id'</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span>
  <span class='posts identifier id'>posts</span> <span class='assign token'>=</span> <span class='Post constant id'>Post</span><span class='dot token'>.</span><span class='all identifier id'>all</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='ids identifier id'>ids</span> <span class='rbrace token'>}</span><span class='comma token'>,</span>
                   <span class='symbol val'>:order</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;FIELD(id,#{ids.join(',')})&quot;</span>

  <span class='docs identifier id'>docs</span> <span class='assign token'>=</span> <span class='posts identifier id'>posts</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:body</span><span class='rparen token'>)</span>
  <span class='excerpts identifier id'>excerpts</span> <span class='assign token'>=</span> <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='BuildExcerpts constant id'>BuildExcerpts</span><span class='lparen token'>(</span><span class='docs identifier id'>docs</span><span class='comma token'>,</span> <span class='string val'>'index'</span><span class='comma token'>,</span> <span class='string val'>'test'</span><span class='rparen token'>)</span>
</pre>
    
  </div>

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="SPH_MATCH_ALL-constant ">SPH_MATCH_ALL =
            <span class="summary_desc">
match all query words.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>0</span>
</pre></dd>
      
        <dt id="SPH_MATCH_ANY-constant ">SPH_MATCH_ANY =
            <span class="summary_desc">
match any query word.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>1</span>
</pre></dd>
      
        <dt id="SPH_MATCH_PHRASE-constant ">SPH_MATCH_PHRASE =
            <span class="summary_desc">
match this exact phrase.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>2</span>
</pre></dd>
      
        <dt id="SPH_MATCH_BOOLEAN-constant ">SPH_MATCH_BOOLEAN =
            <span class="summary_desc">
match this boolean query.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>3</span>
</pre></dd>
      
        <dt id="SPH_MATCH_EXTENDED-constant ">SPH_MATCH_EXTENDED =
            <span class="summary_desc">
match this extended query.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>4</span>
</pre></dd>
      
        <dt id="SPH_MATCH_FULLSCAN-constant ">SPH_MATCH_FULLSCAN =
            <span class="summary_desc">
match all document IDs w/o fulltext query, apply filters.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>5</span>
</pre></dd>
      
        <dt id="SPH_MATCH_EXTENDED2-constant ">SPH_MATCH_EXTENDED2 =
            <span class="summary_desc">
extended engine V2 (TEMPORARY, WILL BE REMOVED IN 0.9.8-RELEASE).

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>6</span>
</pre></dd>
      
        <dt id="SPH_RANK_PROXIMITY_BM25-constant ">SPH_RANK_PROXIMITY_BM25 =
            <span class="summary_desc">
default mode, phrase proximity major factor and BM25 minor one.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>0</span>
</pre></dd>
      
        <dt id="SPH_RANK_BM25-constant ">SPH_RANK_BM25 =
            <span class="summary_desc">
statistical mode, BM25 ranking only (faster but worse quality).

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>1</span>
</pre></dd>
      
        <dt id="SPH_RANK_NONE-constant ">SPH_RANK_NONE =
            <span class="summary_desc">
no ranking, all matches get a weight of 1.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>2</span>
</pre></dd>
      
        <dt id="SPH_RANK_WORDCOUNT-constant ">SPH_RANK_WORDCOUNT =
            <span class="summary_desc">
simple word-count weighting, rank is a weighted sum of per-field keyword
occurence counts.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>3</span>
</pre></dd>
      
        <dt id="SPH_RANK_PROXIMITY-constant ">SPH_RANK_PROXIMITY =
            <span class="summary_desc">
phrase proximity.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>4</span>
</pre></dd>
      
        <dt id="SPH_RANK_MATCHANY-constant ">SPH_RANK_MATCHANY =
            <span class="summary_desc">
emulate old match-any weighting.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>5</span>
</pre></dd>
      
        <dt id="SPH_RANK_FIELDMASK-constant ">SPH_RANK_FIELDMASK =
            <span class="summary_desc">
sets bits where there were matches.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>6</span>
</pre></dd>
      
        <dt id="SPH_RANK_SPH04-constant ">SPH_RANK_SPH04 =
            <span class="summary_desc">
codename SPH04, phrase proximity + bm25 + head/exact boost.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>7</span>
</pre></dd>
      
        <dt id="SPH_SORT_RELEVANCE-constant ">SPH_SORT_RELEVANCE =
            <span class="summary_desc">
sort by document relevance desc, then by date.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>0</span>
</pre></dd>
      
        <dt id="SPH_SORT_ATTR_DESC-constant ">SPH_SORT_ATTR_DESC =
            <span class="summary_desc">
sort by document date desc, then by relevance desc.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>1</span>
</pre></dd>
      
        <dt id="SPH_SORT_ATTR_ASC-constant ">SPH_SORT_ATTR_ASC =
            <span class="summary_desc">
sort by document date asc, then by relevance desc.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>2</span>
</pre></dd>
      
        <dt id="SPH_SORT_TIME_SEGMENTS-constant ">SPH_SORT_TIME_SEGMENTS =
            <span class="summary_desc">
sort by time segments (hour/day/week/etc) desc, then by relevance desc.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>3</span>
</pre></dd>
      
        <dt id="SPH_SORT_EXTENDED-constant ">SPH_SORT_EXTENDED =
            <span class="summary_desc">
sort by SQL-like expression (eg. &quot;@relevance DESC, price ASC, @id
DESC&quot;).

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>4</span>
</pre></dd>
      
        <dt id="SPH_SORT_EXPR-constant ">SPH_SORT_EXPR =
            <span class="summary_desc">
sort by arithmetic expression in descending order (eg. &quot;@id +
max(@weight,1000)*boost + log(price)&quot;).

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>5</span>
</pre></dd>
      
        <dt id="SPH_FILTER_VALUES-constant ">SPH_FILTER_VALUES =
            <span class="summary_desc">
filter by integer values set.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>0</span>
</pre></dd>
      
        <dt id="SPH_FILTER_RANGE-constant ">SPH_FILTER_RANGE =
            <span class="summary_desc">
filter by integer range.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>1</span>
</pre></dd>
      
        <dt id="SPH_FILTER_FLOATRANGE-constant ">SPH_FILTER_FLOATRANGE =
            <span class="summary_desc">
filter by float range.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>2</span>
</pre></dd>
      
        <dt id="SPH_ATTR_INTEGER-constant ">SPH_ATTR_INTEGER =
            <span class="summary_desc">
this attr is just an integer.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>1</span>
</pre></dd>
      
        <dt id="SPH_ATTR_TIMESTAMP-constant ">SPH_ATTR_TIMESTAMP =
            <span class="summary_desc">
this attr is a timestamp.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>2</span>
</pre></dd>
      
        <dt id="SPH_ATTR_ORDINAL-constant ">SPH_ATTR_ORDINAL =
            <span class="summary_desc">
this attr is an ordinal string number (integer at search time, specially
handled at indexing time).

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>3</span>
</pre></dd>
      
        <dt id="SPH_ATTR_BOOL-constant ">SPH_ATTR_BOOL =
            <span class="summary_desc">
this attr is a boolean bit field.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>4</span>
</pre></dd>
      
        <dt id="SPH_ATTR_FLOAT-constant ">SPH_ATTR_FLOAT =
            <span class="summary_desc">
this attr is a float.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>5</span>
</pre></dd>
      
        <dt id="SPH_ATTR_BIGINT-constant ">SPH_ATTR_BIGINT =
            <span class="summary_desc">
signed 64-bit integer.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>6</span>
</pre></dd>
      
        <dt id="SPH_ATTR_STRING-constant ">SPH_ATTR_STRING =
            <span class="summary_desc">
string (binary; in-memory).

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>7</span>
</pre></dd>
      
        <dt id="SPH_ATTR_MULTI-constant ">SPH_ATTR_MULTI =
            <span class="summary_desc">
this attr has multiple values (0 or more).

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>0x40000000</span>
</pre></dd>
      
        <dt id="SPH_GROUPBY_DAY-constant ">SPH_GROUPBY_DAY =
            <span class="summary_desc">
group by day.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>0</span>
</pre></dd>
      
        <dt id="SPH_GROUPBY_WEEK-constant ">SPH_GROUPBY_WEEK =
            <span class="summary_desc">
group by week.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>1</span>
</pre></dd>
      
        <dt id="SPH_GROUPBY_MONTH-constant ">SPH_GROUPBY_MONTH =
            <span class="summary_desc">
group by month.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>2</span>
</pre></dd>
      
        <dt id="SPH_GROUPBY_YEAR-constant ">SPH_GROUPBY_YEAR =
            <span class="summary_desc">
group by year.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>3</span>
</pre></dd>
      
        <dt id="SPH_GROUPBY_ATTR-constant ">SPH_GROUPBY_ATTR =
            <span class="summary_desc">
group by attribute value.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>4</span>
</pre></dd>
      
        <dt id="SPH_GROUPBY_ATTRPAIR-constant ">SPH_GROUPBY_ATTRPAIR =
            <span class="summary_desc">
group by sequential attrs pair.

</span>
        </dt>
        <dd><pre class="code"><span class='integer val'>5</span>
</pre></dd>
      
    </dl>
  



  <h2>Method Summary</h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature"><a href="#AddQuery-instance_method" title="#AddQuery (instance method)">- (Integer) <strong>AddQuery</strong>(query, index = '*', comment = '') </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Adds additional query with current settings to multi-query batch.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#BuildExcerpts-instance_method" title="#BuildExcerpts (instance method)">- (Array&lt;String&gt;) <strong>BuildExcerpts</strong>(docs, index, words, opts = {}) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Excerpts (snippets) builder function.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#BuildKeywords-instance_method" title="#BuildKeywords (instance method)">- (Array&lt;Hash&gt;) <strong>BuildKeywords</strong>(query, index, hits) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Extracts keywords from query using tokenizer settings for given index,
optionally with per-keyword occurrence statistics.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#Close-instance_method" title="#Close (instance method)">- (Boolean) <strong>Close</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Closes previously opened persistent connection.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#FlushAttrs-instance_method" title="#FlushAttrs (instance method)">- (Object) <strong>FlushAttrs</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Force attribute flush, and block until it completes.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#GetLastError-instance_method" title="#GetLastError (instance method)">- (String) <strong>GetLastError</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Returns last error message, as a string, in human readable format.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#GetLastWarning-instance_method" title="#GetLastWarning (instance method)">- (String) <strong>GetLastWarning</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Returns last warning message, as a string, in human readable format.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#IsConnectError-instance_method" title="#IsConnectError (instance method)">- (Boolean) <strong>IsConnectError</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Checks whether the last error was a network error on API side, or a remote
error reported by searchd.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#Open-instance_method" title="#Open (instance method)">- (Boolean) <strong>Open</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Opens persistent connection to the server.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#Query-instance_method" title="#Query (instance method)">- (Hash) <strong>Query</strong>(query, index = '*', comment = '') </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Connects to searchd server, runs given search query with current settings,
obtains and returns the result set.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#ResetFilters-instance_method" title="#ResetFilters (instance method)">- (Object) <strong>ResetFilters</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Clears all currently set filters.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#ResetGroupBy-instance_method" title="#ResetGroupBy (instance method)">- (Object) <strong>ResetGroupBy</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Clears all currently group-by settings, and disables group-by.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#ResetOverrides-instance_method" title="#ResetOverrides (instance method)">- (Object) <strong>ResetOverrides</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Clear all attribute value overrides (for multi-queries).

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#RunQueries-instance_method" title="#RunQueries (instance method)">- (Array&lt;Hash&gt;) <strong>RunQueries</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Connect to searchd, runs a batch of all queries added using <tt><a href="#AddQuery-instance_method" title="#AddQuery">#AddQuery</a></tt>,
obtains and returns the result sets.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetConnectTimeout-instance_method" title="#SetConnectTimeout (instance method)">- (Object) <strong>SetConnectTimeout</strong>(timeout, retries = 1) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Sets the time allowed to spend connecting to the server before giving up
and number of retries to perform.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetFieldWeights-instance_method" title="#SetFieldWeights (instance method)">- (Object) <strong>SetFieldWeights</strong>(weights) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Binds per-field weights by name.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetFilter-instance_method" title="#SetFilter (instance method)">- (Object) <strong>SetFilter</strong>(attribute, values, exclude = false) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Adds new integer values set filter.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetFilterFloatRange-instance_method" title="#SetFilterFloatRange (instance method)">- (Object) <strong>SetFilterFloatRange</strong>(attribute, min, max, exclude = false) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Adds new float range filter.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetFilterRange-instance_method" title="#SetFilterRange (instance method)">- (Object) <strong>SetFilterRange</strong>(attribute, min, max, exclude = false) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Adds new integer range filter.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetGeoAnchor-instance_method" title="#SetGeoAnchor (instance method)">- (Object) <strong>SetGeoAnchor</strong>(attrlat, attrlong, lat, long) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Sets anchor point for and geosphere distance (geodistance) calculations,
and enable them.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetGroupBy-instance_method" title="#SetGroupBy (instance method)">- (Object) <strong>SetGroupBy</strong>(attribute, func, groupsort = '@group desc') </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Sets grouping attribute, function, and groups sorting mode; and enables
grouping (as described in Section 4.6, &quot;Grouping (clustering) search
results&quot;).

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetGroupDistinct-instance_method" title="#SetGroupDistinct (instance method)">- (Object) <strong>SetGroupDistinct</strong>(attribute) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Sets attribute name for per-group distinct values count calculations.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetIDRange-instance_method" title="#SetIDRange (instance method)">- (Object) <strong>SetIDRange</strong>(min, max) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Sets an accepted range of document IDs.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetIndexWeights-instance_method" title="#SetIndexWeights (instance method)">- (Object) <strong>SetIndexWeights</strong>(weights) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Sets per-index weights, and enables weighted summing of match weights
across different indexes.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetLimits-instance_method" title="#SetLimits (instance method)">- (Object) <strong>SetLimits</strong>(offset, limit, max = 0, cutoff = 0) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Sets offset into server-side result set (<tt>offset</tt>) and amount of
matches to return to client starting from that offset (<tt>limit</tt>).

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetMatchMode-instance_method" title="#SetMatchMode (instance method)">- (Object) <strong>SetMatchMode</strong>(mode) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Sets full-text query matching mode.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetMaxQueryTime-instance_method" title="#SetMaxQueryTime (instance method)">- (Object) <strong>SetMaxQueryTime</strong>(max) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Sets maximum search query time, in milliseconds.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetOverride-instance_method" title="#SetOverride (instance method)">- (Object) <strong>SetOverride</strong>(attribute, attrtype, values) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Sets temporary (per-query) per-document attribute value overrides.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetRankingMode-instance_method" title="#SetRankingMode (instance method)">- (Object) <strong>SetRankingMode</strong>(ranker) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Sets ranking mode.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetRequestTimeout-instance_method" title="#SetRequestTimeout (instance method)">- (Object) <strong>SetRequestTimeout</strong>(timeout, retries = 1) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Sets the time allowed to spend performing request to the server before
giving up and number of retries to perform.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetRetries-instance_method" title="#SetRetries (instance method)">- (Object) <strong>SetRetries</strong>(count, delay = 0) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Sets distributed retry count and delay.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetSelect-instance_method" title="#SetSelect (instance method)">- (Object) <strong>SetSelect</strong>(select) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Sets the select clause, listing specific attributes to fetch, and
expressions to compute and fetch.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetServer-instance_method" title="#SetServer (instance method)">- (Sphinx::Server) <strong>SetServer</strong>(host, port = 9312) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Sets searchd host name and TCP port.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetServers-instance_method" title="#SetServers (instance method)">- (Array&lt;Sphinx::Server&gt;) <strong>SetServers</strong>(servers) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Sets the list of searchd servers.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#SetSortMode-instance_method" title="#SetSortMode (instance method)">- (Object) <strong>SetSortMode</strong>(mode, sortby = '') </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Set matches sorting mode.

</span>
  
</li>

    
      <li class="public deprecated">
  <span class="summary_signature"><a href="#SetWeights-instance_method" title="#SetWeights (instance method)">- (Object) <strong>SetWeights</strong>(weights) </a>
  
  </span>
  
  
  
  <span class="deprecated note title">Deprecated</span>

  
    <span class="summary_desc"><strong>Deprecated.</strong> 
Use <tt><a href="#SetFieldWeights-instance_method" title="#SetFieldWeights">#SetFieldWeights</a></tt> instead.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#Status-instance_method" title="#Status (instance method)">- (Array&lt;Array&gt;) <strong>Status</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Queries searchd status, and returns an array of status variable name and
value pairs.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#UpdateAttributes-instance_method" title="#UpdateAttributes (instance method)">- (Integer) <strong>UpdateAttributes</strong>(index, attrs, values, mva = false) </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Instantly updates given attribute values in given documents.

</span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature"><a href="#initialize-instance_method" title="#initialize (instance method)">- (Client) <strong>initialize</strong> </a>
  
  </span>
  
  
  
  

  
    <span class="summary_desc">
Constructs the <tt>Sphinx::Client</tt> object and sets options to their
default values.

</span>
  
</li>

    
  </ul>

<div id="constructor_details">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><a href="" title="Client">Client</a></tt>) <strong>initialize</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Constructs the <tt>Sphinx::Client</tt> object and sets options to their
default values.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt><a href="" title="Client">Client</a></tt>)</span>
      
      
      
      
        &mdash;
        
a new instance of <tt>Client</tt>


      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 232</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span>
  <span class='comment val'># per-query settings</span>
  <span class='@offset ivar id'>@offset</span>        <span class='assign token'>=</span> <span class='integer val'>0</span>                       <span class='comment val'># how many records to seek from result-set start (default is 0)</span>
  <span class='@limit ivar id'>@limit</span>         <span class='assign token'>=</span> <span class='integer val'>20</span>                      <span class='comment val'># how many records to return from result-set starting at offset (default is 20)</span>
  <span class='@mode ivar id'>@mode</span>          <span class='assign token'>=</span> <span class='SPH_MATCH_ALL constant id'>SPH_MATCH_ALL</span>           <span class='comment val'># query matching mode (default is SPH_MATCH_ALL)</span>
  <span class='@weights ivar id'>@weights</span>       <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>                      <span class='comment val'># per-field weights (default is 1 for all fields)</span>
  <span class='@sort ivar id'>@sort</span>          <span class='assign token'>=</span> <span class='SPH_SORT_RELEVANCE constant id'>SPH_SORT_RELEVANCE</span>      <span class='comment val'># match sorting mode (default is SPH_SORT_RELEVANCE)</span>
  <span class='@sortby ivar id'>@sortby</span>        <span class='assign token'>=</span> <span class='string val'>''</span>                      <span class='comment val'># attribute to sort by (defualt is &quot;&quot;)</span>
  <span class='@min_id ivar id'>@min_id</span>        <span class='assign token'>=</span> <span class='integer val'>0</span>                       <span class='comment val'># min ID to match (default is 0, which means no limit)</span>
  <span class='@max_id ivar id'>@max_id</span>        <span class='assign token'>=</span> <span class='integer val'>0</span>                       <span class='comment val'># max ID to match (default is 0, which means no limit)</span>
  <span class='@filters ivar id'>@filters</span>       <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>                      <span class='comment val'># search filters</span>
  <span class='@groupby ivar id'>@groupby</span>       <span class='assign token'>=</span> <span class='string val'>''</span>                      <span class='comment val'># group-by attribute name</span>
  <span class='@groupfunc ivar id'>@groupfunc</span>     <span class='assign token'>=</span> <span class='SPH_GROUPBY_DAY constant id'>SPH_GROUPBY_DAY</span>         <span class='comment val'># function to pre-process group-by attribute value with</span>
  <span class='@groupsort ivar id'>@groupsort</span>     <span class='assign token'>=</span> <span class='string val'>'@group desc'</span>           <span class='comment val'># group-by sorting clause (to sort groups in result set with)</span>
  <span class='@groupdistinct ivar id'>@groupdistinct</span> <span class='assign token'>=</span> <span class='string val'>''</span>                      <span class='comment val'># group-by count-distinct attribute</span>
  <span class='@maxmatches ivar id'>@maxmatches</span>    <span class='assign token'>=</span> <span class='integer val'>1000</span>                    <span class='comment val'># max matches to retrieve</span>
  <span class='@cutoff ivar id'>@cutoff</span>        <span class='assign token'>=</span> <span class='integer val'>0</span>                       <span class='comment val'># cutoff to stop searching at (default is 0)</span>
  <span class='@retrycount ivar id'>@retrycount</span>    <span class='assign token'>=</span> <span class='integer val'>0</span>                       <span class='comment val'># distributed retries count</span>
  <span class='@retrydelay ivar id'>@retrydelay</span>    <span class='assign token'>=</span> <span class='integer val'>0</span>                       <span class='comment val'># distributed retries delay</span>
  <span class='@anchor ivar id'>@anchor</span>        <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>                      <span class='comment val'># geographical anchor point</span>
  <span class='@indexweights ivar id'>@indexweights</span>  <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>                      <span class='comment val'># per-index weights</span>
  <span class='@ranker ivar id'>@ranker</span>        <span class='assign token'>=</span> <span class='SPH_RANK_PROXIMITY_BM25 constant id'>SPH_RANK_PROXIMITY_BM25</span> <span class='comment val'># ranking mode (default is SPH_RANK_PROXIMITY_BM25)</span>
  <span class='@maxquerytime ivar id'>@maxquerytime</span>  <span class='assign token'>=</span> <span class='integer val'>0</span>                       <span class='comment val'># max query time, milliseconds (default is 0, do not limit)</span>
  <span class='@fieldweights ivar id'>@fieldweights</span>  <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>                      <span class='comment val'># per-field-name weights</span>
  <span class='@overrides ivar id'>@overrides</span>     <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>                      <span class='comment val'># per-query attribute values overrides</span>
  <span class='@select ivar id'>@select</span>        <span class='assign token'>=</span> <span class='string val'>'*'</span>                     <span class='comment val'># select-list (attributes or expressions, with optional aliases)</span>

  <span class='comment val'># per-reply fields (for single-query case)</span>
  <span class='@error ivar id'>@error</span>         <span class='assign token'>=</span> <span class='string val'>''</span>                      <span class='comment val'># last error message</span>
  <span class='@warning ivar id'>@warning</span>       <span class='assign token'>=</span> <span class='string val'>''</span>                      <span class='comment val'># last warning message</span>
  <span class='@connerror ivar id'>@connerror</span>     <span class='assign token'>=</span> <span class='false false kw'>false</span>                   <span class='comment val'># connection error vs remote error flag</span>

  <span class='@reqs ivar id'>@reqs</span>          <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>                      <span class='comment val'># requests storage (for multi-query case)</span>
  <span class='@mbenc ivar id'>@mbenc</span>         <span class='assign token'>=</span> <span class='string val'>''</span>                      <span class='comment val'># stored mbstring encoding</span>
  <span class='@timeout ivar id'>@timeout</span>       <span class='assign token'>=</span> <span class='integer val'>0</span>                       <span class='comment val'># connect timeout</span>
  <span class='@retries ivar id'>@retries</span>       <span class='assign token'>=</span> <span class='integer val'>1</span>                       <span class='comment val'># number of connect retries in case of emergency</span>
  <span class='@reqtimeout ivar id'>@reqtimeout</span>    <span class='assign token'>=</span> <span class='integer val'>0</span>                       <span class='comment val'># request timeout</span>
  <span class='@reqretries ivar id'>@reqretries</span>    <span class='assign token'>=</span> <span class='integer val'>1</span>                       <span class='comment val'># number of request retries in case of emergency</span>

  <span class='comment val'># per-client-object settings</span>
  <span class='comment val'># searchd servers list</span>
  <span class='@servers ivar id'>@servers</span>       <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='Sphinx constant id'>Sphinx</span><span class='colon2 op'>::</span><span class='Server constant id'>Server</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='string val'>'localhost'</span><span class='comma token'>,</span> <span class='integer val'>9312</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='rparen token'>)</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='freeze identifier id'>freeze</span>
  <span class='@lastserver ivar id'>@lastserver</span>    <span class='assign token'>=</span> <span class='integer val'>-1</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="method_details">
    <h2>Method Details</h2>
    
      <div class="method_details first">
  <p class="signature first" id="AddQuery-instance_method">
  
    - (<tt>Integer</tt>) <strong>AddQuery</strong>(query, index = '*', comment = '') 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Adds additional query with current settings to multi-query batch.
<tt>query</tt> is a query string. <tt>index</tt> is an index name (or
names) string. Additionally if provided, the contents of <tt>comment</tt>
are sent to the query log, marked in square brackets, just before the
search terms, which can be very useful for debugging. Currently, this is
limited to 128 characters. Returns index to results array returned from
<tt><a href="#RunQueries-instance_method" title="#RunQueries">#RunQueries</a></tt>.
</p>
<p>
Batch queries (or multi-queries) enable searchd to perform internal
optimizations if possible. They also reduce network connection overheads
and search process creation overheads in all cases. They do not result in
any additional overheads compared to simple queries. Thus, if you run
several different queries from your web page, you should always consider
using multi-queries.
</p>
<p>
For instance, running the same full-text query but with different sorting
or group-by settings will enable searchd to perform expensive full-text
search and ranking operation only once, but compute multiple group-by
results from its output.
</p>
<p>
This can be a big saver when you need to display not just plain search
results but also some per-category counts, such as the amount of products
grouped by vendor. Without multi-query, you would have to run several
queries which perform essentially the same search and retrieve the same
matches, but create result sets differently. With multi-query, you simply
pass all these queries in a single batch and Sphinx optimizes the redundant
full-text search internally.
</p>
<p>
<tt><a href="#AddQuery-instance_method" title="#AddQuery">#AddQuery</a></tt> internally saves full current settings state along with the
query, and you can safely change them afterwards for subsequent <tt><a href="#AddQuery-instance_method" title="#AddQuery">#AddQuery</a></tt>
calls. Already added queries will not be affected; there&#8217;s actually
no way to change them at all. Here&#8217;s an example:
</p>
<pre class="code">
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetSortMode constant id'>SetSortMode</span><span class='lparen token'>(</span><span class='symbol val'>:relevance</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='AddQuery constant id'>AddQuery</span><span class='lparen token'>(</span><span class='string val'>&quot;hello world&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;documents&quot;</span><span class='rparen token'>)</span>

  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetSortMode constant id'>SetSortMode</span><span class='lparen token'>(</span><span class='symbol val'>:attr_desc</span><span class='comma token'>,</span> <span class='symbol val'>:price</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='AddQuery constant id'>AddQuery</span><span class='lparen token'>(</span><span class='string val'>&quot;ipod&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;products&quot;</span><span class='rparen token'>)</span>

  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='AddQuery constant id'>AddQuery</span><span class='lparen token'>(</span><span class='string val'>&quot;harry potter&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;books&quot;</span><span class='rparen token'>)</span>

  <span class='results identifier id'>results</span> <span class='assign token'>=</span> <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='RunQueries constant id'>RunQueries</span>
</pre>
<p>
With the code above, 1st query will search for &quot;hello world&quot; in
&quot;documents&quot; index and sort results by relevance, 2nd query will
search for &quot;ipod&quot; in &quot;products&quot; index and sort results
by price, and 3rd query will search for &quot;harry potter&quot; in
&quot;books&quot; index while still sorting by price. Note that 2nd
<tt><a href="#SetSortMode-instance_method" title="#SetSortMode">#SetSortMode</a></tt> call does not affect the first query (because it&#8217;s
already added) but affects both other subsequent queries.
</p>
<p>
Additionally, any filters set up before an <tt><a href="#AddQuery-instance_method" title="#AddQuery">#AddQuery</a></tt> will fall through to
subsequent queries. So, if <tt><a href="#SetFilter-instance_method" title="#SetFilter">#SetFilter</a></tt> is called before the first query,
the same filter will be in place for the second (and subsequent) queries
batched through <tt><a href="#AddQuery-instance_method" title="#AddQuery">#AddQuery</a></tt> unless you call <tt><a href="#ResetFilters-instance_method" title="#ResetFilters">#ResetFilters</a></tt> first.
Alternatively, you can add additional filters as well.
</p>
<p>
This would also be true for grouping options and sorting options; no
current sorting, filtering, and grouping settings are affected by this
call; so subsequent queries will reuse current query settings.
</p>
<p>
<tt><a href="#AddQuery-instance_method" title="#AddQuery">#AddQuery</a></tt> returns an index into an array of results that will be returned
from <tt><a href="#RunQueries-instance_method" title="#RunQueries">#RunQueries</a></tt> call. It is simply a sequentially increasing 0-based
integer, ie. first call will return 0, second will return 1, and so on.
Just a small helper so you won&#8217;t have to track the indexes manualy if
you need then.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='AddQuery constant id'>AddQuery</span><span class='lparen token'>(</span><span class='string val'>'some search text'</span><span class='comma token'>,</span> <span class='string val'>'*'</span><span class='comma token'>,</span> <span class='string val'>'search page'</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>query</span>
      
      
      
        &mdash;
        
a query string.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>index</span>
      
      
        <em class="default">(defaults to: <tt>'*'</tt>)</em>
      
      
        &mdash;
        
an index name (or names).


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>comment</span>
      
      
        <em class="default">(defaults to: <tt>''</tt>)</em>
      
      
        &mdash;
        
a comment to be sent to the query log.


      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
      
        &mdash;
        
an index into an array of results that will be returned from <tt><a href="#RunQueries-instance_method" title="#RunQueries">#RunQueries</a></tt>
call.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-addquery" title="Section 6.6.2, \"AddQuery\"">Section 6.6.2, "AddQuery"</a></li>
    
      <li><a href="#Query-instance_method" title="#Query">#Query</a></li>
    
      <li><a href="#RunQueries-instance_method" title="#RunQueries">#RunQueries</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1507
1508
1509
1510
1511
1512
1513
1514
1515
1516
1517
1518
1519
1520
1521
1522
1523
1524
1525
1526
1527
1528
1529
1530
1531
1532
1533
1534
1535
1536
1537
1538
1539
1540
1541
1542
1543
1544
1545
1546
1547
1548
1549
1550
1551
1552
1553
1554
1555
1556
1557
1558
1559
1560
1561
1562
1563
1564
1565
1566
1567
1568
1569
1570
1571
1572
1573
1574
1575
1576
1577
1578
1579
1580
1581
1582
1583
1584
1585
1586
1587
1588
1589
1590
1591
1592
1593
1594
1595
1596
1597
1598
1599
1600
1601
1602
1603
1604
1605
1606
1607
1608
1609
1610
1611
1612
1613
1614
1615
1616
1617
1618
1619
1620
1621
1622
1623
1624
1625
1626
1627
1628
1629
1630
1631
1632
1633
1634
1635
1636
1637
1638
1639
1640
1641
1642
1643
1644
1645
1646
1647
1648
1649
1650
1651
1652
1653
1654
1655
1656
1657
1658
1659
1660
1661
1662
1663
1664
1665
1666
1667
1668
1669
1670
1671
1672
1673
1674
1675
1676
1677
1678
1679
1680
1681
1682
1683
1684
1685
1686
1687
1688
1689
1690
1691
1692
1693
1694
1695
1696
1697
1698
1699
1700
1701
1702
1703
1704
1705
1706
1707
1708
1709
1710
1711
1712
1713
1714
1715
1716
1717
1718
1719
1720
1721
1722
1723
1724
1725
1726
1727
1728
1729
1730
1731
1732
1733
1734
1735
1736
1737
1738
1739
1740
1741
1742
1743
1744
1745
1746
1747
1748
1749
1750
1751
1752
1753
1754
1755
1756
1757
1758
1759
1760
1761
1762
1763
1764
1765
1766
1767
1768
1769
1770
1771
1772
1773
1774
1775
1776
1777
1778
1779
1780
1781
1782
1783
1784
1785
1786
1787
1788
1789
1790
1791
1792
1793
1794
1795
1796
1797
1798
1799
1800
1801
1802
1803
1804
1805
1806
1807
1808
1809
1810
1811
1812
1813
1814
1815
1816
1817
1818
1819
1820
1821
1822
1823
1824
1825
1826
1827
1828
1829
1830
1831
1832
1833
1834
1835
1836
1837
1838
1839
1840
1841
1842
1843
1844
1845
1846
1847
1848
1849
1850
1851
1852
1853
1854
1855
1856
1857
1858
1859
1860
1861
1862
1863
1864
1865
1866
1867
1868
1869
1870
1871
1872
1873
1874
1875
1876
1877
1878
1879
1880
1881
1882
1883
1884
1885
1886
1887
1888
1889
1890
1891
1892
1893
1894
1895
1896
1897
1898
1899
1900
1901
1902
1903
1904
1905
1906
1907
1908
1909
1910
1911
1912
1913
1914
1915
1916
1917
1918
1919
1920
1921
1922
1923
1924
1925
1926
1927
1928
1929
1930
1931
1932
1933
1934
1935
1936
1937
1938
1939
1940
1941
1942
1943
1944
1945
1946
1947
1948
1949
1950
1951
1952
1953
1954
1955
1956
1957
1958
1959
1960
1961
1962
1963
1964
1965
1966
1967
1968
1969
1970
1971
1972
1973
1974
1975
1976
1977
1978
1979
1980
1981
1982
1983
1984
1985
1986
1987
1988
1989
1990
1991
1992
1993
1994
1995
1996
1997
1998
1999
2000
2001
2002
2003
2004
2005
2006
2007
2008
2009
2010
2011
2012
2013
2014
2015
2016
2017
2018
2019
2020
2021
2022
2023
2024
2025
2026
2027
2028
2029
2030
2031
2032
2033
2034
2035
2036
2037
2038
2039
2040
2041
2042
2043
2044
2045
2046
2047
2048
2049
2050
2051
2052
2053
2054
2055
2056
2057
2058
2059
2060
2061
2062
2063
2064
2065
2066
2067
2068
2069
2070
2071
2072
2073
2074
2075
2076
2077
2078
2079
2080
2081
2082
2083
2084
2085
2086
2087
2088
2089
2090
2091
2092
2093
2094
2095
2096
2097
2098
2099
2100
2101
2102
2103
2104
2105
2106
2107
2108
2109
2110
2111
2112
2113
2114
2115
2116
2117
2118
2119
2120
2121
2122
2123
2124
2125
2126
2127
2128
2129
2130
2131
2132
2133
2134
2135
2136
2137
2138
2139
2140
2141
2142
2143
2144
2145
2146
2147
2148
2149
2150
2151
2152
2153
2154
2155
2156
2157
2158
2159
2160
2161
2162
2163
2164
2165
2166
2167
2168
2169
2170
2171
2172
2173
2174
2175
2176
2177
2178
2179
2180
2181
2182
2183
2184
2185
2186
2187
2188
2189
2190
2191
2192
2193
2194
2195
2196
2197
2198
2199
2200
2201
2202
2203
2204
2205
2206
2207
2208
2209
2210
2211
2212
2213
2214
2215
2216
2217
2218
2219
2220
2221
2222
2223
2224
2225
2226
2227
2228
2229
2230
2231
2232
2233
2234
2235
2236
2237
2238
2239
2240
2241
2242
2243
2244
2245
2246
2247
2248
2249
2250
2251
2252
2253
2254
2255
2256
2257
2258
2259
2260
2261
2262
2263
2264
2265
2266
2267
2268
2269
2270
2271
2272
2273
2274
2275
2276
2277
2278
2279
2280
2281
2282
2283
2284
2285
2286
2287
2288
2289
2290
2291
2292
2293
2294
2295
2296
2297
2298
2299
2300
2301
2302
2303
2304
2305
2306
2307
2308
2309
2310
2311
2312
2313
2314
2315
2316
2317
2318
2319
2320
2321
2322
2323
2324
2325
2326
2327
2328
2329
2330
2331
2332
2333
2334
2335
2336
2337
2338
2339
2340
2341
2342
2343
2344
2345
2346
2347
2348
2349
2350
2351
2352
2353
2354
2355
2356
2357
2358
2359
2360
2361
2362
2363
2364
2365
2366
2367
2368
2369
2370
2371
2372
2373
2374
2375
2376
2377
2378
2379</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1507</span>

<span class='def def kw'>def</span> <span class='AddQuery constant id'>AddQuery</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='index identifier id'>index</span> <span class='assign token'>=</span> <span class='string val'>'*'</span><span class='comma token'>,</span> <span class='comment identifier id'>comment</span> <span class='assign token'>=</span> <span class='string val'>''</span><span class='rparen token'>)</span>
    <span class='comment val'># build request</span>

    <span class='comment val'># mode and limits</span>
    <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='@offset ivar id'>@offset</span><span class='comma token'>,</span> <span class='@limit ivar id'>@limit</span><span class='comma token'>,</span> <span class='@mode ivar id'>@mode</span><span class='comma token'>,</span> <span class='@ranker ivar id'>@ranker</span><span class='comma token'>,</span> <span class='@sort ivar id'>@sort</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='@sortby ivar id'>@sortby</span>
    <span class='comment val'># query itself</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='query identifier id'>query</span>
    <span class='comment val'># weights</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int_array identifier id'>put_int_array</span> <span class='@weights ivar id'>@weights</span>
    <span class='comment val'># indexes</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='index identifier id'>index</span>
    <span class='comment val'># id64 range marker</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='integer val'>1</span>
    <span class='comment val'># id64 range</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int64 identifier id'>put_int64</span> <span class='@min_id ivar id'>@min_id</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='comma token'>,</span> <span class='@max_id ivar id'>@max_id</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>

    <span class='comment val'># filters</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='@filters ivar id'>@filters</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
    <span class='@filters ivar id'>@filters</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='filter identifier id'>filter</span><span class='bitor op'>|</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='string val'>'attr'</span><span class='rbrack token'>]</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='string val'>'type'</span><span class='rbrack token'>]</span>

      <span class='case case kw'>case</span> <span class='filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='string val'>'type'</span><span class='rbrack token'>]</span>
        <span class='when when kw'>when</span> <span class='SPH_FILTER_VALUES constant id'>SPH_FILTER_VALUES</span>
          <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int64_array identifier id'>put_int64_array</span> <span class='filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='string val'>'values'</span><span class='rbrack token'>]</span>
        <span class='when when kw'>when</span> <span class='SPH_FILTER_RANGE constant id'>SPH_FILTER_RANGE</span>
          <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int64 identifier id'>put_int64</span> <span class='filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='string val'>'min'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='string val'>'max'</span><span class='rbrack token'>]</span>
        <span class='when when kw'>when</span> <span class='SPH_FILTER_FLOATRANGE constant id'>SPH_FILTER_FLOATRANGE</span>
          <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_float identifier id'>put_float</span> <span class='filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='string val'>'min'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='string val'>'max'</span><span class='rbrack token'>]</span>
        <span class='else else kw'>else</span>
          <span class='raise identifier id'>raise</span> <span class='SphinxInternalError constant id'>SphinxInternalError</span><span class='comma token'>,</span> <span class='string val'>'Internal error: unhandled filter type'</span>
      <span class='end end kw'>end</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='string val'>'exclude'</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='integer val'>1</span> <span class='colon op'>:</span> <span class='integer val'>0</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># group-by clause, max-matches count, group-sort clause, cutoff count</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='@groupfunc ivar id'>@groupfunc</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='@groupby ivar id'>@groupby</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='@maxmatches ivar id'>@maxmatches</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='@groupsort ivar id'>@groupsort</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='@cutoff ivar id'>@cutoff</span><span class='comma token'>,</span> <span class='@retrycount ivar id'>@retrycount</span><span class='comma token'>,</span> <span class='@retrydelay ivar id'>@retrydelay</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='@groupdistinct ivar id'>@groupdistinct</span>

    <span class='comment val'># anchor point</span>
    <span class='if if kw'>if</span> <span class='@anchor ivar id'>@anchor</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='integer val'>0</span>
    <span class='else else kw'>else</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='integer val'>1</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='@anchor ivar id'>@anchor</span><span class='lbrack token'>[</span><span class='string val'>'attrlat'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='@anchor ivar id'>@anchor</span><span class='lbrack token'>[</span><span class='string val'>'attrlong'</span><span class='rbrack token'>]</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_float identifier id'>put_float</span> <span class='@anchor ivar id'>@anchor</span><span class='lbrack token'>[</span><span class='string val'>'lat'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='@anchor ivar id'>@anchor</span><span class='lbrack token'>[</span><span class='string val'>'long'</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># per-index weights</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='@indexweights ivar id'>@indexweights</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
    <span class='@indexweights ivar id'>@indexweights</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='idx identifier id'>idx</span><span class='comma token'>,</span> <span class='weight identifier id'>weight</span><span class='bitor op'>|</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='idx identifier id'>idx</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='weight identifier id'>weight</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># max query time</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='@maxquerytime ivar id'>@maxquerytime</span>

    <span class='comment val'># per-field weights</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='@fieldweights ivar id'>@fieldweights</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
    <span class='@fieldweights ivar id'>@fieldweights</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='field identifier id'>field</span><span class='comma token'>,</span> <span class='weight identifier id'>weight</span><span class='bitor op'>|</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='field identifier id'>field</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='weight identifier id'>weight</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># comment</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='comment identifier id'>comment</span>

    <span class='comment val'># attribute overrides</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='@overrides ivar id'>@overrides</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
    <span class='for for kw'>for</span> <span class='entry identifier id'>entry</span> <span class='in in kw'>in</span> <span class='@overrides ivar id'>@overrides</span> <span class='do do kw'>do</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='entry identifier id'>entry</span><span class='lbrack token'>[</span><span class='string val'>'attr'</span><span class='rbrack token'>]</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='entry identifier id'>entry</span><span class='lbrack token'>[</span><span class='string val'>'type'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='entry identifier id'>entry</span><span class='lbrack token'>[</span><span class='string val'>'values'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
      <span class='entry identifier id'>entry</span><span class='lbrack token'>[</span><span class='string val'>'values'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='val identifier id'>val</span><span class='bitor op'>|</span>
        <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int64 identifier id'>put_int64</span> <span class='id identifier id'>id</span>
        <span class='case case kw'>case</span> <span class='entry identifier id'>entry</span><span class='lbrack token'>[</span><span class='string val'>'type'</span><span class='rbrack token'>]</span>
          <span class='when when kw'>when</span> <span class='SPH_ATTR_FLOAT constant id'>SPH_ATTR_FLOAT</span>
            <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_float identifier id'>put_float</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span>
          <span class='when when kw'>when</span> <span class='SPH_ATTR_BIGINT constant id'>SPH_ATTR_BIGINT</span>
            <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int64 identifier id'>put_int64</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
          <span class='else else kw'>else</span>
            <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='val identifier id'>val</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># select-list</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='@select ivar id'>@select</span>

    <span class='comment val'># store request to requests array</span>
    <span class='@reqs ivar id'>@reqs</span> <span class='lshft op'>&lt;&lt;</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='semicolon token'>;</span>
    <span class='return return kw'>return</span> <span class='@reqs ivar id'>@reqs</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='minus op'>-</span> <span class='integer val'>1</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Connect to searchd, runs a batch of all queries added using</span>
  <span class='comment val'># {#AddQuery}, obtains and returns the result sets. Returns</span>
  <span class='comment val'># +false+ and sets {#GetLastError} message on general error</span>
  <span class='comment val'># (such as network I/O failure). Returns a plain array of</span>
  <span class='comment val'># result sets on success.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># Each result set in the returned array is exactly the same as</span>
  <span class='comment val'># the result set returned from {#Query}.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># Note that the batch query request itself almost always succeds </span>
  <span class='comment val'># unless there's a network error, blocking index rotation in</span>
  <span class='comment val'># progress, or another general failure which prevents the whole</span>
  <span class='comment val'># request from being processed.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># However individual queries within the batch might very well</span>
  <span class='comment val'># fail. In this case their respective result sets will contain</span>
  <span class='comment val'># non-empty &quot;error&quot; message, but no matches or query statistics.</span>
  <span class='comment val'># In the extreme case all queries within the batch could fail.</span>
  <span class='comment val'># There still will be no general error reported, because API</span>
  <span class='comment val'># was able to succesfully connect to searchd, submit the batch,</span>
  <span class='comment val'># and receive the results  but every result set will have a</span>
  <span class='comment val'># specific error message.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @return [Array&lt;Hash&gt;] an +Array+ of +Hash+es which are exactly</span>
  <span class='comment val'>#   the same as the result set returned from {#Query}.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @example</span>
  <span class='comment val'>#   sphinx.AddQuery('some search text', '*', 'search page')</span>
  <span class='comment val'>#   results = sphinx.RunQueries</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @see http://www.sphinxsearch.com/docs/current.html#api-func-runqueries Section 6.6.3, &quot;RunQueries&quot;</span>
  <span class='comment val'># @see #AddQuery</span>
  <span class='comment val'>#</span>
  <span class='def def kw'>def</span> <span class='RunQueries constant id'>RunQueries</span>
    <span class='if if kw'>if</span> <span class='@reqs ivar id'>@reqs</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
      <span class='@error ivar id'>@error</span> <span class='assign token'>=</span> <span class='string val'>'No queries defined, issue AddQuery() first'</span>
      <span class='return return kw'>return</span> <span class='false false kw'>false</span>
    <span class='end end kw'>end</span>

    <span class='req identifier id'>req</span> <span class='assign token'>=</span> <span class='@reqs ivar id'>@reqs</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>''</span><span class='rparen token'>)</span>
    <span class='nreqs identifier id'>nreqs</span> <span class='assign token'>=</span> <span class='@reqs ivar id'>@reqs</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
    <span class='@reqs ivar id'>@reqs</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='perform_request identifier id'>perform_request</span><span class='lparen token'>(</span><span class='symbol val'>:search</span><span class='comma token'>,</span> <span class='req identifier id'>req</span><span class='comma token'>,</span> <span class='nreqs identifier id'>nreqs</span><span class='rparen token'>)</span>

    <span class='comment val'># parse response</span>
    <span class='results identifier id'>results</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='ires identifier id'>ires</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
    <span class='while while kw'>while</span> <span class='ires identifier id'>ires</span> <span class='lt op'>&lt;</span> <span class='nreqs identifier id'>nreqs</span>
      <span class='ires identifier id'>ires</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

      <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'error'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>''</span>
      <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'warning'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>''</span>

      <span class='comment val'># extract status</span>
      <span class='status identifier id'>status</span> <span class='assign token'>=</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'status'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
      <span class='if if kw'>if</span> <span class='status identifier id'>status</span> <span class='neq op'>!=</span> <span class='SEARCHD_OK constant id'>SEARCHD_OK</span>
        <span class='message identifier id'>message</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span>
        <span class='if if kw'>if</span> <span class='status identifier id'>status</span> <span class='eq op'>==</span> <span class='SEARCHD_WARNING constant id'>SEARCHD_WARNING</span>
          <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'warning'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='message identifier id'>message</span>
        <span class='else else kw'>else</span>
          <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'error'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='message identifier id'>message</span>
          <span class='results identifier id'>results</span> <span class='lshft op'>&lt;&lt;</span> <span class='result identifier id'>result</span>
          <span class='next next kw'>next</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># read schema</span>
      <span class='fields identifier id'>fields</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
      <span class='attrs identifier id'>attrs</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
      <span class='attrs_names_in_order identifier id'>attrs_names_in_order</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

      <span class='nfields identifier id'>nfields</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
      <span class='while while kw'>while</span> <span class='nfields identifier id'>nfields</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
        <span class='nfields identifier id'>nfields</span> <span class='opasgn op'>-=</span> <span class='integer val'>1</span>
        <span class='fields identifier id'>fields</span> <span class='lshft op'>&lt;&lt;</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span>
      <span class='end end kw'>end</span>
      <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'fields'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='fields identifier id'>fields</span>

      <span class='nattrs identifier id'>nattrs</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
      <span class='while while kw'>while</span> <span class='nattrs identifier id'>nattrs</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
        <span class='nattrs identifier id'>nattrs</span> <span class='opasgn op'>-=</span> <span class='integer val'>1</span>
        <span class='attr identifier id'>attr</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span>
        <span class='type identifier id'>type</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
        <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='attr identifier id'>attr</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='type identifier id'>type</span>
        <span class='attrs_names_in_order identifier id'>attrs_names_in_order</span> <span class='lshft op'>&lt;&lt;</span> <span class='attr identifier id'>attr</span>
      <span class='end end kw'>end</span>
      <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'attrs'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='attrs identifier id'>attrs</span>

      <span class='comment val'># read match count</span>
      <span class='count identifier id'>count</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
      <span class='id64 identifier id'>id64</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>

      <span class='comment val'># read matches</span>
      <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'matches'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
      <span class='while while kw'>while</span> <span class='count identifier id'>count</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
        <span class='count identifier id'>count</span> <span class='opasgn op'>-=</span> <span class='integer val'>1</span>

        <span class='if if kw'>if</span> <span class='id64 identifier id'>id64</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
          <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int64 identifier id'>get_int64</span>
          <span class='weight identifier id'>weight</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
        <span class='else else kw'>else</span>
          <span class='doc identifier id'>doc</span><span class='comma token'>,</span> <span class='weight identifier id'>weight</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_ints identifier id'>get_ints</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>

        <span class='r identifier id'>r</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span> <span class='comment val'># This is a single result put in the result['matches'] array</span>
        <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'id'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='doc identifier id'>doc</span>
        <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'weight'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='weight identifier id'>weight</span>
        <span class='attrs_names_in_order identifier id'>attrs_names_in_order</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span>
          <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'attrs'</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

          <span class='case case kw'>case</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span>
            <span class='when when kw'>when</span> <span class='SPH_ATTR_BIGINT constant id'>SPH_ATTR_BIGINT</span>
              <span class='comment val'># handle 64-bit ints</span>
              <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'attrs'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int64 identifier id'>get_int64</span>
            <span class='when when kw'>when</span> <span class='SPH_ATTR_FLOAT constant id'>SPH_ATTR_FLOAT</span>
              <span class='comment val'># handle floats</span>
              <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'attrs'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_float identifier id'>get_float</span>
            <span class='when when kw'>when</span> <span class='SPH_ATTR_STRING constant id'>SPH_ATTR_STRING</span>
              <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'attrs'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span>
            <span class='else else kw'>else</span>
              <span class='comment val'># handle everything else as unsigned ints</span>
              <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
              <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span> <span class='bitand op'>&amp;</span> <span class='SPH_ATTR_MULTI constant id'>SPH_ATTR_MULTI</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
                <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'attrs'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
                <span class='float val'>1</span><span class='dot token'>.</span><span class='upto identifier id'>upto</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
                  <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'attrs'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
                <span class='end end kw'>end</span>
              <span class='else else kw'>else</span>
                <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'attrs'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
              <span class='end end kw'>end</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
        <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'matches'</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='r identifier id'>r</span>
      <span class='end end kw'>end</span>
      <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'total'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'total_found'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='msecs identifier id'>msecs</span><span class='comma token'>,</span> <span class='words identifier id'>words</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_ints identifier id'>get_ints</span><span class='lparen token'>(</span><span class='integer val'>4</span><span class='rparen token'>)</span>
      <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'time'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'%.3f'</span> <span class='mod op'>%</span> <span class='lparen token'>(</span><span class='msecs identifier id'>msecs</span> <span class='div op'>/</span> <span class='float val'>1000.0</span><span class='rparen token'>)</span>

      <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'words'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
      <span class='while while kw'>while</span> <span class='words identifier id'>words</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
        <span class='words identifier id'>words</span> <span class='opasgn op'>-=</span> <span class='integer val'>1</span>
        <span class='word identifier id'>word</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span>
        <span class='docs identifier id'>docs</span><span class='comma token'>,</span> <span class='hits identifier id'>hits</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_ints identifier id'>get_ints</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span>
        <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'words'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='word identifier id'>word</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='string val'>'docs'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='docs identifier id'>docs</span><span class='comma token'>,</span> <span class='string val'>'hits'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='hits identifier id'>hits</span> <span class='rbrace token'>}</span>
      <span class='end end kw'>end</span>

      <span class='results identifier id'>results</span> <span class='lshft op'>&lt;&lt;</span> <span class='result identifier id'>result</span>
    <span class='end end kw'>end</span>

    <span class='return return kw'>return</span> <span class='results identifier id'>results</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'>#=================================================================</span>
  <span class='comment val'># Additional functionality</span>
  <span class='comment val'>#=================================================================</span>

  <span class='comment val'># Excerpts (snippets) builder function. Connects to searchd, asks</span>
  <span class='comment val'># it to generate excerpts (snippets) from given documents, and</span>
  <span class='comment val'># returns the results.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># +docs+ is a plain array of strings that carry the documents'</span>
  <span class='comment val'># contents. +index+ is an index name string. Different settings</span>
  <span class='comment val'># (such as charset, morphology, wordforms) from given index will</span>
  <span class='comment val'># be used. +words+ is a string that contains the keywords to</span>
  <span class='comment val'># highlight. They will be processed with respect to index settings.</span>
  <span class='comment val'># For instance, if English stemming is enabled in the index,</span>
  <span class='comment val'># &quot;shoes&quot; will be highlighted even if keyword is &quot;shoe&quot;. Starting</span>
  <span class='comment val'># with version 0.9.9-rc1, keywords can contain wildcards, that</span>
  <span class='comment val'># work similarly to star-syntax available in queries.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @param [Array&lt;String&gt;] docs an array of strings which represent</span>
  <span class='comment val'>#   the documents' contents.</span>
  <span class='comment val'># @param [String] index an index which settings will be used for</span>
  <span class='comment val'>#   stemming, lexing and case folding.</span>
  <span class='comment val'># @param [String] words a string which contains the words to highlight.</span>
  <span class='comment val'># @param [Hash] opts a +Hash+ which contains additional optional</span>
  <span class='comment val'>#   highlighting parameters.</span>
  <span class='comment val'># @option opts [String] 'before_match' (&quot;&lt;b&gt;&quot;) a string to insert before a</span>
  <span class='comment val'>#   keyword match.</span>
  <span class='comment val'># @option opts [String] 'after_match' (&quot;&lt;/b&gt;&quot;) a string to insert after a</span>
  <span class='comment val'>#   keyword match.</span>
  <span class='comment val'># @option opts [String] 'chunk_separator' (&quot; ... &quot;) a string to insert</span>
  <span class='comment val'>#   between snippet chunks (passages).</span>
  <span class='comment val'># @option opts [Integer] 'limit' (256) maximum snippet size, in symbols</span>
  <span class='comment val'>#   (codepoints).</span>
  <span class='comment val'># @option opts [Integer] 'around' (5) how many words to pick around</span>
  <span class='comment val'>#   each matching keywords block.</span>
  <span class='comment val'># @option opts [Boolean] 'exact_phrase' (false) whether to highlight exact</span>
  <span class='comment val'>#   query phrase matches only instead of individual keywords.</span>
  <span class='comment val'># @option opts [Boolean] 'single_passage' (false) whether to extract single</span>
  <span class='comment val'>#   best passage only.</span>
  <span class='comment val'># @option opts [Boolean] 'use_boundaries' (false) whether to extract</span>
  <span class='comment val'>#   passages by phrase boundaries setup in tokenizer.</span>
  <span class='comment val'># @option opts [Boolean] 'weight_order' (false) whether to sort the</span>
  <span class='comment val'>#   extracted passages in order of relevance (decreasing weight),</span>
  <span class='comment val'>#   or in order of appearance in the document (increasing position).</span>
  <span class='comment val'># @return [Array&lt;String&gt;, false] a plain array of strings with</span>
  <span class='comment val'>#   excerpts (snippets) on success; otherwise, +false+.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @raise [ArgumentError] Occurred when parameters are invalid.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @example</span>
  <span class='comment val'>#   sphinx.BuildExcerpts(['hello world', 'hello me'], 'idx', 'hello')</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @see http://www.sphinxsearch.com/docs/current.html#api-func-buildexcerpts Section 6.7.1, &quot;BuildExcerpts&quot;</span>
  <span class='comment val'>#</span>
  <span class='def def kw'>def</span> <span class='BuildExcerpts constant id'>BuildExcerpts</span><span class='lparen token'>(</span><span class='docs identifier id'>docs</span><span class='comma token'>,</span> <span class='index identifier id'>index</span><span class='comma token'>,</span> <span class='words identifier id'>words</span><span class='comma token'>,</span> <span class='opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;docs&quot; argument must be Array'</span>   <span class='unless unless_mod kw'>unless</span> <span class='docs identifier id'>docs</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;index&quot; argument must be String'</span> <span class='unless unless_mod kw'>unless</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;words&quot; argument must be String'</span> <span class='unless unless_mod kw'>unless</span> <span class='words identifier id'>words</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;opts&quot; argument must be Hash'</span>    <span class='unless unless_mod kw'>unless</span> <span class='opts identifier id'>opts</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span>

    <span class='docs identifier id'>docs</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='doc identifier id'>doc</span><span class='bitor op'>|</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;docs&quot; argument must be Array of Strings'</span> <span class='unless unless_mod kw'>unless</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># fixup options</span>
    <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'before_match'</span><span class='rbrack token'>]</span>    <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:before_match</span><span class='rbrack token'>]</span>    <span class='orop op'>||</span> <span class='string val'>'&lt;b&gt;'</span><span class='semicolon token'>;</span>
    <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'after_match'</span><span class='rbrack token'>]</span>     <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:after_match</span><span class='rbrack token'>]</span>     <span class='orop op'>||</span> <span class='string val'>'&lt;/b&gt;'</span><span class='semicolon token'>;</span>
    <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'chunk_separator'</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:chunk_separator</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='string val'>' ... '</span><span class='semicolon token'>;</span>
    <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'limit'</span><span class='rbrack token'>]</span>           <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:limit</span><span class='rbrack token'>]</span>           <span class='orop op'>||</span> <span class='integer val'>256</span><span class='semicolon token'>;</span>
    <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'around'</span><span class='rbrack token'>]</span>          <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:around</span><span class='rbrack token'>]</span>          <span class='orop op'>||</span> <span class='integer val'>5</span><span class='semicolon token'>;</span>
    <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'exact_phrase'</span><span class='rbrack token'>]</span>    <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:exact_phrase</span><span class='rbrack token'>]</span>    <span class='orop op'>||</span> <span class='false false kw'>false</span>
    <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'single_passage'</span><span class='rbrack token'>]</span>  <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:single_passage</span><span class='rbrack token'>]</span>  <span class='orop op'>||</span> <span class='false false kw'>false</span>
    <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'use_boundaries'</span><span class='rbrack token'>]</span>  <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:use_boundaries</span><span class='rbrack token'>]</span>  <span class='orop op'>||</span> <span class='false false kw'>false</span>
    <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'weight_order'</span><span class='rbrack token'>]</span>    <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:weight_order</span><span class='rbrack token'>]</span>    <span class='orop op'>||</span> <span class='false false kw'>false</span>
    <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'query_mode'</span><span class='rbrack token'>]</span>      <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:query_mode</span><span class='rbrack token'>]</span>      <span class='orop op'>||</span> <span class='false false kw'>false</span>

    <span class='comment val'># build request</span>

    <span class='comment val'># v.1.0 req</span>
    <span class='flags identifier id'>flags</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
    <span class='flags identifier id'>flags</span> <span class='opasgn op'>|=</span> <span class='integer val'>2</span>  <span class='if if_mod kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'exact_phrase'</span><span class='rbrack token'>]</span>
    <span class='flags identifier id'>flags</span> <span class='opasgn op'>|=</span> <span class='integer val'>4</span>  <span class='if if_mod kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'single_passage'</span><span class='rbrack token'>]</span>
    <span class='flags identifier id'>flags</span> <span class='opasgn op'>|=</span> <span class='integer val'>8</span>  <span class='if if_mod kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'use_boundaries'</span><span class='rbrack token'>]</span>
    <span class='flags identifier id'>flags</span> <span class='opasgn op'>|=</span> <span class='integer val'>16</span> <span class='if if_mod kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'weight_order'</span><span class='rbrack token'>]</span>
    <span class='flags identifier id'>flags</span> <span class='opasgn op'>|=</span> <span class='integer val'>32</span> <span class='if if_mod kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'query_mode'</span><span class='rbrack token'>]</span>

    <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='flags identifier id'>flags</span> <span class='comment val'># mode=0, flags=1 (remove spaces)</span>
    <span class='comment val'># req index</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='comment val'># req words</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='words identifier id'>words</span>

    <span class='comment val'># options</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'before_match'</span><span class='rbrack token'>]</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'after_match'</span><span class='rbrack token'>]</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'chunk_separator'</span><span class='rbrack token'>]</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'limit'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='comma token'>,</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'around'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>

    <span class='comment val'># documents</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='docs identifier id'>docs</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='docs identifier id'>docs</span><span class='rparen token'>)</span>

    <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='perform_request identifier id'>perform_request</span><span class='lparen token'>(</span><span class='symbol val'>:excerpt</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rparen token'>)</span>

    <span class='comment val'># parse response</span>
    <span class='docs identifier id'>docs</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Extracts keywords from query using tokenizer settings for given</span>
  <span class='comment val'># index, optionally with per-keyword occurrence statistics.</span>
  <span class='comment val'># Returns an array of hashes with per-keyword information.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># +query+ is a query to extract keywords from. +index+ is a name of</span>
  <span class='comment val'># the index to get tokenizing settings and keyword occurrence</span>
  <span class='comment val'># statistics from. +hits+ is a boolean flag that indicates whether</span>
  <span class='comment val'># keyword occurrence statistics are required.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># The result set consists of +Hash+es with the following keys and values:</span>
  <span class='comment val'>#</span>
  <span class='comment val'># &lt;tt&gt;'tokenized'&lt;/tt&gt;::</span>
  <span class='comment val'>#   Tokenized keyword.</span>
  <span class='comment val'># &lt;tt&gt;'normalized'&lt;/tt&gt;::</span>
  <span class='comment val'>#   Normalized keyword.</span>
  <span class='comment val'># &lt;tt&gt;'docs'&lt;/tt&gt;::</span>
  <span class='comment val'>#   A number of documents where keyword is found (if +hits+ param is +true+).</span>
  <span class='comment val'># &lt;tt&gt;'hits'&lt;/tt&gt;::</span>
  <span class='comment val'>#   A number of keywords occurrences among all documents (if +hits+ param is +true+).</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @param [String] query a query string.</span>
  <span class='comment val'># @param [String] index an index to get tokenizing settings and</span>
  <span class='comment val'>#   keyword occurrence statistics from.</span>
  <span class='comment val'># @param [Boolean] hits indicates whether keyword occurrence</span>
  <span class='comment val'>#   statistics are required.</span>
  <span class='comment val'># @return [Array&lt;Hash&gt;] an +Array+ of +Hash+es in format specified</span>
  <span class='comment val'>#   above.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @raise [ArgumentError] Occurred when parameters are invalid.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @example</span>
  <span class='comment val'>#   keywords = sphinx.BuildKeywords(&quot;this.is.my query&quot;, &quot;test1&quot;, false)</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @see http://www.sphinxsearch.com/docs/current.html#api-func-buildkeywords Section 6.7.3, &quot;BuildKeywords&quot;</span>
  <span class='comment val'>#</span>
  <span class='def def kw'>def</span> <span class='BuildKeywords constant id'>BuildKeywords</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='index identifier id'>index</span><span class='comma token'>,</span> <span class='hits identifier id'>hits</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;query&quot; argument must be String'</span> <span class='unless unless_mod kw'>unless</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;index&quot; argument must be String'</span> <span class='unless unless_mod kw'>unless</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;hits&quot; argument must be Boolean'</span> <span class='unless unless_mod kw'>unless</span> <span class='hits identifier id'>hits</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='TrueClass constant id'>TrueClass</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='hits identifier id'>hits</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='FalseClass constant id'>FalseClass</span><span class='rparen token'>)</span>

    <span class='comment val'># build request</span>
    <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='comment val'># v.1.0 req</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='query identifier id'>query</span> <span class='comment val'># req query</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='index identifier id'>index</span> <span class='comment val'># req index</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='hits identifier id'>hits</span> <span class='question op'>?</span> <span class='integer val'>1</span> <span class='colon op'>:</span> <span class='integer val'>0</span>

    <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='perform_request identifier id'>perform_request</span><span class='lparen token'>(</span><span class='symbol val'>:keywords</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rparen token'>)</span>

    <span class='comment val'># parse response</span>
    <span class='nwords identifier id'>nwords</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
    <span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='nwords identifier id'>nwords</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span>
      <span class='tokenized identifier id'>tokenized</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span>
      <span class='normalized identifier id'>normalized</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span>

      <span class='entry identifier id'>entry</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='string val'>'tokenized'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='tokenized identifier id'>tokenized</span><span class='comma token'>,</span> <span class='string val'>'normalized'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='normalized identifier id'>normalized</span> <span class='rbrace token'>}</span>
      <span class='entry identifier id'>entry</span><span class='lbrack token'>[</span><span class='string val'>'docs'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='entry identifier id'>entry</span><span class='lbrack token'>[</span><span class='string val'>'hits'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_ints identifier id'>get_ints</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='hits identifier id'>hits</span>

      <span class='entry identifier id'>entry</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Instantly updates given attribute values in given documents.</span>
  <span class='comment val'># Returns number of actually updated documents (0 or more) on</span>
  <span class='comment val'># success, or -1 on failure.</span>
  <span class='comment val'># </span>
  <span class='comment val'># +index+ is a name of the index (or indexes) to be updated.</span>
  <span class='comment val'># +attrs+ is a plain array with string attribute names, listing</span>
  <span class='comment val'># attributes that are updated. +values+ is a Hash where key is</span>
  <span class='comment val'># document ID, and value is a plain array of new attribute values.</span>
  <span class='comment val'># </span>
  <span class='comment val'># +index+ can be either a single index name or a list, like in</span>
  <span class='comment val'># {#Query}. Unlike {#Query}, wildcard is not allowed and all the</span>
  <span class='comment val'># indexes to update must be specified explicitly. The list of</span>
  <span class='comment val'># indexes can include distributed index names. Updates on</span>
  <span class='comment val'># distributed indexes will be pushed to all agents.</span>
  <span class='comment val'># </span>
  <span class='comment val'># The updates only work with docinfo=extern storage strategy.</span>
  <span class='comment val'># They are very fast because they're working fully in RAM, but</span>
  <span class='comment val'># they can also be made persistent: updates are saved on disk</span>
  <span class='comment val'># on clean searchd shutdown initiated by SIGTERM signal. With</span>
  <span class='comment val'># additional restrictions, updates are also possible on MVA</span>
  <span class='comment val'># attributes; refer to mva_updates_pool directive for details.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># The first sample statement will update document 1 in index</span>
  <span class='comment val'># &quot;test1&quot;, setting &quot;group_id&quot; to 456. The second one will update</span>
  <span class='comment val'># documents 1001, 1002 and 1003 in index &quot;products&quot;. For document</span>
  <span class='comment val'># 1001, the new price will be set to 123 and the new amount in</span>
  <span class='comment val'># stock to 5; for document 1002, the new price will be 37 and the</span>
  <span class='comment val'># new amount will be 11; etc. The third one updates document 1</span>
  <span class='comment val'># in index &quot;test2&quot;, setting MVA attribute &quot;group_id&quot; to [456, 789].</span>
  <span class='comment val'># </span>
  <span class='comment val'># @example</span>
  <span class='comment val'>#   sphinx.UpdateAttributes(&quot;test1&quot;, [&quot;group_id&quot;], { 1 =&gt; [456] });</span>
  <span class='comment val'>#   sphinx.UpdateAttributes(&quot;products&quot;, [&quot;price&quot;, &quot;amount_in_stock&quot;],</span>
  <span class='comment val'>#     { 1001 =&gt; [123, 5], 1002 =&gt; [37, 11], 1003 =&gt; [25, 129] });</span>
  <span class='comment val'>#   sphinx.UpdateAttributes('test2', ['group_id'], { 1 =&gt; [[456, 789]] }, true)</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @param [String] index a name of the index to be updated.</span>
  <span class='comment val'># @param [Array&lt;String&gt;] attrs an array of attribute name strings.</span>
  <span class='comment val'># @param [Hash] values is a hash where key is document id, and</span>
  <span class='comment val'>#   value is an array of new attribute values.</span>
  <span class='comment val'># @param [Boolean] mva indicating whether to update MVA.</span>
  <span class='comment val'># @return [Integer] number of actually updated documents (0 or more) on success,</span>
  <span class='comment val'>#   -1 on failure.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @raise [ArgumentError] Occurred when parameters are invalid.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @see http://www.sphinxsearch.com/docs/current.html#api-func-updateatttributes Section 6.7.2, &quot;UpdateAttributes&quot;</span>
  <span class='comment val'>#</span>
  <span class='def def kw'>def</span> <span class='UpdateAttributes constant id'>UpdateAttributes</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='comma token'>,</span> <span class='attrs identifier id'>attrs</span><span class='comma token'>,</span> <span class='values identifier id'>values</span><span class='comma token'>,</span> <span class='mva identifier id'>mva</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
    <span class='comment val'># verify everything</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;index&quot; argument must be String'</span> <span class='unless unless_mod kw'>unless</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;mva&quot; argument must be Boolean'</span>  <span class='unless unless_mod kw'>unless</span> <span class='mva identifier id'>mva</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='TrueClass constant id'>TrueClass</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='mva identifier id'>mva</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='FalseClass constant id'>FalseClass</span><span class='rparen token'>)</span>

    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;attrs&quot; argument must be Array'</span> <span class='unless unless_mod kw'>unless</span> <span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
    <span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='attr identifier id'>attr</span><span class='bitor op'>|</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;attrs&quot; argument must be Array of Strings'</span> <span class='unless unless_mod kw'>unless</span> <span class='attr identifier id'>attr</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='attr identifier id'>attr</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash'</span> <span class='unless unless_mod kw'>unless</span> <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span>
    <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='entry identifier id'>entry</span><span class='bitor op'>|</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash map of Integer to Array'</span> <span class='unless unless_mod kw'>unless</span> <span class='id identifier id'>id</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='id identifier id'>id</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash map of Integer to Array'</span> <span class='unless unless_mod kw'>unless</span> <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;\&quot;values\&quot; argument Hash values Array must have #{attrs.length} elements&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
      <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span>
        <span class='if if kw'>if</span> <span class='mva identifier id'>mva</span>
          <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash map of Integer to Array of Arrays'</span> <span class='unless unless_mod kw'>unless</span> <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
          <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='vv identifier id'>vv</span><span class='bitor op'>|</span>
            <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash map of Integer to Array of Arrays of Integers'</span> <span class='unless unless_mod kw'>unless</span> <span class='vv identifier id'>vv</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='vv identifier id'>vv</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
          <span class='end end kw'>end</span>
        <span class='else else kw'>else</span>
          <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash map of Integer to Array of Integers'</span> <span class='unless unless_mod kw'>unless</span> <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># build request</span>
    <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='index identifier id'>index</span>

    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
    <span class='for for kw'>for</span> <span class='attr identifier id'>attr</span> <span class='in in kw'>in</span> <span class='attrs identifier id'>attrs</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='attr identifier id'>attr</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='mva identifier id'>mva</span> <span class='question op'>?</span> <span class='integer val'>1</span> <span class='colon op'>:</span> <span class='integer val'>0</span>
    <span class='end end kw'>end</span>

    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
    <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='entry identifier id'>entry</span><span class='bitor op'>|</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int64 identifier id'>put_int64</span> <span class='id identifier id'>id</span>
      <span class='if if kw'>if</span> <span class='mva identifier id'>mva</span>
        <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int_array identifier id'>put_int_array</span> <span class='v identifier id'>v</span> <span class='rbrace token'>}</span>
      <span class='else else kw'>else</span>
        <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='entry identifier id'>entry</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='perform_request identifier id'>perform_request</span><span class='lparen token'>(</span><span class='symbol val'>:update</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rparen token'>)</span>

    <span class='comment val'># parse response</span>
    <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Queries searchd status, and returns an array of status variable name</span>
  <span class='comment val'># and value pairs.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @return [Array&lt;Array&gt;] a table containing searchd status information.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @example</span>
  <span class='comment val'>#   status = sphinx.Status</span>
  <span class='comment val'>#   puts status.map { |key, value| &quot;#{key.rjust(20)}: #{value}&quot; }</span>
  <span class='comment val'>#</span>
  <span class='def def kw'>def</span> <span class='Status constant id'>Status</span>
    <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span>
    <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='perform_request identifier id'>perform_request</span><span class='lparen token'>(</span><span class='symbol val'>:status</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rparen token'>)</span>

    <span class='comment val'># parse response</span>
    <span class='rows identifier id'>rows</span><span class='comma token'>,</span> <span class='cols identifier id'>cols</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_ints identifier id'>get_ints</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span>
    <span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='rows identifier id'>rows</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span>
      <span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='cols identifier id'>cols</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Force attribute flush, and block until it completes.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @return current internal flush tag on success, -1 on failure.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @example</span>
  <span class='comment val'>#   sphinx.FlushAttrs</span>
  <span class='comment val'>#</span>
  <span class='def def kw'>def</span> <span class='FlushAttrs constant id'>FlushAttrs</span>
    <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='perform_request identifier id'>perform_request</span><span class='lparen token'>(</span><span class='symbol val'>:flushattrs</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rparen token'>)</span>

    <span class='comment val'># parse response</span>
    <span class='begin begin kw'>begin</span>
      <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
    <span class='rescue rescue kw'>rescue</span> <span class='EOFError constant id'>EOFError</span>
      <span class='integer val'>-1</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>#=================================================================</span>
  <span class='comment val'># Persistent connections</span>
  <span class='comment val'>#=================================================================</span>

  <span class='comment val'># Opens persistent connection to the server.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># This method could be used only when a single searchd server</span>
  <span class='comment val'># configured.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @return [Boolean] +true+ when persistent connection has been</span>
  <span class='comment val'>#   established; otherwise, +false+.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @example</span>
  <span class='comment val'>#   begin</span>
  <span class='comment val'>#     sphinx.Open</span>
  <span class='comment val'>#     # perform several requests</span>
  <span class='comment val'>#   ensure</span>
  <span class='comment val'>#     sphinx.Close</span>
  <span class='comment val'>#   end</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @see #Close</span>
  <span class='comment val'>#</span>
  <span class='def def kw'>def</span> <span class='Open constant id'>Open</span>
    <span class='if if kw'>if</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
      <span class='@error ivar id'>@error</span> <span class='assign token'>=</span> <span class='string val'>'too many servers. persistent socket allowed only for a single server.'</span>
      <span class='return return kw'>return</span> <span class='false false kw'>false</span>
    <span class='end end kw'>end</span>

    <span class='if if kw'>if</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='persistent? fid id'>persistent?</span>
      <span class='@error ivar id'>@error</span> <span class='assign token'>=</span> <span class='string val'>'already connected'</span>
      <span class='return return kw'>return</span> <span class='false false kw'>false</span><span class='semicolon token'>;</span>
    <span class='end end kw'>end</span>

    <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span>

    <span class='perform_request identifier id'>perform_request</span><span class='lparen token'>(</span><span class='symbol val'>:persist</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
      <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='make_persistent! fid id'>make_persistent!</span><span class='lparen token'>(</span><span class='socket identifier id'>socket</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='true true kw'>true</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Closes previously opened persistent connection.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># This method could be used only when a single searchd server</span>
  <span class='comment val'># configured.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @return [Boolean] +true+ when persistent connection has been</span>
  <span class='comment val'>#   closed; otherwise, +false+.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @example</span>
  <span class='comment val'>#   begin</span>
  <span class='comment val'>#     sphinx.Open</span>
  <span class='comment val'>#     # perform several requests</span>
  <span class='comment val'>#   ensure</span>
  <span class='comment val'>#     sphinx.Close</span>
  <span class='comment val'>#   end</span>
  <span class='comment val'>#</span>
  <span class='comment val'># @see #Open</span>
  <span class='comment val'>#</span>
  <span class='def def kw'>def</span> <span class='Close constant id'>Close</span>
    <span class='if if kw'>if</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
      <span class='@error ivar id'>@error</span> <span class='assign token'>=</span> <span class='string val'>'too many servers. persistent socket allowed only for a single server.'</span>
      <span class='return return kw'>return</span> <span class='false false kw'>false</span>
    <span class='end end kw'>end</span>

    <span class='unless unless kw'>unless</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='persistent? fid id'>persistent?</span>
      <span class='@error ivar id'>@error</span> <span class='assign token'>=</span> <span class='string val'>'not connected'</span>
      <span class='return return kw'>return</span> <span class='false false kw'>false</span><span class='semicolon token'>;</span>
    <span class='end end kw'>end</span>

    <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='close_persistent! fid id'>close_persistent!</span>
  <span class='end end kw'>end</span>

  <span class='protected identifier id'>protected</span>

    <span class='comment val'># Connect, send query, get response.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># Use this method to communicate with Sphinx server. It ensures connection</span>
    <span class='comment val'># will be instantiated properly, all headers will be generated properly, etc.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># @param [Symbol, String] command searchd command to perform (&lt;tt&gt;:search&lt;/tt&gt;, &lt;tt&gt;:excerpt&lt;/tt&gt;,</span>
    <span class='comment val'>#   &lt;tt&gt;:update&lt;/tt&gt;, &lt;tt&gt;:keywords&lt;/tt&gt;, &lt;tt&gt;:persist&lt;/tt&gt;, &lt;tt&gt;:status&lt;/tt&gt;,</span>
    <span class='comment val'>#   &lt;tt&gt;:query&lt;/tt&gt;, &lt;tt&gt;:flushattrs&lt;/tt&gt;. See &lt;tt&gt;SEARCHD_COMMAND_*&lt;/tt&gt; for details).</span>
    <span class='comment val'># @param [Sphinx::Request] request contains request body.</span>
    <span class='comment val'># @param [nil, Integer] additional additional integer data to be placed between header and body.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># @yield if block given, response will not be parsed, plain socket</span>
    <span class='comment val'>#   will be yielded instead. This is special mode used for</span>
    <span class='comment val'>#   persistent connections, do not use for other tasks.</span>
    <span class='comment val'># @yieldparam [Sphinx::Server] server a server where request was performed on.</span>
    <span class='comment val'># @yieldparam [Sphinx::BufferedIO] socket a socket used to perform the request.</span>
    <span class='comment val'># @return [Sphinx::Response] contains response body.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># @see #parse_response</span>
    <span class='comment val'>#</span>
    <span class='def def kw'>def</span> <span class='perform_request identifier id'>perform_request</span><span class='lparen token'>(</span><span class='command identifier id'>command</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='comma token'>,</span> <span class='additional identifier id'>additional</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
      <span class='with_server identifier id'>with_server</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='bitor op'>|</span>
        <span class='cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='command identifier id'>command</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='upcase identifier id'>upcase</span>
        <span class='command_id identifier id'>command_id</span> <span class='assign token'>=</span> <span class='Sphinx constant id'>Sphinx</span><span class='colon2 op'>::</span><span class='Client constant id'>Client</span><span class='dot token'>.</span><span class='const_get identifier id'>const_get</span><span class='lparen token'>(</span><span class='dstring node'>&quot;SEARCHD_COMMAND_#{cmd}&quot;</span><span class='rparen token'>)</span>
        <span class='command_ver identifier id'>command_ver</span> <span class='assign token'>=</span> <span class='Sphinx constant id'>Sphinx</span><span class='colon2 op'>::</span><span class='Client constant id'>Client</span><span class='dot token'>.</span><span class='const_get identifier id'>const_get</span><span class='lparen token'>(</span><span class='dstring node'>&quot;VER_COMMAND_#{cmd}&quot;</span><span class='rparen token'>)</span>

        <span class='with_socket identifier id'>with_socket</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
          <span class='len identifier id'>len</span> <span class='assign token'>=</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='plus op'>+</span> <span class='lparen token'>(</span><span class='additional identifier id'>additional</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='integer val'>? </span><span class='integer val'>0</span> <span class='colon op'>:</span> <span class='integer val'>4</span><span class='rparen token'>)</span>
          <span class='header identifier id'>header</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='command_id identifier id'>command_id</span><span class='comma token'>,</span> <span class='command_ver identifier id'>command_ver</span><span class='comma token'>,</span> <span class='len identifier id'>len</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>'nnN'</span><span class='rparen token'>)</span>
          <span class='header identifier id'>header</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrack token'>[</span><span class='additional identifier id'>additional</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>'N'</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='additional identifier id'>additional</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>

          <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span><span class='lparen token'>(</span><span class='header identifier id'>header</span> <span class='plus op'>+</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>

          <span class='if if kw'>if</span> <span class='block_given? fid id'>block_given?</span>
            <span class='yield yield kw'>yield</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='socket identifier id'>socket</span>
          <span class='else else kw'>else</span>
            <span class='parse_response identifier id'>parse_response</span><span class='lparen token'>(</span><span class='socket identifier id'>socket</span><span class='comma token'>,</span> <span class='command_ver identifier id'>command_ver</span><span class='rparen token'>)</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># This is internal method which gets and parses response packet from</span>
    <span class='comment val'># searchd server.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># There are several exceptions which could be thrown in this method:</span>
    <span class='comment val'>#</span>
    <span class='comment val'># @param [Sphinx::BufferedIO] socket an input stream object.</span>
    <span class='comment val'># @param [Integer] client_version a command version which client supports.</span>
    <span class='comment val'># @return [Sphinx::Response] could be used for context-based</span>
    <span class='comment val'>#   parsing of reply from the server.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># @raise [SystemCallError, SocketError] should be handled by caller (see {#with_socket}).</span>
    <span class='comment val'># @raise [SphinxResponseError] incomplete reply from searchd.</span>
    <span class='comment val'># @raise [SphinxInternalError] searchd internal error.</span>
    <span class='comment val'># @raise [SphinxTemporaryError] searchd temporary error.</span>
    <span class='comment val'># @raise [SphinxUnknownError] searchd unknown error.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># @see #with_socket</span>
    <span class='comment val'># @private</span>
    <span class='comment val'>#</span>
    <span class='def def kw'>def</span> <span class='parse_response identifier id'>parse_response</span><span class='lparen token'>(</span><span class='socket identifier id'>socket</span><span class='comma token'>,</span> <span class='client_version identifier id'>client_version</span><span class='rparen token'>)</span>
      <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='string val'>''</span>
      <span class='status identifier id'>status</span> <span class='assign token'>=</span> <span class='ver identifier id'>ver</span> <span class='assign token'>=</span> <span class='len identifier id'>len</span> <span class='assign token'>=</span> <span class='integer val'>0</span>

      <span class='comment val'># Read server reply from server. All exceptions are handled by +with_socket+.</span>
      <span class='header identifier id'>header</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='integer val'>8</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='header identifier id'>header</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>8</span>
        <span class='status identifier id'>status</span><span class='comma token'>,</span> <span class='ver identifier id'>ver</span><span class='comma token'>,</span> <span class='len identifier id'>len</span> <span class='assign token'>=</span> <span class='header identifier id'>header</span><span class='dot token'>.</span><span class='unpack identifier id'>unpack</span><span class='lparen token'>(</span><span class='string val'>'n2N'</span><span class='rparen token'>)</span>
        <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='len identifier id'>len</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='len identifier id'>len</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># check response</span>
      <span class='read identifier id'>read</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
      <span class='if if kw'>if</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='or or kw'>or</span> <span class='read identifier id'>read</span> <span class='neq op'>!=</span> <span class='len identifier id'>len</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
        <span class='error identifier id'>error</span> <span class='assign token'>=</span> <span class='len identifier id'>len</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span> \
          <span class='question op'>?</span> <span class='dstring node'>&quot;failed to read searchd response (status=#{status}, ver=#{ver}, len=#{len}, read=#{read})&quot;</span> \
          <span class='colon op'>:</span> <span class='string val'>'received zero-sized searchd response'</span>
        <span class='raise identifier id'>raise</span> <span class='SphinxResponseError constant id'>SphinxResponseError</span><span class='comma token'>,</span> <span class='error identifier id'>error</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># check status</span>
      <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='status identifier id'>status</span> <span class='eq op'>==</span> <span class='SEARCHD_WARNING constant id'>SEARCHD_WARNING</span><span class='rparen token'>)</span>
        <span class='wlen identifier id'>wlen</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>4</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='unpack identifier id'>unpack</span><span class='lparen token'>(</span><span class='string val'>'N*'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
        <span class='@warning ivar id'>@warning</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='integer val'>4</span><span class='comma token'>,</span> <span class='wlen identifier id'>wlen</span><span class='rbrack token'>]</span>
        <span class='return return kw'>return</span> <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='integer val'>4</span> <span class='plus op'>+</span> <span class='wlen identifier id'>wlen</span><span class='comma token'>,</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='minus op'>-</span> <span class='integer val'>4</span> <span class='minus op'>-</span> <span class='wlen identifier id'>wlen</span><span class='rbrack token'>]</span>
      <span class='end end kw'>end</span>

      <span class='if if kw'>if</span> <span class='status identifier id'>status</span> <span class='eq op'>==</span> <span class='SEARCHD_ERROR constant id'>SEARCHD_ERROR</span>
        <span class='error identifier id'>error</span> <span class='assign token'>=</span> <span class='string val'>'searchd error: '</span> <span class='plus op'>+</span> <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='integer val'>4</span><span class='comma token'>,</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='minus op'>-</span> <span class='integer val'>4</span><span class='rbrack token'>]</span>
        <span class='raise identifier id'>raise</span> <span class='SphinxInternalError constant id'>SphinxInternalError</span><span class='comma token'>,</span> <span class='error identifier id'>error</span>
      <span class='end end kw'>end</span>

      <span class='if if kw'>if</span> <span class='status identifier id'>status</span> <span class='eq op'>==</span> <span class='SEARCHD_RETRY constant id'>SEARCHD_RETRY</span>
        <span class='error identifier id'>error</span> <span class='assign token'>=</span> <span class='string val'>'temporary searchd error: '</span> <span class='plus op'>+</span> <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='integer val'>4</span><span class='comma token'>,</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='minus op'>-</span> <span class='integer val'>4</span><span class='rbrack token'>]</span>
        <span class='raise identifier id'>raise</span> <span class='SphinxTemporaryError constant id'>SphinxTemporaryError</span><span class='comma token'>,</span> <span class='error identifier id'>error</span>
      <span class='end end kw'>end</span>

      <span class='unless unless kw'>unless</span> <span class='status identifier id'>status</span> <span class='eq op'>==</span> <span class='SEARCHD_OK constant id'>SEARCHD_OK</span>
        <span class='error identifier id'>error</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;unknown status code: '#{status}'&quot;</span>
        <span class='raise identifier id'>raise</span> <span class='SphinxUnknownError constant id'>SphinxUnknownError</span><span class='comma token'>,</span> <span class='error identifier id'>error</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># check version</span>
      <span class='if if kw'>if</span> <span class='ver identifier id'>ver</span> <span class='lt op'>&lt;</span> <span class='client_version identifier id'>client_version</span>
        <span class='@warning ivar id'>@warning</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;searchd command v.#{ver &gt;&gt; 8}.#{ver &amp; 0xff} older than client's &quot;</span> <span class='plus op'>+</span>
          <span class='dstring node'>&quot;v.#{client_version &gt;&gt; 8}.#{client_version &amp; 0xff}, some options might not work&quot;</span>
      <span class='end end kw'>end</span>

      <span class='Response constant id'>Response</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='response identifier id'>response</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># This is internal method which selects next server (round-robin)</span>
    <span class='comment val'># and yields it to the block passed.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># In case of connection error, it will try next server several times</span>
    <span class='comment val'># (see {#SetConnectTimeout} method details). If all servers are down,</span>
    <span class='comment val'># it will set error attribute (could be retrieved with {#GetLastError}</span>
    <span class='comment val'># method) with the last exception message, and {#IsConnectError}</span>
    <span class='comment val'># method will return true. Also, {SphinxConnectError} exception</span>
    <span class='comment val'># will be raised.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># @yield a block which performs request on a given server.</span>
    <span class='comment val'># @yieldparam [Sphinx::Server] server contains information</span>
    <span class='comment val'>#   about the server to perform request on.</span>
    <span class='comment val'># @raise [SphinxConnectError] on any connection error.</span>
    <span class='comment val'>#</span>
    <span class='def def kw'>def</span> <span class='with_server identifier id'>with_server</span>
      <span class='attempts identifier id'>attempts</span> <span class='assign token'>=</span> <span class='@retries ivar id'>@retries</span>
      <span class='begin begin kw'>begin</span>
        <span class='comment val'># Get the next server</span>
        <span class='@lastserver ivar id'>@lastserver</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='@lastserver ivar id'>@lastserver</span> <span class='plus op'>+</span> <span class='integer val'>1</span><span class='rparen token'>)</span> <span class='mod op'>%</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
        <span class='server identifier id'>server</span> <span class='assign token'>=</span> <span class='@servers ivar id'>@servers</span><span class='lbrack token'>[</span><span class='@lastserver ivar id'>@lastserver</span><span class='rbrack token'>]</span>
        <span class='yield yield kw'>yield</span> <span class='server identifier id'>server</span>
      <span class='rescue rescue kw'>rescue</span> <span class='SphinxConnectError constant id'>SphinxConnectError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
        <span class='comment val'># Connection error! Do we need to try it again?</span>
        <span class='attempts identifier id'>attempts</span> <span class='opasgn op'>-=</span> <span class='integer val'>1</span>
        <span class='retry retry kw'>retry</span> <span class='if if_mod kw'>if</span> <span class='attempts identifier id'>attempts</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>

        <span class='comment val'># Re-raise original exception</span>
        <span class='@error ivar id'>@error</span> <span class='assign token'>=</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='message identifier id'>message</span>
        <span class='@connerror ivar id'>@connerror</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
        <span class='raise identifier id'>raise</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># This is internal method which retrieves socket for a given server,</span>
    <span class='comment val'># initiates Sphinx session, and yields this socket to a block passed.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># In case of any problems with session initiation, +SphinxConnectError+</span>
    <span class='comment val'># will be raised, because this is part of connection establishing. See</span>
    <span class='comment val'># +with_server+ method details to get more infromation about how this</span>
    <span class='comment val'># exception is handled.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># Socket retrieving routine is wrapped in a block with it's own</span>
    <span class='comment val'># timeout value (see +SetConnectTimeout+). This is done in</span>
    <span class='comment val'># &lt;tt&gt;Server#get_socket&lt;/tt&gt; method, so check it for details.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># Request execution is wrapped with block with another timeout</span>
    <span class='comment val'># (see +SetRequestTimeout+). This ensures no Sphinx request will</span>
    <span class='comment val'># take unreasonable time.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># In case of any Sphinx error (incomplete reply, internal or temporary</span>
    <span class='comment val'># error), connection to the server will be re-established, and request</span>
    <span class='comment val'># will be retried (see +SetRequestTimeout+). Of course, if connection</span>
    <span class='comment val'># could not be established, next server will be selected (see explanation</span>
    <span class='comment val'># above).</span>
    <span class='comment val'>#</span>
    <span class='comment val'># @param [Sphinx::Server] server contains information</span>
    <span class='comment val'>#   about the server to perform request on.</span>
    <span class='comment val'># @yield a block which will actually perform the request.</span>
    <span class='comment val'># @yieldparam [Sphinx::BufferedIO] socket a socket used to</span>
    <span class='comment val'>#   perform the request.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># @raise [SphinxResponseError, SphinxInternalError, SphinxTemporaryError, SphinxUnknownError]</span>
    <span class='comment val'>#   on any response error.</span>
    <span class='comment val'># @raise [SphinxConnectError] on any connection error.</span>
    <span class='comment val'>#</span>
    <span class='def def kw'>def</span> <span class='with_socket identifier id'>with_socket</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span>
      <span class='attempts identifier id'>attempts</span> <span class='assign token'>=</span> <span class='@reqretries ivar id'>@reqretries</span>
      <span class='socket identifier id'>socket</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>

      <span class='begin begin kw'>begin</span>
        <span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='get_socket identifier id'>get_socket</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='sock identifier id'>sock</span><span class='bitor op'>|</span>
          <span class='comment val'># Remember socket to close it in case of emergency</span>
          <span class='socket identifier id'>socket</span> <span class='assign token'>=</span> <span class='sock identifier id'>sock</span>

          <span class='comment val'># send my version</span>
          <span class='comment val'># this is a subtle part. we must do it before (!) reading back from searchd.</span>
          <span class='comment val'># because otherwise under some conditions (reported on FreeBSD for instance)</span>
          <span class='comment val'># TCP stack could throttle write-write-read pattern because of Nagle.</span>
          <span class='sock identifier id'>sock</span><span class='dot token'>.</span><span class='write identifier id'>write</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>'N'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
          <span class='v identifier id'>v</span> <span class='assign token'>=</span> <span class='sock identifier id'>sock</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='integer val'>4</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='unpack identifier id'>unpack</span><span class='lparen token'>(</span><span class='string val'>'N*'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='first identifier id'>first</span>

          <span class='comment val'># Ouch, invalid protocol!</span>
          <span class='if if kw'>if</span> <span class='v identifier id'>v</span> <span class='lt op'>&lt;</span> <span class='integer val'>1</span>
            <span class='raise identifier id'>raise</span> <span class='SphinxConnectError constant id'>SphinxConnectError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;expected searchd protocol version 1+, got version '#{v}'&quot;</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>

        <span class='Sphinx constant id'>Sphinx</span><span class='colon2 op'>::</span><span class='safe_execute identifier id'>safe_execute</span><span class='lparen token'>(</span><span class='@reqtimeout ivar id'>@reqtimeout</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
          <span class='yield yield kw'>yield</span> <span class='s identifier id'>s</span>
        <span class='end end kw'>end</span>
      <span class='rescue rescue kw'>rescue</span> <span class='SocketError constant id'>SocketError</span><span class='comma token'>,</span> <span class='SystemCallError constant id'>SystemCallError</span><span class='comma token'>,</span> <span class='IOError constant id'>IOError</span><span class='comma token'>,</span> <span class='colon3 op'>::</span><span class='Errno constant id'>Errno</span><span class='colon2 op'>::</span><span class='EPIPE constant id'>EPIPE</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
        <span class='comment val'># Ouch, communication problem, will be treated as a connection problem.</span>
        <span class='raise identifier id'>raise</span> <span class='SphinxConnectError constant id'>SphinxConnectError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;failed to read searchd response (msg=#{e.message})&quot;</span>
      <span class='rescue rescue kw'>rescue</span> <span class='SphinxResponseError constant id'>SphinxResponseError</span><span class='comma token'>,</span> <span class='SphinxInternalError constant id'>SphinxInternalError</span><span class='comma token'>,</span> <span class='SphinxTemporaryError constant id'>SphinxTemporaryError</span><span class='comma token'>,</span> <span class='SphinxUnknownError constant id'>SphinxUnknownError</span><span class='comma token'>,</span> <span class='colon3 op'>::</span><span class='Timeout constant id'>Timeout</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span><span class='comma token'>,</span> <span class='EOFError constant id'>EOFError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
        <span class='comment val'># EOFError should not occur in ideal world, because we compare response length</span>
        <span class='comment val'># with a value passed by Sphinx. But we want to ensure that client will not</span>
        <span class='comment val'># fail with unexpected error when Sphinx implementation has bugs, aren't we?</span>
        <span class='if if kw'>if</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='EOFError constant id'>EOFError</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='colon3 op'>::</span><span class='Timeout constant id'>Timeout</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span><span class='rparen token'>)</span>
          <span class='new_e identifier id'>new_e</span> <span class='assign token'>=</span> <span class='SphinxResponseError constant id'>SphinxResponseError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;failed to read searchd response (msg=#{e.message})&quot;</span><span class='rparen token'>)</span>
          <span class='new_e identifier id'>new_e</span><span class='dot token'>.</span><span class='set_backtrace identifier id'>set_backtrace</span><span class='lparen token'>(</span><span class='e identifier id'>e</span><span class='dot token'>.</span><span class='backtrace identifier id'>backtrace</span><span class='rparen token'>)</span>
          <span class='e identifier id'>e</span> <span class='assign token'>=</span> <span class='new_e identifier id'>new_e</span>
        <span class='end end kw'>end</span>

        <span class='comment val'># Close previously opened socket (in case of it has been really opened)</span>
        <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='free_socket identifier id'>free_socket</span><span class='lparen token'>(</span><span class='socket identifier id'>socket</span><span class='rparen token'>)</span>

        <span class='comment val'># Request error! Do we need to try it again?</span>
        <span class='attempts identifier id'>attempts</span> <span class='opasgn op'>-=</span> <span class='integer val'>1</span>
        <span class='retry retry kw'>retry</span> <span class='if if_mod kw'>if</span> <span class='attempts identifier id'>attempts</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>

        <span class='comment val'># Re-raise original exception</span>
        <span class='@error ivar id'>@error</span> <span class='assign token'>=</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='message identifier id'>message</span>
        <span class='raise identifier id'>raise</span> <span class='e identifier id'>e</span>
      <span class='ensure ensure kw'>ensure</span>
        <span class='comment val'># Close previously opened socket on any other error</span>
        <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='free_socket identifier id'>free_socket</span><span class='lparen token'>(</span><span class='socket identifier id'>socket</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="BuildExcerpts-instance_method">
  
    - (<tt>Array&lt;String&gt;</tt>) <strong>BuildExcerpts</strong>(docs, index, words, opts = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Excerpts (snippets) builder function. Connects to searchd, asks it to
generate excerpts (snippets) from given documents, and returns the results.
</p>
<p>
<tt>docs</tt> is a plain array of strings that carry the documents&#8217;
contents. <tt>index</tt> is an index name string. Different settings (such
as charset, morphology, wordforms) from given index will be used.
<tt>words</tt> is a string that contains the keywords to highlight. They
will be processed with respect to index settings. For instance, if English
stemming is enabled in the index, &quot;shoes&quot; will be highlighted
even if keyword is &quot;shoe&quot;. Starting with version 0.9.9-rc1,
keywords can contain wildcards, that work similarly to star-syntax
available in queries.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='BuildExcerpts constant id'>BuildExcerpts</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='string val'>'hello world'</span><span class='comma token'>,</span> <span class='string val'>'hello me'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='string val'>'idx'</span><span class='comma token'>,</span> <span class='string val'>'hello'</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
        <span class='name'>docs</span>
      
      
      
        &mdash;
        
an array of strings which represent the documents&#8217; contents.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>index</span>
      
      
      
        &mdash;
        
an index which settings will be used for stemming, lexing and case folding.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>words</span>
      
      
      
        &mdash;
        
a string which contains the words to highlight.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>opts</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        
a <tt>Hash</tt> which contains additional optional highlighting parameters.


      
    </li>
  
</ul>

  
    
    
    
    
    
    
    
    
    <h3>Options Hash (<tt>opts</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="type">(<tt>String</tt>)</span>
          <span class="name">'before_match'</span>
          <span class="default">
            
              &mdash; default:
              <tt>&quot;&lt;b&gt;&quot;</tt>
            
          </span>
          &mdash;
a string to insert before a keyword match.


        </tr>
      
        <li>
          <span class="type">(<tt>String</tt>)</span>
          <span class="name">'after_match'</span>
          <span class="default">
            
              &mdash; default:
              <tt>&quot;&lt;/b&gt;&quot;</tt>
            
          </span>
          &mdash;
a string to insert after a keyword match.


        </tr>
      
        <li>
          <span class="type">(<tt>String</tt>)</span>
          <span class="name">'chunk_separator'</span>
          <span class="default">
            
              &mdash; default:
              <tt>&quot; ... &quot;</tt>
            
          </span>
          &mdash;
a string to insert between snippet chunks (passages).


        </tr>
      
        <li>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="name">'limit'</span>
          <span class="default">
            
              &mdash; default:
              <tt>256</tt>
            
          </span>
          &mdash;
maximum snippet size, in symbols (codepoints).


        </tr>
      
        <li>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="name">'around'</span>
          <span class="default">
            
              &mdash; default:
              <tt>5</tt>
            
          </span>
          &mdash;
how many words to pick around each matching keywords block.


        </tr>
      
        <li>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="name">'exact_phrase'</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash;
whether to highlight exact query phrase matches only instead of individual
keywords.


        </tr>
      
        <li>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="name">'single_passage'</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash;
whether to extract single best passage only.


        </tr>
      
        <li>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="name">'use_boundaries'</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash;
whether to extract passages by phrase boundaries setup in tokenizer.


        </tr>
      
        <li>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="name">'weight_order'</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          &mdash;
whether to sort the extracted passages in order of relevance (decreasing
weight), or in order of appearance in the document (increasing position).


        </tr>
      
    </ul>
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>, <tt>false</tt>)</span>
      
      
      
      
        &mdash;
        
a plain array of strings with excerpts (snippets) on success; otherwise,
<tt>false</tt>.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-buildexcerpts" title="Section 6.7.1, \"BuildExcerpts\"">Section 6.7.1, "BuildExcerpts"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1813
1814
1815
1816
1817
1818
1819
1820
1821
1822
1823
1824
1825
1826
1827
1828
1829
1830
1831
1832
1833
1834
1835
1836
1837
1838
1839
1840
1841
1842
1843
1844
1845
1846
1847
1848
1849
1850
1851
1852
1853
1854
1855
1856
1857
1858
1859
1860
1861
1862
1863
1864
1865
1866</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1813</span>

<span class='def def kw'>def</span> <span class='BuildExcerpts constant id'>BuildExcerpts</span><span class='lparen token'>(</span><span class='docs identifier id'>docs</span><span class='comma token'>,</span> <span class='index identifier id'>index</span><span class='comma token'>,</span> <span class='words identifier id'>words</span><span class='comma token'>,</span> <span class='opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;docs&quot; argument must be Array'</span>   <span class='unless unless_mod kw'>unless</span> <span class='docs identifier id'>docs</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;index&quot; argument must be String'</span> <span class='unless unless_mod kw'>unless</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;words&quot; argument must be String'</span> <span class='unless unless_mod kw'>unless</span> <span class='words identifier id'>words</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;opts&quot; argument must be Hash'</span>    <span class='unless unless_mod kw'>unless</span> <span class='opts identifier id'>opts</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span>

  <span class='docs identifier id'>docs</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='doc identifier id'>doc</span><span class='bitor op'>|</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;docs&quot; argument must be Array of Strings'</span> <span class='unless unless_mod kw'>unless</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># fixup options</span>
  <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'before_match'</span><span class='rbrack token'>]</span>    <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:before_match</span><span class='rbrack token'>]</span>    <span class='orop op'>||</span> <span class='string val'>'&lt;b&gt;'</span><span class='semicolon token'>;</span>
  <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'after_match'</span><span class='rbrack token'>]</span>     <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:after_match</span><span class='rbrack token'>]</span>     <span class='orop op'>||</span> <span class='string val'>'&lt;/b&gt;'</span><span class='semicolon token'>;</span>
  <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'chunk_separator'</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:chunk_separator</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='string val'>' ... '</span><span class='semicolon token'>;</span>
  <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'limit'</span><span class='rbrack token'>]</span>           <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:limit</span><span class='rbrack token'>]</span>           <span class='orop op'>||</span> <span class='integer val'>256</span><span class='semicolon token'>;</span>
  <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'around'</span><span class='rbrack token'>]</span>          <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:around</span><span class='rbrack token'>]</span>          <span class='orop op'>||</span> <span class='integer val'>5</span><span class='semicolon token'>;</span>
  <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'exact_phrase'</span><span class='rbrack token'>]</span>    <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:exact_phrase</span><span class='rbrack token'>]</span>    <span class='orop op'>||</span> <span class='false false kw'>false</span>
  <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'single_passage'</span><span class='rbrack token'>]</span>  <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:single_passage</span><span class='rbrack token'>]</span>  <span class='orop op'>||</span> <span class='false false kw'>false</span>
  <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'use_boundaries'</span><span class='rbrack token'>]</span>  <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:use_boundaries</span><span class='rbrack token'>]</span>  <span class='orop op'>||</span> <span class='false false kw'>false</span>
  <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'weight_order'</span><span class='rbrack token'>]</span>    <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:weight_order</span><span class='rbrack token'>]</span>    <span class='orop op'>||</span> <span class='false false kw'>false</span>
  <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'query_mode'</span><span class='rbrack token'>]</span>      <span class='opasgn op'>||=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:query_mode</span><span class='rbrack token'>]</span>      <span class='orop op'>||</span> <span class='false false kw'>false</span>

  <span class='comment val'># build request</span>

  <span class='comment val'># v.1.0 req</span>
  <span class='flags identifier id'>flags</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
  <span class='flags identifier id'>flags</span> <span class='opasgn op'>|=</span> <span class='integer val'>2</span>  <span class='if if_mod kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'exact_phrase'</span><span class='rbrack token'>]</span>
  <span class='flags identifier id'>flags</span> <span class='opasgn op'>|=</span> <span class='integer val'>4</span>  <span class='if if_mod kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'single_passage'</span><span class='rbrack token'>]</span>
  <span class='flags identifier id'>flags</span> <span class='opasgn op'>|=</span> <span class='integer val'>8</span>  <span class='if if_mod kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'use_boundaries'</span><span class='rbrack token'>]</span>
  <span class='flags identifier id'>flags</span> <span class='opasgn op'>|=</span> <span class='integer val'>16</span> <span class='if if_mod kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'weight_order'</span><span class='rbrack token'>]</span>
  <span class='flags identifier id'>flags</span> <span class='opasgn op'>|=</span> <span class='integer val'>32</span> <span class='if if_mod kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'query_mode'</span><span class='rbrack token'>]</span>

  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='flags identifier id'>flags</span> <span class='comment val'># mode=0, flags=1 (remove spaces)</span>
  <span class='comment val'># req index</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='comment val'># req words</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='words identifier id'>words</span>

  <span class='comment val'># options</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'before_match'</span><span class='rbrack token'>]</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'after_match'</span><span class='rbrack token'>]</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'chunk_separator'</span><span class='rbrack token'>]</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'limit'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='comma token'>,</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='string val'>'around'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>

  <span class='comment val'># documents</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='docs identifier id'>docs</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='docs identifier id'>docs</span><span class='rparen token'>)</span>

  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='perform_request identifier id'>perform_request</span><span class='lparen token'>(</span><span class='symbol val'>:excerpt</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rparen token'>)</span>

  <span class='comment val'># parse response</span>
  <span class='docs identifier id'>docs</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="BuildKeywords-instance_method">
  
    - (<tt>Array&lt;Hash&gt;</tt>) <strong>BuildKeywords</strong>(query, index, hits) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Extracts keywords from query using tokenizer settings for given index,
optionally with per-keyword occurrence statistics. Returns an array of
hashes with per-keyword information.
</p>
<p>
<tt>query</tt> is a query to extract keywords from. <tt>index</tt> is a
name of the index to get tokenizing settings and keyword occurrence
statistics from. <tt>hits</tt> is a boolean flag that indicates whether
keyword occurrence statistics are required.
</p>
<p>
The result set consists of <tt>Hash</tt>es with the following keys and
values:
</p>
<table>
<tr><td valign="top"><tt>&#8216;tokenized&#8217;</tt>:</td><td>Tokenized keyword.

</td></tr>
<tr><td valign="top"><tt>&#8216;normalized&#8217;</tt>:</td><td>Normalized keyword.

</td></tr>
<tr><td valign="top"><tt>&#8216;docs&#8217;</tt>:</td><td>A number of documents where keyword is found (if <tt>hits</tt> param is
<tt>true</tt>).

</td></tr>
<tr><td valign="top"><tt>&#8216;hits&#8217;</tt>:</td><td>A number of keywords occurrences among all documents (if <tt>hits</tt>
param is <tt>true</tt>).

</td></tr>
</table>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='keywords identifier id'>keywords</span> <span class='assign token'>=</span> <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='BuildKeywords constant id'>BuildKeywords</span><span class='lparen token'>(</span><span class='string val'>&quot;this.is.my query&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;test1&quot;</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>query</span>
      
      
      
        &mdash;
        
a query string.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>index</span>
      
      
      
        &mdash;
        
an index to get tokenizing settings and keyword occurrence statistics from.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <span class='name'>hits</span>
      
      
      
        &mdash;
        
indicates whether keyword occurrence statistics are required.


      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
      
        &mdash;
        
an <tt>Array</tt> of <tt>Hash</tt>es in format specified above.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-buildkeywords" title="Section 6.7.3, \"BuildKeywords\"">Section 6.7.3, "BuildKeywords"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1903
1904
1905
1906
1907
1908
1909
1910
1911
1912
1913
1914
1915
1916
1917
1918
1919
1920
1921
1922
1923
1924
1925
1926
1927
1928</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1903</span>

<span class='def def kw'>def</span> <span class='BuildKeywords constant id'>BuildKeywords</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='index identifier id'>index</span><span class='comma token'>,</span> <span class='hits identifier id'>hits</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;query&quot; argument must be String'</span> <span class='unless unless_mod kw'>unless</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;index&quot; argument must be String'</span> <span class='unless unless_mod kw'>unless</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;hits&quot; argument must be Boolean'</span> <span class='unless unless_mod kw'>unless</span> <span class='hits identifier id'>hits</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='TrueClass constant id'>TrueClass</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='hits identifier id'>hits</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='FalseClass constant id'>FalseClass</span><span class='rparen token'>)</span>

  <span class='comment val'># build request</span>
  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='comment val'># v.1.0 req</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='query identifier id'>query</span> <span class='comment val'># req query</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='index identifier id'>index</span> <span class='comment val'># req index</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='hits identifier id'>hits</span> <span class='question op'>?</span> <span class='integer val'>1</span> <span class='colon op'>:</span> <span class='integer val'>0</span>

  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='perform_request identifier id'>perform_request</span><span class='lparen token'>(</span><span class='symbol val'>:keywords</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rparen token'>)</span>

  <span class='comment val'># parse response</span>
  <span class='nwords identifier id'>nwords</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
  <span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='nwords identifier id'>nwords</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span>
    <span class='tokenized identifier id'>tokenized</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span>
    <span class='normalized identifier id'>normalized</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span>

    <span class='entry identifier id'>entry</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='string val'>'tokenized'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='tokenized identifier id'>tokenized</span><span class='comma token'>,</span> <span class='string val'>'normalized'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='normalized identifier id'>normalized</span> <span class='rbrace token'>}</span>
    <span class='entry identifier id'>entry</span><span class='lbrack token'>[</span><span class='string val'>'docs'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='entry identifier id'>entry</span><span class='lbrack token'>[</span><span class='string val'>'hits'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_ints identifier id'>get_ints</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='hits identifier id'>hits</span>

    <span class='entry identifier id'>entry</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="Close-instance_method">
  
    - (<tt>Boolean</tt>) <strong>Close</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Closes previously opened persistent connection.
</p>
<p>
This method could be used only when a single searchd server configured.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='begin begin kw'>begin</span>
    <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='Open constant id'>Open</span>
    <span class='comment val'># perform several requests</span>
  <span class='ensure ensure kw'>ensure</span>
    <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='Close constant id'>Close</span>
  <span class='end end kw'>end</span>
</pre>
    
  </div>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
        &mdash;
        
<tt>true</tt> when persistent connection has been closed; otherwise,
<tt>false</tt>.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="#Open-instance_method" title="#Open">#Open</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2132
2133
2134
2135
2136
2137
2138
2139
2140
2141
2142
2143
2144</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 2132</span>

<span class='def def kw'>def</span> <span class='Close constant id'>Close</span>
  <span class='if if kw'>if</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
    <span class='@error ivar id'>@error</span> <span class='assign token'>=</span> <span class='string val'>'too many servers. persistent socket allowed only for a single server.'</span>
    <span class='return return kw'>return</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>

  <span class='unless unless kw'>unless</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='persistent? fid id'>persistent?</span>
    <span class='@error ivar id'>@error</span> <span class='assign token'>=</span> <span class='string val'>'not connected'</span>
    <span class='return return kw'>return</span> <span class='false false kw'>false</span><span class='semicolon token'>;</span>
  <span class='end end kw'>end</span>

  <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='close_persistent! fid id'>close_persistent!</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="FlushAttrs-instance_method">
  
    - (<tt>Object</tt>) <strong>FlushAttrs</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Force attribute flush, and block until it completes.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='FlushAttrs constant id'>FlushAttrs</span>
</pre>
    
  </div>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'></span>
      
      
      
      
        
        
current internal flush tag on success, -1 on failure.


      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2059
2060
2061
2062
2063
2064
2065
2066
2067
2068
2069</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 2059</span>

<span class='def def kw'>def</span> <span class='FlushAttrs constant id'>FlushAttrs</span>
  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='perform_request identifier id'>perform_request</span><span class='lparen token'>(</span><span class='symbol val'>:flushattrs</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rparen token'>)</span>

  <span class='comment val'># parse response</span>
  <span class='begin begin kw'>begin</span>
    <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
  <span class='rescue rescue kw'>rescue</span> <span class='EOFError constant id'>EOFError</span>
    <span class='integer val'>-1</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="GetLastError-instance_method">
  
    - (<tt>String</tt>) <strong>GetLastError</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns last error message, as a string, in human readable format. If there
were no errors during the previous API call, empty string is returned.
</p>
<p>
You should call it when any other function (such as <tt><a href="#Query-instance_method" title="#Query">#Query</a></tt>) fails
(typically, the failing function returns false). The returned string will
contain the error description.
</p>
<p>
The error message is not reset by this call; so you can safely call it
several times if needed.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='puts identifier id'>puts</span> <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='GetLastError constant id'>GetLastError</span>
</pre>
    
  </div>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
      
        &mdash;
        
last error message.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="#GetLastWarning-instance_method" title="#GetLastWarning">#GetLastWarning</a></li>
    
      <li><a href="#IsConnectError-instance_method" title="#IsConnectError">#IsConnectError</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


299
300
301</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 299</span>

<span class='def def kw'>def</span> <span class='GetLastError constant id'>GetLastError</span>
  <span class='@error ivar id'>@error</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="GetLastWarning-instance_method">
  
    - (<tt>String</tt>) <strong>GetLastWarning</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns last warning message, as a string, in human readable format. If
there were no warnings during the previous API call, empty string is
returned.
</p>
<p>
You should call it to verify whether your request (such as <tt><a href="#Query-instance_method" title="#Query">#Query</a></tt>) was
completed but with warnings. For instance, search query against a
distributed index might complete succesfully even if several remote agents
timed out. In that case, a warning message would be produced.
</p>
<p>
The warning message is not reset by this call; so you can safely call it
several times if needed.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='puts identifier id'>puts</span> <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='GetLastWarning constant id'>GetLastWarning</span>
</pre>
    
  </div>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
      
        &mdash;
        
last warning message.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="#GetLastError-instance_method" title="#GetLastError">#GetLastError</a></li>
    
      <li><a href="#IsConnectError-instance_method" title="#IsConnectError">#IsConnectError</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


322
323
324</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 322</span>

<span class='def def kw'>def</span> <span class='GetLastWarning constant id'>GetLastWarning</span>
  <span class='@warning ivar id'>@warning</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="IsConnectError-instance_method">
  
    - (<tt>Boolean</tt>) <strong>IsConnectError</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Checks whether the last error was a network error on API side, or a remote
error reported by searchd. Returns true if the last connection attempt to
searchd failed on API side, false otherwise (if the error was remote, or
there were no connection attempts at all).
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='puts identifier id'>puts</span> <span class='string val'>&quot;Connection failed!&quot;</span> <span class='if if_mod kw'>if</span> <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='IsConnectError constant id'>IsConnectError</span>
</pre>
    
  </div>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
        &mdash;
        
the value indicating whether last error was a nework error on API side.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="#GetLastError-instance_method" title="#GetLastError">#GetLastError</a></li>
    
      <li><a href="#GetLastWarning-instance_method" title="#GetLastWarning">#GetLastWarning</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


340
341
342</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 340</span>

<span class='def def kw'>def</span> <span class='IsConnectError constant id'>IsConnectError</span>
  <span class='@connerror ivar id'>@connerror</span> <span class='orop op'>||</span> <span class='false false kw'>false</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="Open-instance_method">
  
    - (<tt>Boolean</tt>) <strong>Open</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Opens persistent connection to the server.
</p>
<p>
This method could be used only when a single searchd server configured.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='begin begin kw'>begin</span>
    <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='Open constant id'>Open</span>
    <span class='comment val'># perform several requests</span>
  <span class='ensure ensure kw'>ensure</span>
    <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='Close constant id'>Close</span>
  <span class='end end kw'>end</span>
</pre>
    
  </div>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
        &mdash;
        
<tt>true</tt> when persistent connection has been established; otherwise,
<tt>false</tt>.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="#Close-instance_method" title="#Close">#Close</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2093
2094
2095
2096
2097
2098
2099
2100
2101
2102
2103
2104
2105
2106
2107
2108
2109
2110
2111
2112</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 2093</span>

<span class='def def kw'>def</span> <span class='Open constant id'>Open</span>
  <span class='if if kw'>if</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
    <span class='@error ivar id'>@error</span> <span class='assign token'>=</span> <span class='string val'>'too many servers. persistent socket allowed only for a single server.'</span>
    <span class='return return kw'>return</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='persistent? fid id'>persistent?</span>
    <span class='@error ivar id'>@error</span> <span class='assign token'>=</span> <span class='string val'>'already connected'</span>
    <span class='return return kw'>return</span> <span class='false false kw'>false</span><span class='semicolon token'>;</span>
  <span class='end end kw'>end</span>

  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span>

  <span class='perform_request identifier id'>perform_request</span><span class='lparen token'>(</span><span class='symbol val'>:persist</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
    <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='make_persistent! fid id'>make_persistent!</span><span class='lparen token'>(</span><span class='socket identifier id'>socket</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="Query-instance_method">
  
    - (<tt>Hash</tt>) <strong>Query</strong>(query, index = '*', comment = '') 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Connects to searchd server, runs given search query with current settings,
obtains and returns the result set.
</p>
<p>
<tt>query</tt> is a query string. <tt>index</tt> is an index name (or
names) string. Returns false and sets <tt><a href="#GetLastError-instance_method" title="#GetLastError">#GetLastError</a></tt> message on general
error. Returns search result set on success. Additionally, the contents of
<tt>comment</tt> are sent to the query log, marked in square brackets, just
before the search terms, which can be very useful for debugging. Currently,
the comment is limited to 128 characters.
</p>
<p>
Default value for <tt>index</tt> is <tt>&quot;*&quot;</tt> that means to
query all local indexes. Characters allowed in index names include Latin
letters (a-z), numbers (0-9), minus sign (-), and underscore (_);
everything else is considered a separator. Therefore, all of the following
samples calls are valid and will search the same two indexes:
</p>
<pre class="code">
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='Query constant id'>Query</span><span class='lparen token'>(</span><span class='string val'>'test query'</span><span class='comma token'>,</span> <span class='string val'>'main delta'</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='Query constant id'>Query</span><span class='lparen token'>(</span><span class='string val'>'test query'</span><span class='comma token'>,</span> <span class='string val'>'main;delta'</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='Query constant id'>Query</span><span class='lparen token'>(</span><span class='string val'>'test query'</span><span class='comma token'>,</span> <span class='string val'>'main, delta'</span><span class='rparen token'>)</span><span class='semicolon token'>;</span>
</pre>
<p>
Index specification order matters. If document with identical IDs are found
in two or more indexes, weight and attribute values from the very last
matching index will be used for sorting and returning to client (unless
explicitly overridden with <tt><a href="#SetIndexWeights-instance_method" title="#SetIndexWeights">#SetIndexWeights</a></tt>). Therefore, in the example
above, matches from &quot;delta&quot; index will always win over matches
from &quot;main&quot;.
</p>
<p>
On success, <tt><a href="#Query-instance_method" title="#Query">#Query</a></tt> returns a result set that contains some of the found
matches (as requested by <tt><a href="#SetLimits-instance_method" title="#SetLimits">#SetLimits</a></tt>) and additional general per-query
statistics. The result set is an <tt>Hash</tt> with the following keys and
values:
</p>
<table>
<tr><td valign="top"><tt>&quot;matches&quot;</tt>:</td><td>Array with small <tt>Hash</tt>es containing document weight and attribute
values.

</td></tr>
<tr><td valign="top"><tt>&quot;total&quot;</tt>:</td><td>Total amount of matches retrieved on server (ie. to the server side result
set) by this query. You can retrieve up to this amount of matches from
server for this query text with current query settings.

</td></tr>
<tr><td valign="top"><tt>&quot;total_found&quot;</tt>:</td><td>Total amount of matching documents in index (that were found and procesed
on server).

</td></tr>
<tr><td valign="top"><tt>&quot;words&quot;</tt>:</td><td>Hash which maps query keywords (case-folded, stemmed, and otherwise
processed) to a small Hash with per-keyword statitics (&quot;docs&quot;,
&quot;hits&quot;).

</td></tr>
<tr><td valign="top"><tt>&quot;error&quot;</tt>:</td><td>Query error message reported by searchd (string, human readable). Empty if
there were no errors.

</td></tr>
<tr><td valign="top"><tt>&quot;warning&quot;</tt>:</td><td>Query warning message reported by searchd (string, human readable). Empty
if there were no warnings.

</td></tr>
</table>
<p>
It should be noted that <tt><a href="#Query-instance_method" title="#Query">#Query</a></tt> carries out the same actions as
<tt><a href="#AddQuery-instance_method" title="#AddQuery">#AddQuery</a></tt> and <tt><a href="#RunQueries-instance_method" title="#RunQueries">#RunQueries</a></tt> without the intermediate steps; it is
analoguous to a single <tt><a href="#AddQuery-instance_method" title="#AddQuery">#AddQuery</a></tt> call, followed by a corresponding
<tt><a href="#RunQueries-instance_method" title="#RunQueries">#RunQueries</a></tt>, then returning the first array element of matches (from the
first, and only, query.)
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='Query constant id'>Query</span><span class='lparen token'>(</span><span class='string val'>'some search text'</span><span class='comma token'>,</span> <span class='string val'>'*'</span><span class='comma token'>,</span> <span class='string val'>'search page'</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>query</span>
      
      
      
        &mdash;
        
a query string.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>index</span>
      
      
        <em class="default">(defaults to: <tt>'*'</tt>)</em>
      
      
        &mdash;
        
an index name (or names).


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>comment</span>
      
      
        <em class="default">(defaults to: <tt>''</tt>)</em>
      
      
        &mdash;
        
a comment to be sent to the query log.


      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>, <tt>false</tt>)</span>
      
      
      
      
        &mdash;
        
result set described above or <tt>false</tt> on error.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-query" title="Section 6.6.1, \"Query\"">Section 6.6.1, "Query"</a></li>
    
      <li><a href="#AddQuery-instance_method" title="#AddQuery">#AddQuery</a></li>
    
      <li><a href="#RunQueries-instance_method" title="#RunQueries">#RunQueries</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1408
1409
1410
1411
1412
1413
1414
1415
1416
1417
1418
1419
1420
1421
1422</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1408</span>

<span class='def def kw'>def</span> <span class='Query constant id'>Query</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='index identifier id'>index</span> <span class='assign token'>=</span> <span class='string val'>'*'</span><span class='comma token'>,</span> <span class='comment identifier id'>comment</span> <span class='assign token'>=</span> <span class='string val'>''</span><span class='rparen token'>)</span>
  <span class='@reqs ivar id'>@reqs</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='AddQuery constant id'>AddQuery</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='index identifier id'>index</span><span class='comma token'>,</span> <span class='comment identifier id'>comment</span><span class='rparen token'>)</span>
  <span class='results identifier id'>results</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='RunQueries constant id'>RunQueries</span>

  <span class='comment val'># probably network error; error message should be already filled</span>
  <span class='return return kw'>return</span> <span class='false false kw'>false</span> <span class='unless unless_mod kw'>unless</span> <span class='results identifier id'>results</span><span class='dot token'>.</span><span class='instance_of? fid id'>instance_of?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>

  <span class='@error ivar id'>@error</span> <span class='assign token'>=</span> <span class='results identifier id'>results</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'error'</span><span class='rbrack token'>]</span>
  <span class='@warning ivar id'>@warning</span> <span class='assign token'>=</span> <span class='results identifier id'>results</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'warning'</span><span class='rbrack token'>]</span>

  <span class='return return kw'>return</span> <span class='false false kw'>false</span> <span class='if if_mod kw'>if</span> <span class='results identifier id'>results</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'status'</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='SEARCHD_ERROR constant id'>SEARCHD_ERROR</span>
  <span class='return return kw'>return</span> <span class='results identifier id'>results</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="ResetFilters-instance_method">
  
    - (<tt>Object</tt>) <strong>ResetFilters</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Clears all currently set filters.
</p>
<p>
This call is only normally required when using multi-queries. You might
want to set different filters for different queries in the batch. To do
that, you should call <tt><a href="#ResetFilters-instance_method" title="#ResetFilters">#ResetFilters</a></tt> and add new filters using the
respective calls.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='ResetFilters constant id'>ResetFilters</span>
</pre>
    
  </div>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="#SetFilter-instance_method" title="#SetFilter">#SetFilter</a></li>
    
      <li><a href="#SetFilterRange-instance_method" title="#SetFilterRange">#SetFilterRange</a></li>
    
      <li><a href="#SetFilterFloatRange-instance_method" title="#SetFilterFloatRange">#SetFilterFloatRange</a></li>
    
      <li><a href="#SetGeoAnchor-instance_method" title="#SetGeoAnchor">#SetGeoAnchor</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1290
1291
1292
1293</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1290</span>

<span class='def def kw'>def</span> <span class='ResetFilters constant id'>ResetFilters</span>
  <span class='@filters ivar id'>@filters</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@anchor ivar id'>@anchor</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="ResetGroupBy-instance_method">
  
    - (<tt>Object</tt>) <strong>ResetGroupBy</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Clears all currently group-by settings, and disables group-by.
</p>
<p>
This call is only normally required when using multi-queries. You can
change individual group-by settings using <tt><a href="#SetGroupBy-instance_method" title="#SetGroupBy">#SetGroupBy</a></tt> and
<tt><a href="#SetGroupDistinct-instance_method" title="#SetGroupDistinct">#SetGroupDistinct</a></tt> calls, but you can not disable group-by using those
calls. <tt><a href="#ResetGroupBy-instance_method" title="#ResetGroupBy">#ResetGroupBy</a></tt> fully resets previous group-by settings and disables
group-by mode in the current state, so that subsequent <tt><a href="#AddQuery-instance_method" title="#AddQuery">#AddQuery</a></tt> calls
can perform non-grouping searches.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='ResetGroupBy constant id'>ResetGroupBy</span>
</pre>
    
  </div>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="#SetGroupBy-instance_method" title="#SetGroupBy">#SetGroupBy</a></li>
    
      <li><a href="#SetGroupDistinct-instance_method" title="#SetGroupDistinct">#SetGroupDistinct</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1310
1311
1312
1313
1314
1315</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1310</span>

<span class='def def kw'>def</span> <span class='ResetGroupBy constant id'>ResetGroupBy</span>
  <span class='@groupby ivar id'>@groupby</span>       <span class='assign token'>=</span> <span class='string val'>''</span>
  <span class='@groupfunc ivar id'>@groupfunc</span>     <span class='assign token'>=</span> <span class='SPH_GROUPBY_DAY constant id'>SPH_GROUPBY_DAY</span>
  <span class='@groupsort ivar id'>@groupsort</span>     <span class='assign token'>=</span> <span class='string val'>'@group desc'</span>
  <span class='@groupdistinct ivar id'>@groupdistinct</span> <span class='assign token'>=</span> <span class='string val'>''</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="ResetOverrides-instance_method">
  
    - (<tt>Object</tt>) <strong>ResetOverrides</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Clear all attribute value overrides (for multi-queries).
</p>
<p>
This call is only normally required when using multi-queries. You might
want to set field overrides for different queries in the batch. To do that,
you should call <tt><a href="#ResetOverrides-instance_method" title="#ResetOverrides">#ResetOverrides</a></tt> and add new overrides using the
respective calls.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='ResetOverrides constant id'>ResetOverrides</span>
</pre>
    
  </div>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li>#SetOverrides</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1329
1330
1331</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1329</span>

<span class='def def kw'>def</span> <span class='ResetOverrides constant id'>ResetOverrides</span>
  <span class='@overrides ivar id'>@overrides</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="RunQueries-instance_method">
  
    - (<tt>Array&lt;Hash&gt;</tt>) <strong>RunQueries</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Connect to searchd, runs a batch of all queries added using <tt><a href="#AddQuery-instance_method" title="#AddQuery">#AddQuery</a></tt>,
obtains and returns the result sets. Returns <tt>false</tt> and sets
<tt><a href="#GetLastError-instance_method" title="#GetLastError">#GetLastError</a></tt> message on general error (such as network I/O failure).
Returns a plain array of result sets on success.
</p>
<p>
Each result set in the returned array is exactly the same as the result set
returned from <tt><a href="#Query-instance_method" title="#Query">#Query</a></tt>.
</p>
<p>
Note that the batch query request itself almost always succeds  unless
there&#8217;s a network error, blocking index rotation in progress, or
another general failure which prevents the whole request from being
processed.
</p>
<p>
However individual queries within the batch might very well fail. In this
case their respective result sets will contain non-empty &quot;error&quot;
message, but no matches or query statistics. In the extreme case all
queries within the batch could fail. There still will be no general error
reported, because API was able to succesfully connect to searchd, submit
the batch, and receive the results  but every result set will have a
specific error message.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='AddQuery constant id'>AddQuery</span><span class='lparen token'>(</span><span class='string val'>'some search text'</span><span class='comma token'>,</span> <span class='string val'>'*'</span><span class='comma token'>,</span> <span class='string val'>'search page'</span><span class='rparen token'>)</span>
  <span class='results identifier id'>results</span> <span class='assign token'>=</span> <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='RunQueries constant id'>RunQueries</span>
</pre>
    
  </div>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
      
        &mdash;
        
an <tt>Array</tt> of <tt>Hash</tt>es which are exactly the same as the
result set returned from <tt><a href="#Query-instance_method" title="#Query">#Query</a></tt>.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-runqueries" title="Section 6.6.3, \"RunQueries\"">Section 6.6.3, "RunQueries"</a></li>
    
      <li><a href="#AddQuery-instance_method" title="#AddQuery">#AddQuery</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1640
1641
1642
1643
1644
1645
1646
1647
1648
1649
1650
1651
1652
1653
1654
1655
1656
1657
1658
1659
1660
1661
1662
1663
1664
1665
1666
1667
1668
1669
1670
1671
1672
1673
1674
1675
1676
1677
1678
1679
1680
1681
1682
1683
1684
1685
1686
1687
1688
1689
1690
1691
1692
1693
1694
1695
1696
1697
1698
1699
1700
1701
1702
1703
1704
1705
1706
1707
1708
1709
1710
1711
1712
1713
1714
1715
1716
1717
1718
1719
1720
1721
1722
1723
1724
1725
1726
1727
1728
1729
1730
1731
1732
1733
1734
1735
1736
1737
1738
1739
1740
1741
1742
1743
1744
1745
1746
1747
1748
1749
1750
1751
1752
1753
1754
1755
1756
1757</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1640</span>

<span class='def def kw'>def</span> <span class='RunQueries constant id'>RunQueries</span>
  <span class='if if kw'>if</span> <span class='@reqs ivar id'>@reqs</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='@error ivar id'>@error</span> <span class='assign token'>=</span> <span class='string val'>'No queries defined, issue AddQuery() first'</span>
    <span class='return return kw'>return</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>

  <span class='req identifier id'>req</span> <span class='assign token'>=</span> <span class='@reqs ivar id'>@reqs</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>''</span><span class='rparen token'>)</span>
  <span class='nreqs identifier id'>nreqs</span> <span class='assign token'>=</span> <span class='@reqs ivar id'>@reqs</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
  <span class='@reqs ivar id'>@reqs</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='perform_request identifier id'>perform_request</span><span class='lparen token'>(</span><span class='symbol val'>:search</span><span class='comma token'>,</span> <span class='req identifier id'>req</span><span class='comma token'>,</span> <span class='nreqs identifier id'>nreqs</span><span class='rparen token'>)</span>

  <span class='comment val'># parse response</span>
  <span class='results identifier id'>results</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='ires identifier id'>ires</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='while while kw'>while</span> <span class='ires identifier id'>ires</span> <span class='lt op'>&lt;</span> <span class='nreqs identifier id'>nreqs</span>
    <span class='ires identifier id'>ires</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
    <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

    <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'error'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>''</span>
    <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'warning'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>''</span>

    <span class='comment val'># extract status</span>
    <span class='status identifier id'>status</span> <span class='assign token'>=</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'status'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
    <span class='if if kw'>if</span> <span class='status identifier id'>status</span> <span class='neq op'>!=</span> <span class='SEARCHD_OK constant id'>SEARCHD_OK</span>
      <span class='message identifier id'>message</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span>
      <span class='if if kw'>if</span> <span class='status identifier id'>status</span> <span class='eq op'>==</span> <span class='SEARCHD_WARNING constant id'>SEARCHD_WARNING</span>
        <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'warning'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='message identifier id'>message</span>
      <span class='else else kw'>else</span>
        <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'error'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='message identifier id'>message</span>
        <span class='results identifier id'>results</span> <span class='lshft op'>&lt;&lt;</span> <span class='result identifier id'>result</span>
        <span class='next next kw'>next</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># read schema</span>
    <span class='fields identifier id'>fields</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='attrs identifier id'>attrs</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='attrs_names_in_order identifier id'>attrs_names_in_order</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

    <span class='nfields identifier id'>nfields</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
    <span class='while while kw'>while</span> <span class='nfields identifier id'>nfields</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
      <span class='nfields identifier id'>nfields</span> <span class='opasgn op'>-=</span> <span class='integer val'>1</span>
      <span class='fields identifier id'>fields</span> <span class='lshft op'>&lt;&lt;</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span>
    <span class='end end kw'>end</span>
    <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'fields'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='fields identifier id'>fields</span>

    <span class='nattrs identifier id'>nattrs</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
    <span class='while while kw'>while</span> <span class='nattrs identifier id'>nattrs</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
      <span class='nattrs identifier id'>nattrs</span> <span class='opasgn op'>-=</span> <span class='integer val'>1</span>
      <span class='attr identifier id'>attr</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span>
      <span class='type identifier id'>type</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
      <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='attr identifier id'>attr</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='type identifier id'>type</span>
      <span class='attrs_names_in_order identifier id'>attrs_names_in_order</span> <span class='lshft op'>&lt;&lt;</span> <span class='attr identifier id'>attr</span>
    <span class='end end kw'>end</span>
    <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'attrs'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='attrs identifier id'>attrs</span>

    <span class='comment val'># read match count</span>
    <span class='count identifier id'>count</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
    <span class='id64 identifier id'>id64</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>

    <span class='comment val'># read matches</span>
    <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'matches'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='while while kw'>while</span> <span class='count identifier id'>count</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
      <span class='count identifier id'>count</span> <span class='opasgn op'>-=</span> <span class='integer val'>1</span>

      <span class='if if kw'>if</span> <span class='id64 identifier id'>id64</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
        <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int64 identifier id'>get_int64</span>
        <span class='weight identifier id'>weight</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
      <span class='else else kw'>else</span>
        <span class='doc identifier id'>doc</span><span class='comma token'>,</span> <span class='weight identifier id'>weight</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_ints identifier id'>get_ints</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>

      <span class='r identifier id'>r</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span> <span class='comment val'># This is a single result put in the result['matches'] array</span>
      <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'id'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='doc identifier id'>doc</span>
      <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'weight'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='weight identifier id'>weight</span>
      <span class='attrs_names_in_order identifier id'>attrs_names_in_order</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span>
        <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'attrs'</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

        <span class='case case kw'>case</span> <span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span>
          <span class='when when kw'>when</span> <span class='SPH_ATTR_BIGINT constant id'>SPH_ATTR_BIGINT</span>
            <span class='comment val'># handle 64-bit ints</span>
            <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'attrs'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int64 identifier id'>get_int64</span>
          <span class='when when kw'>when</span> <span class='SPH_ATTR_FLOAT constant id'>SPH_ATTR_FLOAT</span>
            <span class='comment val'># handle floats</span>
            <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'attrs'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_float identifier id'>get_float</span>
          <span class='when when kw'>when</span> <span class='SPH_ATTR_STRING constant id'>SPH_ATTR_STRING</span>
            <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'attrs'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span>
          <span class='else else kw'>else</span>
            <span class='comment val'># handle everything else as unsigned ints</span>
            <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
            <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='attrs identifier id'>attrs</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span> <span class='bitand op'>&amp;</span> <span class='SPH_ATTR_MULTI constant id'>SPH_ATTR_MULTI</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
              <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'attrs'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
              <span class='float val'>1</span><span class='dot token'>.</span><span class='upto identifier id'>upto</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
                <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'attrs'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
              <span class='end end kw'>end</span>
            <span class='else else kw'>else</span>
              <span class='r identifier id'>r</span><span class='lbrack token'>[</span><span class='string val'>'attrs'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
            <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'matches'</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='r identifier id'>r</span>
    <span class='end end kw'>end</span>
    <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'total'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'total_found'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='msecs identifier id'>msecs</span><span class='comma token'>,</span> <span class='words identifier id'>words</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_ints identifier id'>get_ints</span><span class='lparen token'>(</span><span class='integer val'>4</span><span class='rparen token'>)</span>
    <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'time'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'%.3f'</span> <span class='mod op'>%</span> <span class='lparen token'>(</span><span class='msecs identifier id'>msecs</span> <span class='div op'>/</span> <span class='float val'>1000.0</span><span class='rparen token'>)</span>

    <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'words'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='while while kw'>while</span> <span class='words identifier id'>words</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
      <span class='words identifier id'>words</span> <span class='opasgn op'>-=</span> <span class='integer val'>1</span>
      <span class='word identifier id'>word</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span>
      <span class='docs identifier id'>docs</span><span class='comma token'>,</span> <span class='hits identifier id'>hits</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_ints identifier id'>get_ints</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span>
      <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='string val'>'words'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='word identifier id'>word</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='string val'>'docs'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='docs identifier id'>docs</span><span class='comma token'>,</span> <span class='string val'>'hits'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='hits identifier id'>hits</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>

    <span class='results identifier id'>results</span> <span class='lshft op'>&lt;&lt;</span> <span class='result identifier id'>result</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='results identifier id'>results</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetConnectTimeout-instance_method">
  
    - (<tt>Object</tt>) <strong>SetConnectTimeout</strong>(timeout, retries = 1) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets the time allowed to spend connecting to the server before giving up
and number of retries to perform.
</p>
<p>
In the event of a failure to connect, an appropriate error code should be
returned back to the application in order for application-level error
handling to advise the user.
</p>
<p>
When multiple servers configured through <tt><a href="#SetServers-instance_method" title="#SetServers">#SetServers</a></tt> method, and
<tt>retries</tt> number is greater than 1, library will try to connect to
another server. In case of single server configured, it will try to
reconnect <tt>retries</tt> times.
</p>
<p>
Please note, this timeout will only be used for connection establishing,
not for regular API requests.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4>
Set connection timeout to 1 second and number of retries to 5

</h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetConnectTimeout constant id'>SetConnectTimeout</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='integer val'>5</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>timeout</span>
      
      
      
        &mdash;
        
a connection timeout in seconds.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>retries</span>
      
      
        <em class="default">(defaults to: <tt>1</tt>)</em>
      
      
        &mdash;
        
number of connect retries.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="#SetServer-instance_method" title="#SetServer">#SetServer</a></li>
    
      <li><a href="#SetServers-instance_method" title="#SetServers">#SetServers</a></li>
    
      <li><a href="#SetRequestTimeout-instance_method" title="#SetRequestTimeout">#SetRequestTimeout</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


467
468
469
470
471
472
473
474</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 467</span>

<span class='def def kw'>def</span> <span class='SetConnectTimeout constant id'>SetConnectTimeout</span><span class='lparen token'>(</span><span class='timeout identifier id'>timeout</span><span class='comma token'>,</span> <span class='retries identifier id'>retries</span> <span class='assign token'>=</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;timeout&quot; argument must be Integer'</span>        <span class='unless unless_mod kw'>unless</span> <span class='timeout identifier id'>timeout</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='timeout identifier id'>timeout</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;retries&quot; argument must be Integer'</span>        <span class='unless unless_mod kw'>unless</span> <span class='retries identifier id'>retries</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='retries identifier id'>retries</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;retries&quot; argument must be greater than 0'</span> <span class='unless unless_mod kw'>unless</span> <span class='retries identifier id'>retries</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>

  <span class='@timeout ivar id'>@timeout</span> <span class='assign token'>=</span> <span class='timeout identifier id'>timeout</span>
  <span class='@retries ivar id'>@retries</span> <span class='assign token'>=</span> <span class='retries identifier id'>retries</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetFieldWeights-instance_method">
  
    - (<tt>Object</tt>) <strong>SetFieldWeights</strong>(weights) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Binds per-field weights by name. Parameter must be a <tt>Hash</tt> mapping
string field names to integer weights.
</p>
<p>
Match ranking can be affected by per-field weights. For instance, see
Section 4.4, &quot;Weighting&quot; for an explanation how phrase proximity
ranking is affected. This call lets you specify what non-default weights to
assign to different full-text fields.
</p>
<p>
The weights must be positive 32-bit integers. The final weight will be a
32-bit integer too. Default weight value is 1. Unknown field names will be
silently ignored.
</p>
<p>
There is no enforced limit on the maximum weight value at the moment.
However, beware that if you set it too high you can start hitting 32-bit
wraparound issues. For instance, if you set a weight of 10,000,000 and
search in extended mode, then maximum possible weight will be equal to 10
million (your weight) by 1 thousand (internal BM25 scaling factor, see
Section 4.4, Weighting) by 1 or more (phrase proximity rank). The
result is at least 10 billion that does not fit in 32 bits and will be
wrapped around, producing unexpected results.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetFieldWeights constant id'>SetFieldWeights</span><span class='lparen token'>(</span><span class='symbol val'>:title</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>20</span><span class='comma token'>,</span> <span class='symbol val'>:text</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>10</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>weights</span>
      
      
      
        &mdash;
        
a <tt>Hash</tt> mapping string field names to integer weights.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#weighting" title="Section 4.4, \"Weighting\"">Section 4.4, "Weighting"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setfieldweights" title="Section 6.3.5, \"SetFieldWeights\"">Section 6.3.5, "SetFieldWeights"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


907
908
909
910
911
912
913
914
915
916</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 907</span>

<span class='def def kw'>def</span> <span class='SetFieldWeights constant id'>SetFieldWeights</span><span class='lparen token'>(</span><span class='weights identifier id'>weights</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;weights&quot; argument must be Hash'</span> <span class='unless unless_mod kw'>unless</span> <span class='weights identifier id'>weights</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span>
  <span class='weights identifier id'>weights</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='weight identifier id'>weight</span><span class='bitor op'>|</span>
    <span class='unless unless kw'>unless</span> <span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='lparen token'>(</span><span class='weight identifier id'>weight</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='weight identifier id'>weight</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span><span class='rparen token'>)</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;weights&quot; argument must be Hash map of strings to integers'</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='@fieldweights ivar id'>@fieldweights</span> <span class='assign token'>=</span> <span class='weights identifier id'>weights</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetFilter-instance_method">
  
    - (<tt>Object</tt>) <strong>SetFilter</strong>(attribute, values, exclude = false) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Adds new integer values set filter.
</p>
<p>
On this call, additional new filter is added to the existing list of
filters. $attribute must be a string with attribute name. <tt>values</tt>
must be a plain array containing integer values. <tt>exclude</tt> must be a
boolean value; it controls whether to accept the matching documents
(default mode, when <tt>exclude</tt> is <tt>false</tt>) or reject them.
</p>
<p>
Only those documents where <tt>attribute</tt> column value stored in the
index matches any of the values from <tt>values</tt> array will be matched
(or rejected, if <tt>exclude</tt> is <tt>true</tt>).
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetFilter constant id'>SetFilter</span><span class='lparen token'>(</span><span class='symbol val'>:group_id</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='integer val'>10</span><span class='comma token'>,</span> <span class='integer val'>15</span><span class='comma token'>,</span> <span class='integer val'>20</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetFilter constant id'>SetFilter</span><span class='lparen token'>(</span><span class='symbol val'>:group_id</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='integer val'>10</span><span class='comma token'>,</span> <span class='integer val'>15</span><span class='comma token'>,</span> <span class='integer val'>20</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
        <span class='name'>attribute</span>
      
      
      
        &mdash;
        
an attribute name to filter by.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Array&lt;Integer&gt;</tt>)</span>
      
      
        <span class='name'>values</span>
      
      
      
        &mdash;
        
an <tt>Array</tt> of integers with given attribute values.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <span class='name'>exclude</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        
indicating whether documents with given attribute matching specified values
should be excluded from search results.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setfilter" title="Section 6.4.2, \"SetFilter\"">Section 6.4.2, "SetFilter"</a></li>
    
      <li><a href="#SetFilterRange-instance_method" title="#SetFilterRange">#SetFilterRange</a></li>
    
      <li><a href="#SetFilterFloatRange-instance_method" title="#SetFilterFloatRange">#SetFilterFloatRange</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1019</span>

<span class='def def kw'>def</span> <span class='SetFilter constant id'>SetFilter</span><span class='lparen token'>(</span><span class='attribute identifier id'>attribute</span><span class='comma token'>,</span> <span class='values identifier id'>values</span><span class='comma token'>,</span> <span class='exclude identifier id'>exclude</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;attribute&quot; argument must be String or Symbol'</span> <span class='unless unless_mod kw'>unless</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Array'</span>               <span class='unless unless_mod kw'>unless</span> <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must not be empty'</span>           <span class='if if_mod kw'>if</span> <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;exclude&quot; argument must be Boolean'</span>            <span class='unless unless_mod kw'>unless</span> <span class='exclude identifier id'>exclude</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='TrueClass constant id'>TrueClass</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='exclude identifier id'>exclude</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='FalseClass constant id'>FalseClass</span><span class='rparen token'>)</span>

  <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Array of Integer'</span> <span class='unless unless_mod kw'>unless</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
  <span class='end end kw'>end</span>

  <span class='@filters ivar id'>@filters</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrace token'>{</span> <span class='string val'>'type'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='SPH_FILTER_VALUES constant id'>SPH_FILTER_VALUES</span><span class='comma token'>,</span> <span class='string val'>'attr'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='string val'>'exclude'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='exclude identifier id'>exclude</span><span class='comma token'>,</span> <span class='string val'>'values'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='values identifier id'>values</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetFilterFloatRange-instance_method">
  
    - (<tt>Object</tt>) <strong>SetFilterFloatRange</strong>(attribute, min, max, exclude = false) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Adds new float range filter.
</p>
<p>
On this call, additional new filter is added to the existing list of
filters. <tt>attribute</tt> must be a string with attribute name.
<tt>min</tt> and <tt>max</tt> must be floats that define the acceptable
attribute values range (including the boundaries). <tt>exclude</tt> must be
a boolean value; it controls whether to accept the matching documents
(default mode, when <tt>exclude</tt> is false) or reject them.
</p>
<p>
Only those documents where <tt>attribute</tt> column value stored in the
index is between <tt>min</tt> and <tt>max</tt> (including values that are
exactly equal to <tt>min</tt> or <tt>max</tt>) will be matched (or
rejected, if <tt>exclude</tt> is true).
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetFilterFloatRange constant id'>SetFilterFloatRange</span><span class='lparen token'>(</span><span class='symbol val'>:group_id</span><span class='comma token'>,</span> <span class='float val'>10.5</span><span class='comma token'>,</span> <span class='integer val'>20</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetFilterFloatRange constant id'>SetFilterFloatRange</span><span class='lparen token'>(</span><span class='symbol val'>:group_id</span><span class='comma token'>,</span> <span class='float val'>10.5</span><span class='comma token'>,</span> <span class='integer val'>20</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
        <span class='name'>attribute</span>
      
      
      
        &mdash;
        
an attribute name to filter by.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>, <tt>Float</tt>)</span>
      
      
        <span class='name'>min</span>
      
      
      
        &mdash;
        
min value of the given attribute.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>, <tt>Float</tt>)</span>
      
      
        <span class='name'>max</span>
      
      
      
        &mdash;
        
max value of the given attribute.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <span class='name'>exclude</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        
indicating whether documents with given attribute matching specified
boundaries should be excluded from search results.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setfilterfloatrange" title="Section 6.4.4, \"SetFilterFloatRange\"">Section 6.4.4, "SetFilterFloatRange"</a></li>
    
      <li><a href="#SetFilter-instance_method" title="#SetFilter">#SetFilter</a></li>
    
      <li><a href="#SetFilterRange-instance_method" title="#SetFilterRange">#SetFilterRange</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1103
1104
1105
1106
1107
1108
1109
1110
1111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1103</span>

<span class='def def kw'>def</span> <span class='SetFilterFloatRange constant id'>SetFilterFloatRange</span><span class='lparen token'>(</span><span class='attribute identifier id'>attribute</span><span class='comma token'>,</span> <span class='min identifier id'>min</span><span class='comma token'>,</span> <span class='max identifier id'>max</span><span class='comma token'>,</span> <span class='exclude identifier id'>exclude</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;attribute&quot; argument must be String or Symbol'</span> <span class='unless unless_mod kw'>unless</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;min&quot; argument must be Float or Integer'</span>       <span class='unless unless_mod kw'>unless</span> <span class='min identifier id'>min</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='lparen token'>(</span><span class='min identifier id'>min</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='min identifier id'>min</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;max&quot; argument must be Float or Integer'</span>       <span class='unless unless_mod kw'>unless</span> <span class='max identifier id'>max</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='lparen token'>(</span><span class='max identifier id'>max</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='max identifier id'>max</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;max&quot; argument greater or equal to &quot;min&quot;'</span>      <span class='unless unless_mod kw'>unless</span> <span class='min identifier id'>min</span> <span class='leq op'>&lt;=</span> <span class='max identifier id'>max</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;exclude&quot; argument must be Boolean'</span>            <span class='unless unless_mod kw'>unless</span> <span class='exclude identifier id'>exclude</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='TrueClass constant id'>TrueClass</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='exclude identifier id'>exclude</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='FalseClass constant id'>FalseClass</span><span class='rparen token'>)</span>

  <span class='@filters ivar id'>@filters</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrace token'>{</span> <span class='string val'>'type'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='SPH_FILTER_FLOATRANGE constant id'>SPH_FILTER_FLOATRANGE</span><span class='comma token'>,</span> <span class='string val'>'attr'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='string val'>'exclude'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='exclude identifier id'>exclude</span><span class='comma token'>,</span> <span class='string val'>'min'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='min identifier id'>min</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='comma token'>,</span> <span class='string val'>'max'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='max identifier id'>max</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetFilterRange-instance_method">
  
    - (<tt>Object</tt>) <strong>SetFilterRange</strong>(attribute, min, max, exclude = false) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Adds new integer range filter.
</p>
<p>
On this call, additional new filter is added to the existing list of
filters. <tt>attribute</tt> must be a string with attribute name.
<tt>min</tt> and <tt>max</tt> must be integers that define the acceptable
attribute values range (including the boundaries). <tt>exclude</tt> must be
a boolean value; it controls whether to accept the matching documents
(default mode, when <tt>exclude</tt> is false) or reject them.
</p>
<p>
Only those documents where <tt>attribute</tt> column value stored in the
index is between <tt>min</tt> and <tt>max</tt> (including values that are
exactly equal to <tt>min</tt> or <tt>max</tt>) will be matched (or
rejected, if <tt>exclude</tt> is true).
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetFilterRange constant id'>SetFilterRange</span><span class='lparen token'>(</span><span class='symbol val'>:group_id</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='comma token'>,</span> <span class='integer val'>20</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetFilterRange constant id'>SetFilterRange</span><span class='lparen token'>(</span><span class='symbol val'>:group_id</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='comma token'>,</span> <span class='integer val'>20</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
        <span class='name'>attribute</span>
      
      
      
        &mdash;
        
an attribute name to filter by.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>min</span>
      
      
      
        &mdash;
        
min value of the given attribute.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>max</span>
      
      
      
        &mdash;
        
max value of the given attribute.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <span class='name'>exclude</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        
indicating whether documents with given attribute matching specified
boundaries should be excluded from search results.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setfilterrange" title="Section 6.4.3, \"SetFilterRange\"">Section 6.4.3, "SetFilterRange"</a></li>
    
      <li><a href="#SetFilter-instance_method" title="#SetFilter">#SetFilter</a></li>
    
      <li><a href="#SetFilterFloatRange-instance_method" title="#SetFilterFloatRange">#SetFilterFloatRange</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1063
1064
1065
1066
1067
1068
1069
1070
1071</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1063</span>

<span class='def def kw'>def</span> <span class='SetFilterRange constant id'>SetFilterRange</span><span class='lparen token'>(</span><span class='attribute identifier id'>attribute</span><span class='comma token'>,</span> <span class='min identifier id'>min</span><span class='comma token'>,</span> <span class='max identifier id'>max</span><span class='comma token'>,</span> <span class='exclude identifier id'>exclude</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;attribute&quot; argument must be String or Symbol'</span> <span class='unless unless_mod kw'>unless</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;min&quot; argument must be Integer'</span>                <span class='unless unless_mod kw'>unless</span> <span class='min identifier id'>min</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='min identifier id'>min</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;max&quot; argument must be Integer'</span>                <span class='unless unless_mod kw'>unless</span> <span class='max identifier id'>max</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='max identifier id'>max</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;max&quot; argument greater or equal to &quot;min&quot;'</span>      <span class='unless unless_mod kw'>unless</span> <span class='min identifier id'>min</span> <span class='leq op'>&lt;=</span> <span class='max identifier id'>max</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;exclude&quot; argument must be Boolean'</span>            <span class='unless unless_mod kw'>unless</span> <span class='exclude identifier id'>exclude</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='TrueClass constant id'>TrueClass</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='exclude identifier id'>exclude</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='FalseClass constant id'>FalseClass</span><span class='rparen token'>)</span>

  <span class='@filters ivar id'>@filters</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrace token'>{</span> <span class='string val'>'type'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='SPH_FILTER_RANGE constant id'>SPH_FILTER_RANGE</span><span class='comma token'>,</span> <span class='string val'>'attr'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='string val'>'exclude'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='exclude identifier id'>exclude</span><span class='comma token'>,</span> <span class='string val'>'min'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='min identifier id'>min</span><span class='comma token'>,</span> <span class='string val'>'max'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='max identifier id'>max</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetGeoAnchor-instance_method">
  
    - (<tt>Object</tt>) <strong>SetGeoAnchor</strong>(attrlat, attrlong, lat, long) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets anchor point for and geosphere distance (geodistance) calculations,
and enable them.
</p>
<p>
<tt>attrlat</tt> and <tt>attrlong</tt> must be strings that contain the
names of latitude and longitude attributes, respectively. <tt>lat</tt> and
<tt>long</tt> are floats that specify anchor point latitude and longitude,
in radians.
</p>
<p>
Once an anchor point is set, you can use magic
<tt>&quot;@geodist&quot;</tt> attribute name in your filters and/or sorting
expressions. Sphinx will compute geosphere distance between the given
anchor point and a point specified by latitude and lognitude attributes
from each full-text match, and attach this value to the resulting match.
The latitude and longitude values both in <tt><a href="#SetGeoAnchor-instance_method" title="#SetGeoAnchor">#SetGeoAnchor</a></tt> and the index
attribute data are expected to be in radians. The result will be returned
in meters, so geodistance value of 1000.0 means 1 km. 1 mile is
approximately 1609.344 meters.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetGeoAnchor constant id'>SetGeoAnchor</span><span class='lparen token'>(</span><span class='symbol val'>:latitude</span><span class='comma token'>,</span> <span class='symbol val'>:longitude</span><span class='comma token'>,</span> <span class='float val'>192.5</span><span class='comma token'>,</span> <span class='float val'>143.5</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
        <span class='name'>attrlat</span>
      
      
      
        &mdash;
        
a name of latitude attribute.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
        <span class='name'>attrlong</span>
      
      
      
        &mdash;
        
a name of longitude attribute.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>, <tt>Float</tt>)</span>
      
      
        <span class='name'>lat</span>
      
      
      
        &mdash;
        
an anchor point latitude, in radians.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>, <tt>Float</tt>)</span>
      
      
        <span class='name'>long</span>
      
      
      
        &mdash;
        
an anchor point longitude, in radians.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setgeoanchor" title="Section 6.4.5, \"SetGeoAnchor\"">Section 6.4.5, "SetGeoAnchor"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1143
1144
1145
1146
1147
1148
1149
1150</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1143</span>

<span class='def def kw'>def</span> <span class='SetGeoAnchor constant id'>SetGeoAnchor</span><span class='lparen token'>(</span><span class='attrlat identifier id'>attrlat</span><span class='comma token'>,</span> <span class='attrlong identifier id'>attrlong</span><span class='comma token'>,</span> <span class='lat identifier id'>lat</span><span class='comma token'>,</span> <span class='long identifier id'>long</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;attrlat&quot; argument must be String or Symbol'</span>  <span class='unless unless_mod kw'>unless</span> <span class='attrlat identifier id'>attrlat</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>  <span class='or or kw'>or</span> <span class='attrlat identifier id'>attrlat</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;attrlong&quot; argument must be String or Symbol'</span> <span class='unless unless_mod kw'>unless</span> <span class='attrlong identifier id'>attrlong</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='attrlong identifier id'>attrlong</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;lat&quot; argument must be Float or Integer'</span>      <span class='unless unless_mod kw'>unless</span> <span class='lat identifier id'>lat</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='rparen token'>)</span>  <span class='or or kw'>or</span> <span class='lparen token'>(</span><span class='lat identifier id'>lat</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span>  <span class='and and kw'>and</span> <span class='lat identifier id'>lat</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;long&quot; argument must be Float or Integer'</span>     <span class='unless unless_mod kw'>unless</span> <span class='long identifier id'>long</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='lparen token'>(</span><span class='long identifier id'>long</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='long identifier id'>long</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span><span class='rparen token'>)</span>

  <span class='@anchor ivar id'>@anchor</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='string val'>'attrlat'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='attrlat identifier id'>attrlat</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='string val'>'attrlong'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='attrlong identifier id'>attrlong</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='string val'>'lat'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lat identifier id'>lat</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='comma token'>,</span> <span class='string val'>'long'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='long identifier id'>long</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetGroupBy-instance_method">
  
    - (<tt>Object</tt>) <strong>SetGroupBy</strong>(attribute, func, groupsort = '@group desc') 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets grouping attribute, function, and groups sorting mode; and enables
grouping (as described in Section 4.6, &quot;Grouping (clustering) search
results&quot;).
</p>
<p>
<tt>attribute</tt> is a string that contains group-by attribute name.
<tt>func</tt> is a constant that chooses a function applied to the
attribute value in order to compute group-by key. <tt>groupsort</tt> is a
clause that controls how the groups will be sorted. Its syntax is similar
to that described in Section 4.5, &quot;SPH_SORT_EXTENDED mode&quot;.
</p>
<p>
Grouping feature is very similar in nature to <tt>GROUP BY</tt> clause from
SQL. Results produces by this function call are going to be the same as
produced by the following pseudo code:
</p>
<pre class="code">
  <span class='SELECT constant id'>SELECT</span> <span class='dot3 op'>...</span> <span class='GROUP constant id'>GROUP</span> <span class='BY constant id'>BY</span> <span class='func identifier id'>func</span><span class='lparen token'>(</span><span class='attribute identifier id'>attribute</span><span class='rparen token'>)</span> <span class='ORDER constant id'>ORDER</span> <span class='BY constant id'>BY</span> <span class='groupsort identifier id'>groupsort</span>
</pre>
<p>
Note that it&#8217;s <tt>groupsort</tt> that affects the order of matches
in the final result set. Sorting mode (see <tt><a href="#SetSortMode-instance_method" title="#SetSortMode">#SetSortMode</a></tt>) affect the
ordering of matches within group, ie. what match will be selected as the
best one from the group. So you can for instance order the groups by
matches count and select the most relevant match within each group at the
same time.
</p>
<p>
Starting with version 0.9.9-rc2, aggregate functions (<tt>AVG()</tt>,
<tt>MIN()</tt>, <tt>MAX()</tt>, <tt>SUM()</tt>) are supported through
<tt><a href="#SetSelect-instance_method" title="#SetSelect">#SetSelect</a></tt> API call when using <tt>GROUP BY</tt>.
</p>
<p>
You can specify group function and attribute as String (&quot;attr&quot;,
&quot;day&quot;, etc), Symbol (:attr, :day, etc), or Fixnum constant
(SPH_GROUPBY_ATTR, SPH_GROUPBY_DAY, etc).
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetGroupBy constant id'>SetGroupBy</span><span class='lparen token'>(</span><span class='symbol val'>:tag_id</span><span class='comma token'>,</span> <span class='symbol val'>:attr</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
        <span class='name'>attribute</span>
      
      
      
        &mdash;
        
an attribute name to group by.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>, <tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
        <span class='name'>func</span>
      
      
      
        &mdash;
        
a grouping function.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>groupsort</span>
      
      
        <em class="default">(defaults to: <tt>'@group desc'</tt>)</em>
      
      
        &mdash;
        
a groups sorting mode.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#clustering" title="Section 4.6, \"Grouping (clustering) search results\"">Section 4.6, "Grouping (clustering) search results"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#sort-extended" title="Section 4.5, \"SPH_SORT_EXTENDED mode\"">Section 4.5, "SPH_SORT_EXTENDED mode"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setgroupby" title="Section 6.5.1, \"SetGroupBy\"">Section 6.5.1, "SetGroupBy"</a></li>
    
      <li><a href="#SetSortMode-instance_method" title="#SetSortMode">#SetSortMode</a></li>
    
      <li><a href="#SetSelect-instance_method" title="#SetSelect">#SetSelect</a></li>
    
      <li><a href="#SetGroupDistinct-instance_method" title="#SetGroupDistinct">#SetGroupDistinct</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1203
1204
1205
1206
1207
1208
1209
1210
1211
1212
1213
1214
1215
1216
1217
1218
1219
1220
1221
1222
1223</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1203</span>

<span class='def def kw'>def</span> <span class='SetGroupBy constant id'>SetGroupBy</span><span class='lparen token'>(</span><span class='attribute identifier id'>attribute</span><span class='comma token'>,</span> <span class='func identifier id'>func</span><span class='comma token'>,</span> <span class='groupsort identifier id'>groupsort</span> <span class='assign token'>=</span> <span class='string val'>'@group desc'</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;attribute&quot; argument must be String or Symbol'</span> <span class='unless unless_mod kw'>unless</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>  <span class='or or kw'>or</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;groupsort&quot; argument must be String'</span>           <span class='unless unless_mod kw'>unless</span> <span class='groupsort identifier id'>groupsort</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>

  <span class='case case kw'>case</span> <span class='func identifier id'>func</span>
    <span class='when when kw'>when</span> <span class='String constant id'>String</span><span class='comma token'>,</span> <span class='Symbol constant id'>Symbol</span>
      <span class='begin begin kw'>begin</span>
        <span class='func identifier id'>func</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='const_get identifier id'>const_get</span><span class='lparen token'>(</span><span class='dstring node'>&quot;SPH_GROUPBY_#{func.to_s.upcase}&quot;</span><span class='rparen token'>)</span>
      <span class='rescue rescue kw'>rescue</span> <span class='NameError constant id'>NameError</span>
        <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;\&quot;func\&quot; argument value \&quot;#{func}\&quot; is invalid&quot;</span>
      <span class='end end kw'>end</span>
    <span class='when when kw'>when</span> <span class='Fixnum constant id'>Fixnum</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;\&quot;func\&quot; argument value \&quot;#{func}\&quot; is invalid&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='SPH_GROUPBY_DAY constant id'>SPH_GROUPBY_DAY</span><span class='dot2 op'>..</span><span class='SPH_GROUPBY_ATTRPAIR constant id'>SPH_GROUPBY_ATTRPAIR</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='func identifier id'>func</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;func&quot; argument must be Fixnum, String, or Symbol'</span>
  <span class='end end kw'>end</span>

  <span class='@groupby ivar id'>@groupby</span> <span class='assign token'>=</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='@groupfunc ivar id'>@groupfunc</span> <span class='assign token'>=</span> <span class='func identifier id'>func</span>
  <span class='@groupsort ivar id'>@groupsort</span> <span class='assign token'>=</span> <span class='groupsort identifier id'>groupsort</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetGroupDistinct-instance_method">
  
    - (<tt>Object</tt>) <strong>SetGroupDistinct</strong>(attribute) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets attribute name for per-group distinct values count calculations. Only
available for grouping queries.
</p>
<p>
<tt>attribute</tt> is a string that contains the attribute name. For each
group, all values of this attribute will be stored (as RAM limits permit),
then the amount of distinct values will be calculated and returned to the
client. This feature is similar to <tt>COUNT(DISTINCT)</tt> clause in
standard SQL; so these Sphinx calls:
</p>
<pre class="code">
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetGroupBy constant id'>SetGroupBy</span><span class='lparen token'>(</span><span class='symbol val'>:category</span><span class='comma token'>,</span> <span class='symbol val'>:attr</span><span class='comma token'>,</span> <span class='string val'>'@count desc'</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetGroupDistinct constant id'>SetGroupDistinct</span><span class='lparen token'>(</span><span class='symbol val'>:vendor</span><span class='rparen token'>)</span>
</pre>
<p>
can be expressed using the following SQL clauses:
</p>
<pre class="code">
  <span class='SELECT constant id'>SELECT</span> <span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='weight identifier id'>weight</span><span class='comma token'>,</span> <span class='all identifier id'>all</span><span class='minus op'>-</span><span class='attributes identifier id'>attributes</span><span class='comma token'>,</span>
    <span class='COUNT constant id'>COUNT</span><span class='lparen token'>(</span><span class='DISTINCT constant id'>DISTINCT</span> <span class='vendor identifier id'>vendor</span><span class='rparen token'>)</span> <span class='AS constant id'>AS</span> <span class='@distinct ivar id'>@distinct</span><span class='comma token'>,</span>
    <span class='COUNT constant id'>COUNT</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='rparen token'>)</span> <span class='AS constant id'>AS</span> <span class='@count ivar id'>@count</span>
  <span class='FROM constant id'>FROM</span> <span class='products identifier id'>products</span>
  <span class='GROUP constant id'>GROUP</span> <span class='BY constant id'>BY</span> <span class='category identifier id'>category</span>
  <span class='ORDER constant id'>ORDER</span> <span class='BY constant id'>BY</span> <span class='@count ivar id'>@count</span> <span class='DESC constant id'>DESC</span>
</pre>
<p>
In the sample pseudo code shown just above, <tt><a href="#SetGroupDistinct-instance_method" title="#SetGroupDistinct">#SetGroupDistinct</a></tt> call
corresponds to <tt>COUNT(DISINCT vendor)</tt> clause only. <tt>GROUP
BY</tt>, <tt>ORDER BY</tt>, and <tt>COUNT(*)</tt> clauses are all an
equivalent of <tt><a href="#SetGroupBy-instance_method" title="#SetGroupBy">#SetGroupBy</a></tt> settings. Both queries will return one matching
row for each category. In addition to indexed attributes, matches will also
contain total per-category matches count, and the count of distinct vendor
IDs within each category.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetGroupDistinct constant id'>SetGroupDistinct</span><span class='lparen token'>(</span><span class='symbol val'>:category_id</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
        <span class='name'>attribute</span>
      
      
      
        &mdash;
        
an attribute name.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setgroupdistinct" title="Section 6.5.2, \"SetGroupDistinct\"">Section 6.5.2, "SetGroupDistinct"</a></li>
    
      <li><a href="#SetGroupBy-instance_method" title="#SetGroupBy">#SetGroupBy</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1266
1267
1268
1269
1270</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1266</span>

<span class='def def kw'>def</span> <span class='SetGroupDistinct constant id'>SetGroupDistinct</span><span class='lparen token'>(</span><span class='attribute identifier id'>attribute</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;attribute&quot; argument must be String or Symbol'</span> <span class='unless unless_mod kw'>unless</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>  <span class='or or kw'>or</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>

  <span class='@groupdistinct ivar id'>@groupdistinct</span> <span class='assign token'>=</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetIDRange-instance_method">
  
    - (<tt>Object</tt>) <strong>SetIDRange</strong>(min, max) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets an accepted range of document IDs. Parameters must be integers.
Defaults are 0 and 0; that combination means to not limit by range.
</p>
<p>
After this call, only those records that have document ID between
<tt>min</tt> and <tt>max</tt> (including IDs exactly equal to <tt>min</tt>
or <tt>max</tt>) will be matched.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetIDRange constant id'>SetIDRange</span><span class='lparen token'>(</span><span class='integer val'>10</span><span class='comma token'>,</span> <span class='integer val'>1000</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>min</span>
      
      
      
        &mdash;
        
min document ID.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>min</span>
      
      
      
        &mdash;
        
max document ID.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setidrange" title="Section 6.4.1, \"SetIDRange\"">Section 6.4.1, "SetIDRange"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


982
983
984
985
986
987
988
989</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 982</span>

<span class='def def kw'>def</span> <span class='SetIDRange constant id'>SetIDRange</span><span class='lparen token'>(</span><span class='min identifier id'>min</span><span class='comma token'>,</span> <span class='max identifier id'>max</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;min&quot; argument must be Integer'</span> <span class='unless unless_mod kw'>unless</span> <span class='min identifier id'>min</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='min identifier id'>min</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;max&quot; argument must be Integer'</span> <span class='unless unless_mod kw'>unless</span> <span class='max identifier id'>max</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='max identifier id'>max</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;max&quot; argument greater or equal to &quot;min&quot;'</span> <span class='unless unless_mod kw'>unless</span> <span class='min identifier id'>min</span> <span class='leq op'>&lt;=</span> <span class='max identifier id'>max</span>

  <span class='@min_id ivar id'>@min_id</span> <span class='assign token'>=</span> <span class='min identifier id'>min</span>
  <span class='@max_id ivar id'>@max_id</span> <span class='assign token'>=</span> <span class='max identifier id'>max</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetIndexWeights-instance_method">
  
    - (<tt>Object</tt>) <strong>SetIndexWeights</strong>(weights) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets per-index weights, and enables weighted summing of match weights
across different indexes. Parameter must be a hash (associative array)
mapping string index names to integer weights. Default is empty array that
means to disable weighting summing.
</p>
<p>
When a match with the same document ID is found in several different local
indexes, by default Sphinx simply chooses the match from the index
specified last in the query. This is to support searching through partially
overlapping index partitions.
</p>
<p>
However in some cases the indexes are not just partitions, and you might
want to sum the weights across the indexes instead of picking one.
<tt><a href="#SetIndexWeights-instance_method" title="#SetIndexWeights">#SetIndexWeights</a></tt> lets you do that. With summing enabled, final match
weight in result set will be computed as a sum of match weight coming from
the given index multiplied by respective per-index weight specified in this
call. Ie. if the document 123 is found in index A with the weight of 2, and
also in index B with the weight of 3, and you called <tt><a href="#SetIndexWeights-instance_method" title="#SetIndexWeights">#SetIndexWeights</a></tt>
with <tt>{&quot;A&quot;=&gt;100, &quot;B&quot;=&gt;10}</tt>, the final
weight return to the client will be 2*100+3*10 = 230.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetFieldWeights constant id'>SetFieldWeights</span><span class='lparen token'>(</span><span class='symbol val'>:fresh</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>20</span><span class='comma token'>,</span> <span class='symbol val'>:archived</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>10</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>weights</span>
      
      
      
        &mdash;
        
a <tt>Hash</tt> mapping string index names to integer weights.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setindexweights" title="Section 6.3.6, \"SetIndexWeights\"">Section 6.3.6, "SetIndexWeights"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


950
951
952
953
954
955
956
957
958
959</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 950</span>

<span class='def def kw'>def</span> <span class='SetIndexWeights constant id'>SetIndexWeights</span><span class='lparen token'>(</span><span class='weights identifier id'>weights</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;weights&quot; argument must be Hash'</span> <span class='unless unless_mod kw'>unless</span> <span class='weights identifier id'>weights</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span>
  <span class='weights identifier id'>weights</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='index identifier id'>index</span><span class='comma token'>,</span> <span class='weight identifier id'>weight</span><span class='bitor op'>|</span>
    <span class='unless unless kw'>unless</span> <span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='lparen token'>(</span><span class='weight identifier id'>weight</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='weight identifier id'>weight</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span><span class='rparen token'>)</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;weights&quot; argument must be Hash map of strings to integers'</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='@indexweights ivar id'>@indexweights</span> <span class='assign token'>=</span> <span class='weights identifier id'>weights</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetLimits-instance_method">
  
    - (<tt>Object</tt>) <strong>SetLimits</strong>(offset, limit, max = 0, cutoff = 0) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets offset into server-side result set (<tt>offset</tt>) and amount of
matches to return to client starting from that offset (<tt>limit</tt>). Can
additionally control maximum server-side result set size for current query
(<tt>max_matches</tt>) and the threshold amount of matches to stop
searching at (<tt>cutoff</tt>). All parameters must be non-negative
integers.
</p>
<p>
First two parameters to <tt>SetLimits</tt> are identical in behavior to
MySQL LIMIT clause. They instruct searchd to return at most <tt>limit</tt>
matches starting from match number <tt>offset</tt>. The default offset and
limit settings are <tt>0</tt> and <tt>20</tt>, that is, to return first
<tt>20</tt> matches.
</p>
<p>
<tt>max_matches</tt> setting controls how much matches searchd will keep in
RAM while searching. All matching documents will be normally processed,
ranked, filtered, and sorted even if max_matches is set to <tt>1</tt>. But
only best <tt>N</tt> documents are stored in memory at any given moment for
performance and RAM usage reasons, and this setting controls that N. Note
that there are two places where max_matches limit is enforced. Per-query
limit is controlled by this API call, but there also is per-server limit
controlled by <tt>max_matches</tt> setting in the config file. To prevent
RAM usage abuse, server will not allow to set per-query limit higher than
the per-server limit.
</p>
<p>
You can&#8217;t retrieve more than <tt>max_matches</tt> matches to the
client application. The default limit is set to <tt>1000</tt>. Normally,
you must not have to go over this limit. One thousand records is enough to
present to the end user. And if you&#8217;re thinking about pulling the
results to application for further sorting or filtering, that would be much
more efficient if performed on Sphinx side.
</p>
<p>
<tt>cutoff</tt> setting is intended for advanced performance control. It
tells searchd to forcibly stop search query once $cutoff matches had been
found and processed.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetLimits constant id'>SetLimits</span><span class='lparen token'>(</span><span class='integer val'>100</span><span class='comma token'>,</span> <span class='integer val'>50</span><span class='comma token'>,</span> <span class='integer val'>1000</span><span class='comma token'>,</span> <span class='integer val'>5000</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>offset</span>
      
      
      
        &mdash;
        
an offset into server-side result set.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>limit</span>
      
      
      
        &mdash;
        
an amount of matches to return.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>max</span>
      
      
        <em class="default">(defaults to: <tt>0</tt>)</em>
      
      
        &mdash;
        
a maximum server-side result set size.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>cutoff</span>
      
      
        <em class="default">(defaults to: <tt>0</tt>)</em>
      
      
        &mdash;
        
a threshold amount of matches to stop searching at.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 584</span>

<span class='def def kw'>def</span> <span class='SetLimits constant id'>SetLimits</span><span class='lparen token'>(</span><span class='offset identifier id'>offset</span><span class='comma token'>,</span> <span class='limit identifier id'>limit</span><span class='comma token'>,</span> <span class='max identifier id'>max</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='cutoff identifier id'>cutoff</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;offset&quot; argument must be Integer'</span> <span class='unless unless_mod kw'>unless</span> <span class='offset identifier id'>offset</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='offset identifier id'>offset</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;limit&quot; argument must be Integer'</span>  <span class='unless unless_mod kw'>unless</span> <span class='limit identifier id'>limit</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span>  <span class='and and kw'>and</span> <span class='limit identifier id'>limit</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;max&quot; argument must be Integer'</span>    <span class='unless unless_mod kw'>unless</span> <span class='max identifier id'>max</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span>    <span class='and and kw'>and</span> <span class='max identifier id'>max</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;cutoff&quot; argument must be Integer'</span> <span class='unless unless_mod kw'>unless</span> <span class='cutoff identifier id'>cutoff</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='cutoff identifier id'>cutoff</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>

  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;offset&quot; argument should be greater or equal to zero'</span> <span class='unless unless_mod kw'>unless</span> <span class='offset identifier id'>offset</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;limit&quot; argument should be greater to zero'</span>           <span class='unless unless_mod kw'>unless</span> <span class='limit identifier id'>limit</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;max&quot; argument should be greater or equal to zero'</span>    <span class='unless unless_mod kw'>unless</span> <span class='max identifier id'>max</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;cutoff&quot; argument should be greater or equal to zero'</span> <span class='unless unless_mod kw'>unless</span> <span class='cutoff identifier id'>cutoff</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>

  <span class='@offset ivar id'>@offset</span> <span class='assign token'>=</span> <span class='offset identifier id'>offset</span>
  <span class='@limit ivar id'>@limit</span> <span class='assign token'>=</span> <span class='limit identifier id'>limit</span>
  <span class='@maxmatches ivar id'>@maxmatches</span> <span class='assign token'>=</span> <span class='max identifier id'>max</span> <span class='if if_mod kw'>if</span> <span class='max identifier id'>max</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
  <span class='@cutoff ivar id'>@cutoff</span> <span class='assign token'>=</span> <span class='cutoff identifier id'>cutoff</span> <span class='if if_mod kw'>if</span> <span class='cutoff identifier id'>cutoff</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetMatchMode-instance_method">
  
    - (<tt>Object</tt>) <strong>SetMatchMode</strong>(mode) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets full-text query matching mode.
</p>
<p>
Parameter must be a <tt>Fixnum</tt> constant specifying one of the known
modes (<tt>SPH_MATCH_ALL</tt>, <tt>SPH_MATCH_ANY</tt>, etc),
<tt>String</tt> with identifier (<tt>&quot;all&quot;</tt>,
<tt>&quot;any&quot;</tt>, etc), or a <tt>Symbol</tt> (<tt>:all</tt>,
<tt>:any</tt>, etc).
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetMatchMode constant id'>SetMatchMode</span><span class='lparen token'>(</span><span class='Sphinx constant id'>Sphinx</span><span class='colon2 op'>::</span><span class='Client constant id'>Client</span><span class='colon2 op'>::</span><span class='SPH_MATCH_ALL constant id'>SPH_MATCH_ALL</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetMatchMode constant id'>SetMatchMode</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetMatchMode constant id'>SetMatchMode</span><span class='lparen token'>(</span><span class='string val'>'all'</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>, <tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
        <span class='name'>mode</span>
      
      
      
        &mdash;
        
full-text query matching mode.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#matching-modes" title="Section 4.1, \"Matching modes\"">Section 4.1, "Matching modes"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setmatchmode" title="Section 6.3.1, \"SetMatchMode\"">Section 6.3.1, "SetMatchMode"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 756</span>

<span class='def def kw'>def</span> <span class='SetMatchMode constant id'>SetMatchMode</span><span class='lparen token'>(</span><span class='mode identifier id'>mode</span><span class='rparen token'>)</span>
  <span class='case case kw'>case</span> <span class='mode identifier id'>mode</span>
    <span class='when when kw'>when</span> <span class='String constant id'>String</span><span class='comma token'>,</span> <span class='Symbol constant id'>Symbol</span>
      <span class='begin begin kw'>begin</span>
        <span class='mode identifier id'>mode</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='const_get identifier id'>const_get</span><span class='lparen token'>(</span><span class='dstring node'>&quot;SPH_MATCH_#{mode.to_s.upcase}&quot;</span><span class='rparen token'>)</span>
      <span class='rescue rescue kw'>rescue</span> <span class='NameError constant id'>NameError</span>
        <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;\&quot;mode\&quot; argument value \&quot;#{mode}\&quot; is invalid&quot;</span>
      <span class='end end kw'>end</span>
    <span class='when when kw'>when</span> <span class='Fixnum constant id'>Fixnum</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;\&quot;mode\&quot; argument value \&quot;#{mode}\&quot; is invalid&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='SPH_MATCH_ALL constant id'>SPH_MATCH_ALL</span><span class='dot2 op'>..</span><span class='SPH_MATCH_EXTENDED2 constant id'>SPH_MATCH_EXTENDED2</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='mode identifier id'>mode</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;mode&quot; argument must be Fixnum, String, or Symbol'</span>
  <span class='end end kw'>end</span>

  <span class='@mode ivar id'>@mode</span> <span class='assign token'>=</span> <span class='mode identifier id'>mode</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetMaxQueryTime-instance_method">
  
    - (<tt>Object</tt>) <strong>SetMaxQueryTime</strong>(max) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets maximum search query time, in milliseconds. Parameter must be a
non-negative integer. Default valus is <tt>0</tt> which means &quot;do not
limit&quot;.
</p>
<p>
Similar to <tt>cutoff</tt> setting from <tt>SetLimits</tt>, but limits
elapsed query time instead of processed matches count. Local search queries
will be stopped once that much time has elapsed. Note that if you&#8217;re
performing a search which queries several local indexes, this limit applies
to each index separately.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetMaxQueryTime constant id'>SetMaxQueryTime</span><span class='lparen token'>(</span><span class='integer val'>200</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>max</span>
      
      
      
        &mdash;
        
maximum search query time in milliseconds.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


617
618
619
620
621
622</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 617</span>

<span class='def def kw'>def</span> <span class='SetMaxQueryTime constant id'>SetMaxQueryTime</span><span class='lparen token'>(</span><span class='max identifier id'>max</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;max&quot; argument must be Integer'</span> <span class='unless unless_mod kw'>unless</span> <span class='max identifier id'>max</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='max identifier id'>max</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;max&quot; argument should be greater or equal to zero'</span> <span class='unless unless_mod kw'>unless</span> <span class='max identifier id'>max</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>

  <span class='@maxquerytime ivar id'>@maxquerytime</span> <span class='assign token'>=</span> <span class='max identifier id'>max</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetOverride-instance_method">
  
    - (<tt>Object</tt>) <strong>SetOverride</strong>(attribute, attrtype, values) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets temporary (per-query) per-document attribute value overrides. Only
supports scalar attributes. <tt>values</tt> must be a <tt>Hash</tt> that
maps document IDs to overridden attribute values.
</p>
<p>
Override feature lets you &quot;temporary&quot; update attribute values for
some documents within a single query, leaving all other queries unaffected.
This might be useful for personalized data. For example, assume
you&#8217;re implementing a personalized search function that wants to
boost the posts that the user&#8217;s friends recommend. Such data is not
just dynamic, but also personal; so you can&#8217;t simply put it in the
index because you don&#8217;t want everyone&#8217;s searches affected.
Overrides, on the other hand, are local to a single query and invisible to
everyone else. So you can, say, setup a &quot;friends_weight&quot; value
for every document, defaulting to 0, then temporary override it with 1 for
documents 123, 456 and 789 (recommended by exactly the friends of current
user), and use that value when ranking.
</p>
<p>
You can specify attribute type as String (&quot;integer&quot;,
&quot;float&quot;, etc), Symbol (:integer, :float, etc), or Fixnum constant
(SPH_ATTR_INTEGER, SPH_ATTR_FLOAT, etc).
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetOverride constant id'>SetOverride</span><span class='lparen token'>(</span><span class='symbol val'>:friends_weight</span><span class='comma token'>,</span> <span class='symbol val'>:integer</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='integer val'>123</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='integer val'>456</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='integer val'>789</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
        <span class='name'>attribute</span>
      
      
      
        &mdash;
        
an attribute name to override values of.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>, <tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
        <span class='name'>attrtype</span>
      
      
      
        &mdash;
        
attribute type.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>values</span>
      
      
      
        &mdash;
        
a <tt>Hash</tt> that maps document IDs to overridden attribute values.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setoverride" title="Section 6.2.3, \"SetOverride\"">Section 6.2.3, "SetOverride"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 655</span>

<span class='def def kw'>def</span> <span class='SetOverride constant id'>SetOverride</span><span class='lparen token'>(</span><span class='attribute identifier id'>attribute</span><span class='comma token'>,</span> <span class='attrtype identifier id'>attrtype</span><span class='comma token'>,</span> <span class='values identifier id'>values</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;attribute&quot; argument must be String or Symbol'</span> <span class='unless unless_mod kw'>unless</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>

  <span class='case case kw'>case</span> <span class='attrtype identifier id'>attrtype</span>
    <span class='when when kw'>when</span> <span class='String constant id'>String</span><span class='comma token'>,</span> <span class='Symbol constant id'>Symbol</span>
      <span class='begin begin kw'>begin</span>
        <span class='attrtype identifier id'>attrtype</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='const_get identifier id'>const_get</span><span class='lparen token'>(</span><span class='dstring node'>&quot;SPH_ATTR_#{attrtype.to_s.upcase}&quot;</span><span class='rparen token'>)</span>
      <span class='rescue rescue kw'>rescue</span> <span class='NameError constant id'>NameError</span>
        <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;\&quot;attrtype\&quot; argument value \&quot;#{attrtype}\&quot; is invalid&quot;</span>
      <span class='end end kw'>end</span>
    <span class='when when kw'>when</span> <span class='Fixnum constant id'>Fixnum</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;\&quot;attrtype\&quot; argument value \&quot;#{attrtype}\&quot; is invalid&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='SPH_ATTR_INTEGER constant id'>SPH_ATTR_INTEGER</span><span class='dot2 op'>..</span><span class='SPH_ATTR_BIGINT constant id'>SPH_ATTR_BIGINT</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='attrtype identifier id'>attrtype</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;attrtype&quot; argument must be Fixnum, String, or Symbol'</span>
  <span class='end end kw'>end</span>

  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash'</span> <span class='unless unless_mod kw'>unless</span> <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span>

  <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash map of Integer to Integer or Time'</span> <span class='unless unless_mod kw'>unless</span> <span class='id identifier id'>id</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='id identifier id'>id</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
    <span class='case case kw'>case</span> <span class='attrtype identifier id'>attrtype</span>
      <span class='when when kw'>when</span> <span class='SPH_ATTR_TIMESTAMP constant id'>SPH_ATTR_TIMESTAMP</span>
        <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash map of Integer to Integer or Time'</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Time constant id'>Time</span><span class='rparen token'>)</span>
      <span class='when when kw'>when</span> <span class='SPH_ATTR_FLOAT constant id'>SPH_ATTR_FLOAT</span>
        <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash map of Integer to Float or Integer'</span> <span class='unless unless_mod kw'>unless</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span><span class='rparen token'>)</span>
      <span class='else else kw'>else</span>
        <span class='comment val'># SPH_ATTR_INTEGER, SPH_ATTR_ORDINAL, SPH_ATTR_BOOL, SPH_ATTR_BIGINT</span>
        <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash map of Integer to Integer'</span> <span class='unless unless_mod kw'>unless</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='@overrides ivar id'>@overrides</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrace token'>{</span> <span class='string val'>'attr'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='attribute identifier id'>attribute</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='string val'>'type'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='attrtype identifier id'>attrtype</span><span class='comma token'>,</span> <span class='string val'>'values'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='values identifier id'>values</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetRankingMode-instance_method">
  
    - (<tt>Object</tt>) <strong>SetRankingMode</strong>(ranker) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets ranking mode. Only available in <tt>SPH_MATCH_EXTENDED2</tt> matching
mode at the time of this writing. Parameter must be a constant specifying
one of the known modes.
</p>
<p>
You can specify ranking mode as String (&quot;proximity_bm25&quot;,
&quot;bm25&quot;, etc), Symbol (:proximity_bm25, :bm25, etc), or Fixnum
constant (SPH_RANK_PROXIMITY_BM25, SPH_RANK_BM25, etc).
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetRankingMode constant id'>SetRankingMode</span><span class='lparen token'>(</span><span class='Sphinx constant id'>Sphinx</span><span class='colon2 op'>::</span><span class='Client constant id'>Client</span><span class='colon2 op'>::</span><span class='SPH_RANK_BM25 constant id'>SPH_RANK_BM25</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetMatchMode constant id'>SetMatchMode</span><span class='lparen token'>(</span><span class='symbol val'>:bm25</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetMatchMode constant id'>SetMatchMode</span><span class='lparen token'>(</span><span class='string val'>'bm25'</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>, <tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
        <span class='name'>ranker</span>
      
      
      
        &mdash;
        
ranking mode.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#matching-modes" title="Section 4.1, \"Matching modes\"">Section 4.1, "Matching modes"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setmatchmode" title="Section 6.3.1, \"SetMatchMode\"">Section 6.3.1, "SetMatchMode"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setrankingmode" title="Section 6.3.2, \"SetRankingMode\"">Section 6.3.2, "SetRankingMode"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 794</span>

<span class='def def kw'>def</span> <span class='SetRankingMode constant id'>SetRankingMode</span><span class='lparen token'>(</span><span class='ranker identifier id'>ranker</span><span class='rparen token'>)</span>
  <span class='case case kw'>case</span> <span class='ranker identifier id'>ranker</span>
    <span class='when when kw'>when</span> <span class='String constant id'>String</span><span class='comma token'>,</span> <span class='Symbol constant id'>Symbol</span>
      <span class='begin begin kw'>begin</span>
        <span class='ranker identifier id'>ranker</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='const_get identifier id'>const_get</span><span class='lparen token'>(</span><span class='dstring node'>&quot;SPH_RANK_#{ranker.to_s.upcase}&quot;</span><span class='rparen token'>)</span>
      <span class='rescue rescue kw'>rescue</span> <span class='NameError constant id'>NameError</span>
        <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;\&quot;ranker\&quot; argument value \&quot;#{ranker}\&quot; is invalid&quot;</span>
      <span class='end end kw'>end</span>
    <span class='when when kw'>when</span> <span class='Fixnum constant id'>Fixnum</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;\&quot;ranker\&quot; argument value \&quot;#{ranker}\&quot; is invalid&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='SPH_RANK_PROXIMITY_BM25 constant id'>SPH_RANK_PROXIMITY_BM25</span><span class='dot2 op'>..</span><span class='SPH_RANK_SPH04 constant id'>SPH_RANK_SPH04</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='ranker identifier id'>ranker</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;ranker&quot; argument must be Fixnum, String, or Symbol'</span>
  <span class='end end kw'>end</span>

  <span class='@ranker ivar id'>@ranker</span> <span class='assign token'>=</span> <span class='ranker identifier id'>ranker</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetRequestTimeout-instance_method">
  
    - (<tt>Object</tt>) <strong>SetRequestTimeout</strong>(timeout, retries = 1) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets the time allowed to spend performing request to the server before
giving up and number of retries to perform.
</p>
<p>
In the event of a failure to do request, an appropriate error code should
be returned back to the application in order for application-level error
handling to advise the user.
</p>
<p>
When multiple servers configured through <tt>SetServers</tt> method, and
<tt>retries</tt> number is greater than 1, library will try to do another
try with this server (with full reconnect). If connection would fail,
behavior depends on <tt><a href="#SetConnectTimeout-instance_method" title="#SetConnectTimeout">#SetConnectTimeout</a></tt> settings.
</p>
<p>
Please note, this timeout will only be used for request performing, not for
connection establishing.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4>
Set request timeout to 1 second and number of retries to 5

</h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetRequestTimeout constant id'>SetRequestTimeout</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='integer val'>5</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>timeout</span>
      
      
      
        &mdash;
        
a request timeout in seconds.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>retries</span>
      
      
        <em class="default">(defaults to: <tt>1</tt>)</em>
      
      
        &mdash;
        
number of request retries.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="#SetServer-instance_method" title="#SetServer">#SetServer</a></li>
    
      <li><a href="#SetServers-instance_method" title="#SetServers">#SetServers</a></li>
    
      <li><a href="#SetConnectTimeout-instance_method" title="#SetConnectTimeout">#SetConnectTimeout</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


502
503
504
505
506
507
508
509</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 502</span>

<span class='def def kw'>def</span> <span class='SetRequestTimeout constant id'>SetRequestTimeout</span><span class='lparen token'>(</span><span class='timeout identifier id'>timeout</span><span class='comma token'>,</span> <span class='retries identifier id'>retries</span> <span class='assign token'>=</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;timeout&quot; argument must be Integer'</span>        <span class='unless unless_mod kw'>unless</span> <span class='timeout identifier id'>timeout</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='timeout identifier id'>timeout</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;retries&quot; argument must be Integer'</span>        <span class='unless unless_mod kw'>unless</span> <span class='retries identifier id'>retries</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='retries identifier id'>retries</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;retries&quot; argument must be greater than 0'</span> <span class='unless unless_mod kw'>unless</span> <span class='retries identifier id'>retries</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>

  <span class='@reqtimeout ivar id'>@reqtimeout</span> <span class='assign token'>=</span> <span class='timeout identifier id'>timeout</span>
  <span class='@reqretries ivar id'>@reqretries</span> <span class='assign token'>=</span> <span class='retries identifier id'>retries</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetRetries-instance_method">
  
    - (<tt>Object</tt>) <strong>SetRetries</strong>(count, delay = 0) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets distributed retry count and delay.
</p>
<p>
On temporary failures searchd will attempt up to <tt>count</tt> retries per
agent. <tt>delay</tt> is the delay between the retries, in milliseconds.
Retries are disabled by default. Note that this call will not make the API
itself retry on temporary failure; it only tells searchd to do so.
Currently, the list of temporary failures includes all kinds of connection
failures and maxed out (too busy) remote agents.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4>
Perform 5 retries with 200 ms between them

</h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetRetries constant id'>SetRetries</span><span class='lparen token'>(</span><span class='integer val'>5</span><span class='comma token'>,</span> <span class='integer val'>200</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>count</span>
      
      
      
        &mdash;
        
a number of retries to perform.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>delay</span>
      
      
        <em class="default">(defaults to: <tt>0</tt>)</em>
      
      
        &mdash;
        
a delay between the retries.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="#SetConnectTimeout-instance_method" title="#SetConnectTimeout">#SetConnectTimeout</a></li>
    
      <li><a href="#SetRequestTimeout-instance_method" title="#SetRequestTimeout">#SetRequestTimeout</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


530
531
532
533
534
535
536</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 530</span>

<span class='def def kw'>def</span> <span class='SetRetries constant id'>SetRetries</span><span class='lparen token'>(</span><span class='count identifier id'>count</span><span class='comma token'>,</span> <span class='delay identifier id'>delay</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;count&quot; argument must be Integer'</span> <span class='unless unless_mod kw'>unless</span> <span class='count identifier id'>count</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='count identifier id'>count</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;delay&quot; argument must be Integer'</span> <span class='unless unless_mod kw'>unless</span> <span class='delay identifier id'>delay</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='delay identifier id'>delay</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>

  <span class='@retrycount ivar id'>@retrycount</span> <span class='assign token'>=</span> <span class='count identifier id'>count</span>
  <span class='@retrydelay ivar id'>@retrydelay</span> <span class='assign token'>=</span> <span class='delay identifier id'>delay</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetSelect-instance_method">
  
    - (<tt>Object</tt>) <strong>SetSelect</strong>(select) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets the select clause, listing specific attributes to fetch, and
expressions to compute and fetch. Clause syntax mimics SQL.
</p>
<p>
<tt>SetSelect</tt> is very similar to the part of a typical SQL query
between <tt>SELECT</tt> and <tt>FROM</tt>. It lets you choose what
attributes (columns) to fetch, and also what expressions over the columns
to compute and fetch. A certain difference from SQL is that expressions
must always be aliased to a correct identifier (consisting of letters and
digits) using <tt>AS</tt> keyword. SQL also lets you do that but does not
require to. Sphinx enforces aliases so that the computation results can
always be returned under a &quot;normal&quot; name in the result set, used
in other clauses, etc.
</p>
<p>
Everything else is basically identical to SQL. Star (&#8217;*&#8217;) is
supported. Functions are supported. Arbitrary amount of expressions is
supported. Computed expressions can be used for sorting, filtering, and
grouping, just as the regular attributes.
</p>
<p>
Starting with version 0.9.9-rc2, aggregate functions (<tt>AVG()</tt>,
<tt>MIN()</tt>, <tt>MAX()</tt>, <tt>SUM()</tt>) are supported when using
<tt>GROUP BY</tt>.
</p>
<p>
Expression sorting (Section 4.5, SPH_SORT_EXPR mode) and geodistance
functions (<tt>SetGeoAnchor</tt>) are now internally implemented using this
computed expressions mechanism, using magic names
&#8216;<tt>@expr</tt>&#8217; and &#8216;<tt>@geodist</tt>&#8217;
respectively.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetSelect constant id'>SetSelect</span><span class='lparen token'>(</span><span class='string val'>'*, @weight+(user_karma+ln(pageviews))*0.1 AS myweight'</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetSelect constant id'>SetSelect</span><span class='lparen token'>(</span><span class='string val'>'exp_years, salary_gbp*{$gbp_usd_rate} AS salary_usd, IF(age&gt;40,1,0) AS over40'</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetSelect constant id'>SetSelect</span><span class='lparen token'>(</span><span class='string val'>'*, AVG(price) AS avgprice'</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>select</span>
      
      
      
        &mdash;
        
a select clause, listing specific attributes to fetch.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#sort-expr" title="Section 4.5, \"SPH_SORT_EXPR mode\"">Section 4.5, "SPH_SORT_EXPR mode"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setgeoanchor" title="Section 6.4.5, \"SetGeoAnchor\"">Section 6.4.5, "SetGeoAnchor"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setselect" title="Section 6.2.4, \"SetSelect\"">Section 6.2.4, "SetSelect"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


728
729
730
731
732</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 728</span>

<span class='def def kw'>def</span> <span class='SetSelect constant id'>SetSelect</span><span class='lparen token'>(</span><span class='select identifier id'>select</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;select&quot; argument must be String'</span> <span class='unless unless_mod kw'>unless</span> <span class='select identifier id'>select</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>

  <span class='@select ivar id'>@select</span> <span class='assign token'>=</span> <span class='select identifier id'>select</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetServer-instance_method">
  
    - (<tt><a href="Server.html" title="Sphinx::Server">Sphinx::Server</a></tt>) <strong>SetServer</strong>(host, port = 9312) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets searchd host name and TCP port. All subsequent requests will use the
new host and port settings. Default <tt>host</tt> and <tt>port</tt> are
&#8216;localhost&#8217; and 9312, respectively.
</p>
<p>
Also, you can specify an absolute path to Sphinx&#8217;s UNIX socket as
<tt>host</tt>, in this case pass port as <tt>0</tt> or <tt>nil</tt>.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetServer constant id'>SetServer</span><span class='lparen token'>(</span><span class='string val'>'localhost'</span><span class='comma token'>,</span> <span class='integer val'>9312</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetServer constant id'>SetServer</span><span class='lparen token'>(</span><span class='string val'>'/opt/sphinx/var/run/sphinx.sock'</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>host</span>
      
      
      
        &mdash;
        
the searchd host name or UNIX socket absolute path.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <span class='name'>port</span>
      
      
        <em class="default">(defaults to: <tt>9312</tt>)</em>
      
      
        &mdash;
        
the searchd port name (could be any if UNIX socket path specified).


      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt><a href="Server.html" title="Sphinx::Server">Sphinx::Server</a></tt>)</span>
      
      
      
      
        &mdash;
        
an instance of <tt>Sphinx::Server</tt> with given parameters.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="#SetServers-instance_method" title="#SetServers">#SetServers</a></li>
    
      <li><a href="#SetConnectTimeout-instance_method" title="#SetConnectTimeout">#SetConnectTimeout</a></li>
    
      <li><a href="#SetRequestTimeout-instance_method" title="#SetRequestTimeout">#SetRequestTimeout</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 366</span>

<span class='def def kw'>def</span> <span class='SetServer constant id'>SetServer</span><span class='lparen token'>(</span><span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span> <span class='assign token'>=</span> <span class='integer val'>9312</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;host&quot; argument must be String'</span> <span class='unless unless_mod kw'>unless</span> <span class='host identifier id'>host</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>

  <span class='path identifier id'>path</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='comment val'># Check if UNIX socket should be used</span>
  <span class='if if kw'>if</span> <span class='host identifier id'>host</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='integer val'>?/</span>
    <span class='path identifier id'>path</span> <span class='assign token'>=</span> <span class='host identifier id'>host</span>
  <span class='elsif elsif kw'>elsif</span> <span class='host identifier id'>host</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>7</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>'unix://'</span>
    <span class='path identifier id'>path</span> <span class='assign token'>=</span> <span class='host identifier id'>host</span><span class='lbrack token'>[</span><span class='float val'>7</span><span class='dot2 op'>..</span><span class='integer val'>-1</span><span class='rbrack token'>]</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;port&quot; argument must be Integer'</span> <span class='unless unless_mod kw'>unless</span> <span class='port identifier id'>port</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='port identifier id'>port</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
  <span class='end end kw'>end</span>

  <span class='host identifier id'>host</span> <span class='assign token'>=</span> <span class='port identifier id'>port</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span> <span class='unless unless_mod kw'>unless</span> <span class='path identifier id'>path</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>

  <span class='@servers ivar id'>@servers</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='Sphinx constant id'>Sphinx</span><span class='colon2 op'>::</span><span class='Server constant id'>Server</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='comma token'>,</span> <span class='path identifier id'>path</span><span class='rparen token'>)</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='freeze identifier id'>freeze</span>
  <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetServers-instance_method">
  
    - (<tt>Array&lt;<a href="Server.html" title="Sphinx::Server">Sphinx::Server</a>&gt;</tt>) <strong>SetServers</strong>(servers) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sets the list of searchd servers. Each subsequent request will use next
server in list (round-robin). In case of one server failure, request could
be retried on another server (see <tt><a href="#SetConnectTimeout-instance_method" title="#SetConnectTimeout">#SetConnectTimeout</a></tt> and
<tt><a href="#SetRequestTimeout-instance_method" title="#SetRequestTimeout">#SetRequestTimeout</a></tt>).
</p>
<p>
Method accepts an <tt>Array</tt> of <tt>Hash</tt>es, each of them should
have <tt>:host</tt> and <tt>:port</tt> (to connect to searchd through
network) or <tt>:path</tt> (an absolute path to UNIX socket) specified.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetServers constant id'>SetServers</span><span class='lparen token'>(</span><span class='lbrack token'>[</span>
    <span class='lbrace token'>{</span> <span class='symbol val'>:host</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'browse01.local'</span> <span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='comment val'># default port is 9312</span>
    <span class='lbrace token'>{</span> <span class='symbol val'>:host</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'browse02.local'</span><span class='comma token'>,</span> <span class='symbol val'>:port</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>9312</span> <span class='rbrace token'>}</span><span class='comma token'>,</span>
    <span class='lbrace token'>{</span> <span class='symbol val'>:path</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'/opt/sphinx/var/run/sphinx.sock'</span> <span class='rbrace token'>}</span>
  <span class='rbrack token'>]</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
        <span class='name'>servers</span>
      
      
      
        &mdash;
        
an <tt>Array</tt> of <tt>Hash</tt> objects with servers parameters.


      
    </li>
  
</ul>

  
    
    
    <h3>Options Hash (<tt>servers</tt>):</h3>
    <ul class="option">
      
        <li>
          <span class="type">(<tt>String</tt>)</span>
          <span class="name">:host</span>
          <span class="default">
            
              <span class="na">N/A</span>
            
          </span>
          &mdash;
the searchd host name or UNIX socket absolute path.


        </tr>
      
        <li>
          <span class="type">(<tt>String</tt>)</span>
          <span class="name">:path</span>
          <span class="default">
            
              <span class="na">N/A</span>
            
          </span>
          &mdash;
the searchd UNIX socket absolute path.


        </tr>
      
        <li>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="name">:port</span>
          <span class="default">
            
              &mdash; default:
              <tt>9312</tt>
            
          </span>
          &mdash;
the searchd port name (skiped when UNIX socket path specified)


        </tr>
      
    </ul>
  
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Array&lt;<a href="Server.html" title="Sphinx::Server">Sphinx::Server</a>&gt;</tt>)</span>
      
      
      
      
        &mdash;
        
an <tt>Array</tt> of instance of <tt>Sphinx::Server</tt> with given
parameters.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="#SetServer-instance_method" title="#SetServer">#SetServer</a></li>
    
      <li><a href="#SetConnectTimeout-instance_method" title="#SetConnectTimeout">#SetConnectTimeout</a></li>
    
      <li><a href="#SetRequestTimeout-instance_method" title="#SetRequestTimeout">#SetRequestTimeout</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 414</span>

<span class='def def kw'>def</span> <span class='SetServers constant id'>SetServers</span><span class='lparen token'>(</span><span class='servers identifier id'>servers</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;servers&quot; argument must be Array'</span>     <span class='unless unless_mod kw'>unless</span> <span class='servers identifier id'>servers</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;servers&quot; argument must be not empty'</span> <span class='if if_mod kw'>if</span> <span class='servers identifier id'>servers</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>

  <span class='@servers ivar id'>@servers</span> <span class='assign token'>=</span> <span class='servers identifier id'>servers</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='bitor op'>|</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;servers&quot; argument must be Array of Hashes'</span> <span class='unless unless_mod kw'>unless</span> <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span>

    <span class='host identifier id'>host</span> <span class='assign token'>=</span> <span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='symbol val'>:path</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='string val'>'path'</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='symbol val'>:host</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='string val'>'host'</span><span class='rbrack token'>]</span>
    <span class='port identifier id'>port</span> <span class='assign token'>=</span> <span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='symbol val'>:port</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='string val'>'port'</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='integer val'>9312</span>
    <span class='path identifier id'>path</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;host&quot; argument must be String'</span> <span class='unless unless_mod kw'>unless</span> <span class='host identifier id'>host</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>

    <span class='comment val'># Check if UNIX socket should be used</span>
    <span class='if if kw'>if</span> <span class='host identifier id'>host</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='integer val'>?/</span>
      <span class='path identifier id'>path</span> <span class='assign token'>=</span> <span class='host identifier id'>host</span>
    <span class='elsif elsif kw'>elsif</span> <span class='host identifier id'>host</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>7</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>'unix://'</span>
      <span class='path identifier id'>path</span> <span class='assign token'>=</span> <span class='host identifier id'>host</span><span class='lbrack token'>[</span><span class='float val'>7</span><span class='dot2 op'>..</span><span class='integer val'>-1</span><span class='rbrack token'>]</span>
    <span class='else else kw'>else</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;port&quot; argument must be Integer'</span> <span class='unless unless_mod kw'>unless</span> <span class='port identifier id'>port</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='port identifier id'>port</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
    <span class='end end kw'>end</span>

    <span class='host identifier id'>host</span> <span class='assign token'>=</span> <span class='port identifier id'>port</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span> <span class='unless unless_mod kw'>unless</span> <span class='path identifier id'>path</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>

    <span class='Sphinx constant id'>Sphinx</span><span class='colon2 op'>::</span><span class='Server constant id'>Server</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='comma token'>,</span> <span class='path identifier id'>path</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span><span class='dot token'>.</span><span class='freeze identifier id'>freeze</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetSortMode-instance_method">
  
    - (<tt>Object</tt>) <strong>SetSortMode</strong>(mode, sortby = '') 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Set matches sorting mode.
</p>
<p>
You can specify sorting mode as String (&quot;relevance&quot;,
&quot;attr_desc&quot;, etc), Symbol (:relevance, :attr_desc, etc), or
Fixnum constant (SPH_SORT_RELEVANCE, SPH_SORT_ATTR_DESC, etc).
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetSortMode constant id'>SetSortMode</span><span class='lparen token'>(</span><span class='Sphinx constant id'>Sphinx</span><span class='colon2 op'>::</span><span class='Client constant id'>Client</span><span class='colon2 op'>::</span><span class='SPH_SORT_ATTR_ASC constant id'>SPH_SORT_ATTR_ASC</span><span class='comma token'>,</span> <span class='string val'>'attr'</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetSortMode constant id'>SetSortMode</span><span class='lparen token'>(</span><span class='symbol val'>:attr_asc</span><span class='comma token'>,</span> <span class='string val'>'attr'</span><span class='rparen token'>)</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetSortMode constant id'>SetSortMode</span><span class='lparen token'>(</span><span class='string val'>'attr_asc'</span><span class='comma token'>,</span> <span class='string val'>'attr'</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>, <tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
        <span class='name'>mode</span>
      
      
      
        &mdash;
        
matches sorting mode.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>sortby</span>
      
      
        <em class="default">(defaults to: <tt>''</tt>)</em>
      
      
        &mdash;
        
sorting clause, with the syntax depending on specific mode. Should be
specified unless sorting mode is <tt>SPH_SORT_RELEVANCE</tt>.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#sorting-modes" title="Section 4.5, \"Sorting modes\"">Section 4.5, "Sorting modes"</a></li>
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-setsortmode" title="Section 6.3.3, \"SetSortMode\"">Section 6.3.3, "SetSortMode"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 832</span>

<span class='def def kw'>def</span> <span class='SetSortMode constant id'>SetSortMode</span><span class='lparen token'>(</span><span class='mode identifier id'>mode</span><span class='comma token'>,</span> <span class='sortby identifier id'>sortby</span> <span class='assign token'>=</span> <span class='string val'>''</span><span class='rparen token'>)</span>
  <span class='case case kw'>case</span> <span class='mode identifier id'>mode</span>
    <span class='when when kw'>when</span> <span class='String constant id'>String</span><span class='comma token'>,</span> <span class='Symbol constant id'>Symbol</span>
      <span class='begin begin kw'>begin</span>
        <span class='mode identifier id'>mode</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='const_get identifier id'>const_get</span><span class='lparen token'>(</span><span class='dstring node'>&quot;SPH_SORT_#{mode.to_s.upcase}&quot;</span><span class='rparen token'>)</span>
      <span class='rescue rescue kw'>rescue</span> <span class='NameError constant id'>NameError</span>
        <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;\&quot;mode\&quot; argument value \&quot;#{mode}\&quot; is invalid&quot;</span>
      <span class='end end kw'>end</span>
    <span class='when when kw'>when</span> <span class='Fixnum constant id'>Fixnum</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;\&quot;mode\&quot; argument value \&quot;#{mode}\&quot; is invalid&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='SPH_SORT_RELEVANCE constant id'>SPH_SORT_RELEVANCE</span><span class='dot2 op'>..</span><span class='SPH_SORT_EXPR constant id'>SPH_SORT_EXPR</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='mode identifier id'>mode</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;mode&quot; argument must be Fixnum, String, or Symbol'</span>
  <span class='end end kw'>end</span>

  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;sortby&quot; argument must be String'</span> <span class='unless unless_mod kw'>unless</span> <span class='sortby identifier id'>sortby</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;sortby&quot; should not be empty unless mode is SPH_SORT_RELEVANCE'</span> <span class='unless unless_mod kw'>unless</span> <span class='mode identifier id'>mode</span> <span class='eq op'>==</span> <span class='SPH_SORT_RELEVANCE constant id'>SPH_SORT_RELEVANCE</span> <span class='or or kw'>or</span> <span class='notop op'>!</span><span class='sortby identifier id'>sortby</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>

  <span class='@sort ivar id'>@sort</span> <span class='assign token'>=</span> <span class='mode identifier id'>mode</span>
  <span class='@sortby ivar id'>@sortby</span> <span class='assign token'>=</span> <span class='sortby identifier id'>sortby</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="SetWeights-instance_method">
  
    - (<tt>Object</tt>) <strong>SetWeights</strong>(weights) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p class="note deprecated"><strong>Deprecated.</strong> 
Use <tt><a href="#SetFieldWeights-instance_method" title="#SetFieldWeights">#SetFieldWeights</a></tt> instead.

</p>
<p>
Binds per-field weights in the order of appearance in the index.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='SetWeights constant id'>SetWeights</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='integer val'>3</span><span class='comma token'>,</span> <span class='integer val'>5</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>Array&lt;Integer&gt;</tt>)</span>
      
      
        <span class='name'>weights</span>
      
      
      
        &mdash;
        
an <tt>Array</tt> of integer per-field weights.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="#SetFieldWeights-instance_method" title="#SetFieldWeights">#SetFieldWeights</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


865
866
867
868
869
870
871
872</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 865</span>

<span class='def def kw'>def</span> <span class='SetWeights constant id'>SetWeights</span><span class='lparen token'>(</span><span class='weights identifier id'>weights</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;weights&quot; argument must be Array'</span> <span class='unless unless_mod kw'>unless</span> <span class='weights identifier id'>weights</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
  <span class='weights identifier id'>weights</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='weight identifier id'>weight</span><span class='bitor op'>|</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;weights&quot; argument must be Array of integers'</span> <span class='unless unless_mod kw'>unless</span> <span class='weight identifier id'>weight</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='weight identifier id'>weight</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
  <span class='end end kw'>end</span>

  <span class='@weights ivar id'>@weights</span> <span class='assign token'>=</span> <span class='weights identifier id'>weights</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="Status-instance_method">
  
    - (<tt>Array&lt;Array&gt;</tt>) <strong>Status</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Queries searchd status, and returns an array of status variable name and
value pairs.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='status identifier id'>status</span> <span class='assign token'>=</span> <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='Status constant id'>Status</span>
  <span class='puts identifier id'>puts</span> <span class='status identifier id'>status</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span> <span class='dstring node'>&quot;#{key.rjust(20)}: #{value}&quot;</span> <span class='rbrace token'>}</span>
</pre>
    
  </div>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Array&lt;Array&gt;</tt>)</span>
      
      
      
      
        &mdash;
        
a table containing searchd status information.


      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2040
2041
2042
2043
2044
2045
2046
2047
2048
2049
2050</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 2040</span>

<span class='def def kw'>def</span> <span class='Status constant id'>Status</span>
  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='perform_request identifier id'>perform_request</span><span class='lparen token'>(</span><span class='symbol val'>:status</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rparen token'>)</span>

  <span class='comment val'># parse response</span>
  <span class='rows identifier id'>rows</span><span class='comma token'>,</span> <span class='cols identifier id'>cols</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_ints identifier id'>get_ints</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span>
  <span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='rows identifier id'>rows</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span>
    <span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='cols identifier id'>cols</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_string identifier id'>get_string</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="UpdateAttributes-instance_method">
  
    - (<tt>Integer</tt>) <strong>UpdateAttributes</strong>(index, attrs, values, mva = false) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Instantly updates given attribute values in given documents. Returns number
of actually updated documents (0 or more) on success, or -1 on failure.
</p>
<p>
<tt>index</tt> is a name of the index (or indexes) to be updated.
<tt>attrs</tt> is a plain array with string attribute names, listing
attributes that are updated. <tt>values</tt> is a Hash where key is
document ID, and value is a plain array of new attribute values.
</p>
<p>
<tt>index</tt> can be either a single index name or a list, like in
<tt><a href="#Query-instance_method" title="#Query">#Query</a></tt>. Unlike <tt><a href="#Query-instance_method" title="#Query">#Query</a></tt>, wildcard is not allowed and all the indexes to
update must be specified explicitly. The list of indexes can include
distributed index names. Updates on distributed indexes will be pushed to
all agents.
</p>
<p>
The updates only work with docinfo=extern storage strategy. They are very
fast because they&#8217;re working fully in RAM, but they can also be made
persistent: updates are saved on disk on clean searchd shutdown initiated
by SIGTERM signal. With additional restrictions, updates are also possible
on MVA attributes; refer to mva_updates_pool directive for details.
</p>
<p>
The first sample statement will update document 1 in index
&quot;test1&quot;, setting &quot;group_id&quot; to 456. The second one will
update documents 1001, 1002 and 1003 in index &quot;products&quot;. For
document 1001, the new price will be set to 123 and the new amount in stock
to 5; for document 1002, the new price will be 37 and the new amount will
be 11; etc. The third one updates document 1 in index &quot;test2&quot;,
setting MVA attribute &quot;group_id&quot; to [456, 789].
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4></h4>
      <pre class="example code">  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='UpdateAttributes constant id'>UpdateAttributes</span><span class='lparen token'>(</span><span class='string val'>&quot;test1&quot;</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='string val'>&quot;group_id&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='lbrace token'>{</span> <span class='integer val'>1</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='integer val'>456</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='semicolon token'>;</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='UpdateAttributes constant id'>UpdateAttributes</span><span class='lparen token'>(</span><span class='string val'>&quot;products&quot;</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='string val'>&quot;price&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;amount_in_stock&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
    <span class='lbrace token'>{</span> <span class='integer val'>1001</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='integer val'>123</span><span class='comma token'>,</span> <span class='integer val'>5</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='integer val'>1002</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='integer val'>37</span><span class='comma token'>,</span> <span class='integer val'>11</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='integer val'>1003</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='integer val'>25</span><span class='comma token'>,</span> <span class='integer val'>129</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='semicolon token'>;</span>
  <span class='sphinx identifier id'>sphinx</span><span class='dot token'>.</span><span class='UpdateAttributes constant id'>UpdateAttributes</span><span class='lparen token'>(</span><span class='string val'>'test2'</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='string val'>'group_id'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='lbrace token'>{</span> <span class='integer val'>1</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='lbrack token'>[</span><span class='integer val'>456</span><span class='comma token'>,</span> <span class='integer val'>789</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
</pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <span class='name'>index</span>
      
      
      
        &mdash;
        
a name of the index to be updated.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
        <span class='name'>attrs</span>
      
      
      
        &mdash;
        
an array of attribute name strings.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <span class='name'>values</span>
      
      
      
        &mdash;
        
is a hash where key is document id, and value is an array of new attribute
values.


      
    </li>
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <span class='name'>mva</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        
indicating whether to update MVA.


      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
      
        &mdash;
        
number of actually updated documents (0 or more) on success, -1 on failure.


      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
      
        &mdash;
        
Occurred when parameters are invalid.


      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.sphinxsearch.com/docs/current.html#api-func-updateatttributes" title="Section 6.7.2, \"UpdateAttributes\"">Section 6.7.2, "UpdateAttributes"</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1978
1979
1980
1981
1982
1983
1984
1985
1986
1987
1988
1989
1990
1991
1992
1993
1994
1995
1996
1997
1998
1999
2000
2001
2002
2003
2004
2005
2006
2007
2008
2009
2010
2011
2012
2013
2014
2015
2016
2017
2018
2019
2020
2021
2022
2023
2024
2025
2026
2027
2028
2029</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sphinx/client.rb', line 1978</span>

<span class='def def kw'>def</span> <span class='UpdateAttributes constant id'>UpdateAttributes</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='comma token'>,</span> <span class='attrs identifier id'>attrs</span><span class='comma token'>,</span> <span class='values identifier id'>values</span><span class='comma token'>,</span> <span class='mva identifier id'>mva</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='comment val'># verify everything</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;index&quot; argument must be String'</span> <span class='unless unless_mod kw'>unless</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;mva&quot; argument must be Boolean'</span>  <span class='unless unless_mod kw'>unless</span> <span class='mva identifier id'>mva</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='TrueClass constant id'>TrueClass</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='mva identifier id'>mva</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='FalseClass constant id'>FalseClass</span><span class='rparen token'>)</span>

  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;attrs&quot; argument must be Array'</span> <span class='unless unless_mod kw'>unless</span> <span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
  <span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='attr identifier id'>attr</span><span class='bitor op'>|</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;attrs&quot; argument must be Array of Strings'</span> <span class='unless unless_mod kw'>unless</span> <span class='attr identifier id'>attr</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='attr identifier id'>attr</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash'</span> <span class='unless unless_mod kw'>unless</span> <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span>
  <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='entry identifier id'>entry</span><span class='bitor op'>|</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash map of Integer to Array'</span> <span class='unless unless_mod kw'>unless</span> <span class='id identifier id'>id</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='id identifier id'>id</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash map of Integer to Array'</span> <span class='unless unless_mod kw'>unless</span> <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;\&quot;values\&quot; argument Hash values Array must have #{attrs.length} elements&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
    <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span> <span class='mva identifier id'>mva</span>
        <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash map of Integer to Array of Arrays'</span> <span class='unless unless_mod kw'>unless</span> <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
        <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='vv identifier id'>vv</span><span class='bitor op'>|</span>
          <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash map of Integer to Array of Arrays of Integers'</span> <span class='unless unless_mod kw'>unless</span> <span class='vv identifier id'>vv</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='vv identifier id'>vv</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span>
        <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'&quot;values&quot; argument must be Hash map of Integer to Array of Integers'</span> <span class='unless unless_mod kw'>unless</span> <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:integer?</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='integer? fid id'>integer?</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># build request</span>
  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='index identifier id'>index</span>

  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
  <span class='for for kw'>for</span> <span class='attr identifier id'>attr</span> <span class='in in kw'>in</span> <span class='attrs identifier id'>attrs</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_string identifier id'>put_string</span> <span class='attr identifier id'>attr</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='mva identifier id'>mva</span> <span class='question op'>?</span> <span class='integer val'>1</span> <span class='colon op'>:</span> <span class='integer val'>0</span>
  <span class='end end kw'>end</span>

  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span> <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
  <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='entry identifier id'>entry</span><span class='bitor op'>|</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int64 identifier id'>put_int64</span> <span class='id identifier id'>id</span>
    <span class='if if kw'>if</span> <span class='mva identifier id'>mva</span>
      <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int_array identifier id'>put_int_array</span> <span class='v identifier id'>v</span> <span class='rbrace token'>}</span>
    <span class='else else kw'>else</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='put_int identifier id'>put_int</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='entry identifier id'>entry</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='perform_request identifier id'>perform_request</span><span class='lparen token'>(</span><span class='symbol val'>:update</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rparen token'>)</span>

  <span class='comment val'># parse response</span>
  <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='get_int identifier id'>get_int</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Nov 19 19:15:06 2009 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>
  0.4.0 (ruby-1.8.7).
</div>

  </body>
</html>